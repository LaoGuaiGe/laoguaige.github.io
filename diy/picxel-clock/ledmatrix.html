<!DOCTYPE html>

<html lang="en"  class="">


<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="keywords" content="keyword1, keyword2">
    
    
    <meta name="description" content="description for this article">
    
    <meta name="generator" content="teedoc">
    <meta name="theme" content="teedoc-plugin-theme-default">
    
        
        <meta name="markdown-generator" content="teedoc-plugin-markdown-parser">
        
        <script>
MathJax = {"loader": {"load": ["output/svg"]}, "tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]]}, "svg": {"fontCache": "global"}};
</script>
        
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        
        <meta name="html-generator" content="teedoc-plugin-jupyter-notebook-parser">
        
        <script src="/static/js/theme_default/pre_main.js"></script>
        
        <link rel="stylesheet" href="/static/css/theme_default/prism.min.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/theme_default/viewer.min.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/theme_default/dark.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/theme_default/light.css" type="text/css"/>
        
        <script src="/static/js/theme_default/jquery.min.js"></script>
        
        <script src="/static/js/theme_default/split.js"></script>
        
        <link rel="stylesheet" href="/static/css/gitalk/gitalk.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/gitalk/custom_gitalk.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/custom.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/search/style.css" type="text/css"/>
        
    
    
    <title>彩灯驱动 - Hdochub</title>
    
    <script type="text/javascript">js_vars = {"teedoc-plugin-ad-hint": {"type": "hint", "label": "☆", "content": "这里是老怪鸽的个人技术文档记录中心</br>喜欢项目请<a target=\"_blank\" href=\"https://github.com/LaoGuaiGe/laoguaige.github.io\">点下 ☆ star </a>哦~🦀🦀", "show_times": 2, "show_after_s": 432000, "date": "2021-11-16 14:40", "color": "#a0421d", "link_color": "#e53935", "link_bg_color": "#e6ae5c", "bg_color": "#ffcf89", "color_hover": "white", "bg_color_hover": "#f57c00", "close_color": "#eab971"}}</script>
    <script type="text/javascript">metadata = {"tags": [], "date": "2024-12-05", "update": [{"date": "2024-12-05", "author": "老怪鸽", "version": "1.0.1", "content": "更新了基本文档"}], "ts": 1733356800, "author": "", "brief": "", "cover": "", "show_source": false, "excerpt_separator": ""}</script>
</head>


<body class="type_doc">
    
    <div id="navbar">
        <div id="navbar_menu">
            <a class="site_title" href="/">
                
                    <img class="site_logo" src="/static/images/logo.png" alt="HDocHub logo">
                
                
                    <h2>HDocHub</h2>
                
        </a>
            <a id="navbar_menu_btn"></a>
        </div>
        <div id="navbar_items">
            <div>
                <ul id="nav_left">
<li class=""><a  href="/">首页</a></li>
<li class=""><a  href="/c-basics/">C语言</a></li>
<li class=""><a  href="/python/">Python</a></li>
<li class=""><a  href="/linux/">Linux</a></li>
<li class=""><a  href="/markdown/">MarkDown</a></li>
<li class=""><a  href="/git/">Git</a></li>
<li class=""><a  href="/mcu/">单片机</a></li>
<li class=""><a  href="/module/">电子模块驱动合集</a></li>
<li class="active"><a  href="/diy/">DIY项目</a></li>
</ul>

            </div>
            <div>
                <ul id="nav_right">
<li class=""><a target="_blank" href="https://github.com/LaoGuaiGe/laoguaige.github.io">github</a></li>
</ul>

                <ul class="nav_plugins"><li><a id="themes" class="light"></a></li></ul><ul class="nav_plugins"><li><a id="search"><span class="icon"></span><span class="placeholder">搜索</span>
                            <div id="search_hints">
                                <span id="search_input_hint">输入关键词，多关键词空格隔开</span>
                                <span id="search_loading_hint">正在加载，请稍候。。。</span>
                                <span id="search_download_err_hint">下载文件失败，请刷新重试或检查网络</span>
                                <span id="search_other_docs_result_hint">来自其它文档的结果</span>
                                <span id="search_curr_doc_result_hint">当前文档搜索结果</span>
                            </div></a></li></ul>
            </div>
        </div>
    </div>
    
    <div id="wrapper">
        <div id="sidebar_wrapper">
            <div id="sidebar">
                <div id="sidebar_title">
                    
                </div>
                <ul class="show">
<li class="not_active with_link"><a href="/diy/index.html"><span class="label">项目集合</span><span class=""></span></a></li>
<li class="active_parent with_link"><a href="/diy/picxel-clock/basic.html"><span class="label">物联网像素时钟⏰</span><span class="sub_indicator"></span></a><ul class="show">
<li class="not_active with_link"><a href="/diy/picxel-clock/basic.html"><span class="label">✨项目信息</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/diy/picxel-clock/download.html"><span class="label">⬇️资料下载</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/diy/picxel-clock/hardware.html"><span class="label">0. 硬件设计</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/diy/picxel-clock/install.html"><span class="label">1. 软件环境搭建</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/diy/picxel-clock/ds1302.html"><span class="label">2. RTC时钟驱动</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/diy/picxel-clock/dht11.html"><span class="label">3. 温湿度采集</span><span class=""></span></a></li>
<li class="active with_link"><a href="/diy/picxel-clock/ledmatrix.html"><span class="label">4. 彩灯驱动</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/diy/picxel-clock/ntptime.html"><span class="label">5. 获取网络时间</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/diy/picxel-clock/weather.html"><span class="label">6. 获取天气情况</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/diy/picxel-clock/led-oscillating.html"><span class="label">7. 实现FFT音律灯</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/diy/picxel-clock/voice.html"><span class="label">8. 语音识别与播报</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active with_link"><a href="/diy/wiki-web/basic.html"><span class="label">WIKI网站搭建🌐</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/diy/tracking-cannon/basic.html"><span class="label">年轻人的第一台舰防跑🔫</span><span class=""></span></a></li>
</ul>

            </div>
        </div>
        <div id="article">
            <div id="menu_wrapper">
                <div id="menu">
                </div>
            </div>
            <div id="content_wrapper">
                <div id="content_body">
                    <div id="article_head">
                        <div id="article_title">
                            
                            <h1>彩灯驱动</h1>
                            
                        </div>
                        <div id="article_tags">
                            <ul>
                            
                            </ul>
                        </div>
                        <div id="article_info">
                        <div id="article_info_left">
                            <span class="article_author">
                                
                            </span>
                            
                                <span class="article_date" title="Last modify date: 2024-12-05">
                                    2024-12-05
                                </span>
                            
                        </div>
                        <div id="article_info_right">
                            
                        </div>
                        </div>
                    </div>
                    <div id="article_tools">
                        <span></span>
                        <span id="toc_btn"></span>
                    </div>
                    <div id="update_history">
                        
                        
                        <details open>
                        
                            <summary>Update history</summary>
                            <div>
                                <table>
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Version</th>
                                                <th>Author</th>
                                                <th>Update content</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            
                                                <tr>
                                                    <td>2024-12-05</td>
                                                    <td>1.0.1</td>
                                                    <td>老怪鸽</td>
                                                    <td>
                                                    
                                                        更新了基本文档
                                                    
                                                    </td>
                                                </tr>
                                            
                                        </tbody>
                                </table>
                            </div>
                        </details>
                        
                    </div>
                    <div id="article_content">
                        
                            <h2 id="%E7%A1%AC%E4%BB%B6%E5%87%86%E5%A4%87">硬件准备</h2>
<hr />
<h3 id="WS2812%E7%9F%A9%E9%98%B5%E5%BD%A9%E7%81%AF">WS2812矩阵彩灯</h3>
<p><img src="../../static/images/docs/diy/picxel-clock/ledmatrix/ledmatrix-2024-12-05-23-14-08.png" alt="图 0" /></p>
<p><strong>购买地址：</strong><a href="https://item.taobao.com/item.htm?spm=a1z09.2.0.0.24ee2e8dC5LwBl&amp;id=737696448369&amp;_u=r2t4uge57a73&amp;skuId=5263566850408"  target="_blank">WS2812B全彩软像素屏8X8 8X32 16X16幻彩5V显示可编程像素软屏</a></p>
<h3 id="ESP32S3%E5%BC%80%E5%8F%91%E6%9D%BF">ESP32S3开发板</h3>
<p><img src="../../static/images/docs/diy/picxel-clock/ledmatrix/ledmatrix-2024-12-05-23-14-24.png" alt="图 1" /></p>
<p><strong>购买地址：</strong><a href="https://item.szlcsc.com/22034693.html?fromZone=s_s__%2522%25E7%25AB%258B%25E5%2588%259B%25E5%25BC%2580%25E5%258F%2591%25E6%259D%25BF%2522"  target="_blank">立创·ESP32S3R8N8 开发板</a></p>
<h2 id="%E5%B7%A5%E7%A8%8B%E5%88%9B%E5%BB%BA">工程创建</h2>
<hr />
<p>在VSCode中打开PlatformIO扩展创建名为<code>LEDMatrix</code>的 <code>Espressif ESP32-S3-DevKitM-1</code> 工程。</p>
<p>关于详细图文创建工程的过程请参考👉<a href="ds1302.html"  >RTC时钟驱动</a>章节的工程创建小节。</p>
<h2 id="%E5%AE%89%E8%A3%85%E9%A9%B1%E5%8A%A8%E5%BA%93">安装驱动库</h2>
<hr />
<p>最底层的驱动，需要分别安装两个库：</p>
<ol>
<li><p>搜索<code>Adafruit NeoMatrix</code>，安装来自<code>Adafruit</code>的<code>Adafruit NeoMatrix</code>库。</p>
</li>
<li><p>搜索<code>Adafruit GFX Library</code>，安装来自<code>Adafruit</code>的<code>Adafruit GFX Library</code>库。</p>
</li>
</ol>
<p>将它们都安装到我们的工程当中。</p>
<blockquote>
<p>关于详细图文安装驱动库的过程请参考👉<a href="ds1302.html"  >RTC时钟驱动</a>章节的安装驱动库小节。</p>
</blockquote>
<p>都安装完成之后，打开<code>platformio.ini</code>文件，可以看到已经安装上了两个驱动库。</p>
<p><img src="../../static/images/docs/diy/picxel-clock/ledmatrix/ledmatrix-2024-12-05-23-16-11.png" alt="图 2" /></p>
<h2 id="%E7%BC%96%E8%BE%91%E4%BB%A3%E7%A0%81">编辑代码</h2>
<hr />
<p>首先导入我们的字库，这里我提供给大家一个ascii的字库。在工程下的<code>include</code>文件夹下新建一个 <code>my_font.h</code>文件。</p>
<p>接下来往 <code>my_font.h</code> 文件写入我们的字模代码：</p>
<blockquote>
<p>直接复制以下代码到你的文件下</p>
</blockquote>

<pre class="language-c"><code class="language-c">
#include &quot;Arduino.h&quot;
#include &quot;Adafruit_GFX.h&quot;

const uint8_t PicopixelBitmaps[] PROGMEM = {
    0xE8, 0xB4, 0x57, 0xD5, 0xF5, 0x00, 0x4E, 0x3E, 0x80, 0xA5, 0x4A, 0x4A,
    0x5A, 0x50, 0x80, 0x6A, 0x40, 0x95, 0x80, 0xAA, 0x80, 0x5D, 0x00, 0x60,
    0xE0, 0x80, 0x25, 0x48, 0xF6, 0xDE, 0x59, 0x2E, 0xE7, 0xCE, 0xE7, 0x9E,
    0xB7, 0x92, 0xF3, 0x9E, 0xF3, 0xDE, 0xE4, 0x92, 0xF7, 0xDE, 0xF7, 0x9E,
    0xA0, 0x46, 0x64, 0xE3, 0x80, 0x98, 0xC5, 0x04, 0x56, 0xC6, 0x57, 0xDA,
    0xD7, 0x5C, 0x72, 0x46, 0xD6, 0xDC, 0xF3, 0xCE, 0xF3, 0x48, 0x72, 0xD4,
    0xB7, 0xDA, 0xF8, 0x24, 0xD4, 0xBB, 0x5A, 0x92, 0x4E, 0x8E, 0xEB, 0x58,
    0x80, 0x9D, 0xB9, 0x90, 0x56, 0xD4, 0xD7, 0x48, 0x56, 0xD4, 0x40, 0xD7,
    0x5A, 0x71, 0x1C, 0xE9, 0x24, 0xB6, 0xD4, 0xB6, 0xA4, 0x8C, 0x6B, 0x55,
    0x00, 0xB5, 0x5A, 0xB5, 0x24, 0xE5, 0x4E, 0xEA, 0xC0, 0x91, 0x12, 0xD5,
    0xC0, 0x54, 0xF0, 0x90, 0xC7, 0xF0, 0x93, 0x5E, 0x71, 0x80, 0x25, 0xDE,
    0x5E, 0x30, 0x6E, 0x80, 0x77, 0x9C, 0x93, 0x5A, 0xB8, 0x45, 0x60, 0x92,
    0xEA, 0xAA, 0x40, 0xD5, 0x6A, 0xD6, 0x80, 0x55, 0x00, 0xD7, 0x40, 0x75,
    0x90, 0xE8, 0x71, 0xE0, 0xBA, 0x40, 0xB5, 0x80, 0xB5, 0x00, 0x8D, 0x54,
    0xAA, 0x80, 0xAC, 0xE0, 0xE5, 0x70, 0x6A, 0x26, 0xFC, 0xC8, 0xAC, 0x5A};

const GFXglyph PicopixelGlyphs[] PROGMEM = { {0, 0, 0, 2, 0, 1},     // 0x20 ' '
                                            {0, 1, 5, 2, 0, -4},    // 0x21 '!'
                                            {1, 3, 2, 4, 0, -4},    // 0x22 '&quot;'
                                            {2, 5, 5, 6, 0, -4},    // 0x23 '#'
                                            {6, 3, 6, 4, 0, -4},    // 0x24 '$'
                                            {9, 3, 5, 4, 0, -4},    // 0x25 '%'
                                            {11, 4, 5, 5, 0, -4},   // 0x26 '&amp;'
                                            {14, 1, 2, 2, 0, -4},   // 0x27 '''
                                            {15, 2, 5, 3, 0, -4},   // 0x28 '('
                                            {17, 2, 5, 3, 0, -4},   // 0x29 ')'
                                            {19, 3, 3, 4, 0, -3},   // 0x2A '*'
                                            {21, 3, 3, 4, 0, -3},   // 0x2B '+'
                                            {23, 2, 2, 3, 0, 0},    // 0x2C ','
                                            {24, 3, 1, 4, 0, -2},   // 0x2D '-'
                                            {25, 1, 1, 2, 0, 0},    // 0x2E '.'
                                            {26, 3, 5, 4, 0, -4},   // 0x2F '/'
                                            {28, 3, 5, 4, 0, -4},   // 0x30 '0'
                                            {30, 3, 5, 4, 0, -4},   // 0x31 '1'
                                            {32, 3, 5, 4, 0, -4},   // 0x32 '2'
                                            {34, 3, 5, 4, 0, -4},   // 0x33 '3'
                                            {36, 3, 5, 4, 0, -4},   // 0x34 '4'
                                            {38, 3, 5, 4, 0, -4},   // 0x35 '5'
                                            {40, 3, 5, 4, 0, -4},   // 0x36 '6'
                                            {42, 3, 5, 4, 0, -4},   // 0x37 '7'
                                            {44, 3, 5, 4, 0, -4},   // 0x38 '8'
                                            {46, 3, 5, 4, 0, -4},   // 0x39 '9'
                                            {48, 1, 3, 2, 0, -3},   // 0x3A ':'
                                            {49, 2, 4, 3, 0, -3},   // 0x3B ';'
                                            {50, 2, 3, 3, 0, -3},   // 0x3C '&lt;'
                                            {51, 3, 3, 4, 0, -3},   // 0x3D '='
                                            {53, 2, 3, 3, 0, -3},   // 0x3E '&gt;'
                                            {54, 3, 5, 4, 0, -4},   // 0x3F '?'
                                            {56, 3, 5, 4, 0, -4},   // 0x40 '@'
                                            {58, 3, 5, 4, 0, -4},   // 0x41 'A'
                                            {60, 3, 5, 4, 0, -4},   // 0x42 'B'
                                            {62, 3, 5, 4, 0, -4},   // 0x43 'C'
                                            {64, 3, 5, 4, 0, -4},   // 0x44 'D'
                                            {66, 3, 5, 4, 0, -4},   // 0x45 'E'
                                            {68, 3, 5, 4, 0, -4},   // 0x46 'F'
                                            {70, 3, 5, 4, 0, -4},   // 0x47 'G'
                                            {72, 3, 5, 4, 0, -4},   // 0x48 'H'
                                            {74, 1, 5, 2, 0, -4},   // 0x49 'I'
                                            {75, 3, 5, 4, 0, -4},   // 0x4A 'J'
                                            {77, 3, 5, 4, 0, -4},   // 0x4B 'K'
                                            {79, 3, 5, 4, 0, -4},   // 0x4C 'L'
                                            {81, 5, 5, 6, 0, -4},   // 0x4D 'M'
                                            {85, 4, 5, 5, 0, -4},   // 0x4E 'N'
                                            {88, 3, 5, 4, 0, -4},   // 0x4F 'O'
                                            {90, 3, 5, 4, 0, -4},   // 0x50 'P'
                                            {92, 3, 6, 4, 0, -4},   // 0x51 'Q'
                                            {95, 3, 5, 4, 0, -4},   // 0x52 'R'
                                            {97, 3, 5, 4, 0, -4},   // 0x53 'S'
                                            {99, 3, 5, 4, 0, -4},   // 0x54 'T'
                                            {101, 3, 5, 4, 0, -4},  // 0x55 'U'
                                            {103, 3, 5, 4, 0, -4},  // 0x56 'V'
                                            {105, 5, 5, 6, 0, -4},  // 0x57 'W'
                                            {109, 3, 5, 4, 0, -4},  // 0x58 'X'
                                            {111, 3, 5, 4, 0, -4},  // 0x59 'Y'
                                            {113, 3, 5, 4, 0, -4},  // 0x5A 'Z'
                                            {115, 2, 5, 3, 0, -4},  // 0x5B '['
                                            {117, 3, 5, 4, 0, -4},  // 0x5C '\'
                                            {119, 2, 5, 3, 0, -4},  // 0x5D ']'
                                            {121, 3, 2, 4, 0, -4},  // 0x5E '^'
                                            {122, 4, 1, 4, 0, 1},   // 0x5F '_'
                                            {123, 2, 2, 3, 0, -4},  // 0x60 '`'
                                            {124, 3, 4, 4, 0, -3},  // 0x61 'a'
                                            {126, 3, 5, 4, 0, -4},  // 0x62 'b'
                                            {128, 3, 3, 4, 0, -2},  // 0x63 'c'
                                            {130, 3, 5, 4, 0, -4},  // 0x64 'd'
                                            {132, 3, 4, 4, 0, -3},  // 0x65 'e'
                                            {134, 2, 5, 3, 0, -4},  // 0x66 'f'
                                            {136, 3, 5, 4, 0, -3},  // 0x67 'g'
                                            {138, 3, 5, 4, 0, -4},  // 0x68 'h'
                                            {140, 1, 5, 2, 0, -4},  // 0x69 'i'
                                            {141, 2, 6, 3, 0, -4},  // 0x6A 'j'
                                            {143, 3, 5, 4, 0, -4},  // 0x6B 'k'
                                            {145, 2, 5, 3, 0, -4},  // 0x6C 'l'
                                            {147, 5, 3, 6, 0, -2},  // 0x6D 'm'
                                            {149, 3, 3, 4, 0, -2},  // 0x6E 'n'
                                            {151, 3, 3, 4, 0, -2},  // 0x6F 'o'
                                            {153, 3, 4, 4, 0, -2},  // 0x70 'p'
                                            {155, 3, 4, 4, 0, -2},  // 0x71 'q'
                                            {157, 2, 3, 3, 0, -2},  // 0x72 'r'
                                            {158, 3, 4, 4, 0, -3},  // 0x73 's'
                                            {160, 2, 5, 3, 0, -4},  // 0x74 't'
                                            {162, 3, 3, 4, 0, -2},  // 0x75 'u'
                                            {164, 3, 3, 4, 0, -2},  // 0x76 'v'
                                            {166, 5, 3, 6, 0, -2},  // 0x77 'w'
                                            {168, 3, 3, 4, 0, -2},  // 0x78 'x'
                                            {170, 3, 4, 4, 0, -2},  // 0x79 'y'
                                            {172, 3, 4, 4, 0, -3},  // 0x7A 'z'
                                            {174, 3, 5, 4, 0, -4},  // 0x7B '{'
                                            {176, 1, 6, 2, 0, -4},  // 0x7C '|'
                                            {177, 3, 5, 4, 0, -4},  // 0x7D '}'
                                            {179, 4, 2, 5, 0, -3} }; // 0x7E '~'

const GFXfont Picopixel PROGMEM = {(uint8_t *)PicopixelBitmaps,
                                   (GFXglyph *)PicopixelGlyphs, 0x20, 0x7E, 7};

</code></pre>
<p>字模准备完毕，我们可以点亮彩灯矩阵，并且显示ascii的字符了！</p>
<p>打开工程下的src文件夹下的main.cpp。</p>
<p>输入以下代码：</p>

<pre class="language-c"><code class="language-c">#include &lt;Arduino.h&gt;
#include &lt;Adafruit_NeoMatrix.h&gt; //点亮LED矩阵需要的库
#include &quot;my_font.h&quot;            //引用文字库头文件

//像素阵列定义
#define kMatrixWidth   32             //宽度
#define kMatrixHeight  8              //高度
#define BRIGHTNESS     10            //默认亮度 0-255
#define BRIGHTNESS_INTERVAL 30        //亮度调节间隔
#define LED_PIN        8              //像素阵列引脚

Adafruit_NeoMatrix *matrix;     //LED矩阵类指针

//像素矩阵初始化
void InitLED_Matrix(void)
{
  //设置像素矩阵的方向以及排列方式
  matrix = new Adafruit_NeoMatrix(32, 8, LED_PIN, NEO_MATRIX_TOP + NEO_MATRIX_LEFT+
    NEO_MATRIX_COLUMNS +  NEO_MATRIX_ZIGZAG,
    NEO_GRB + NEO_KHZ800);
  matrix-&gt;setTextWrap(false);       //设置文字是否自动换行
  matrix-&gt;setFont(&amp;Picopixel);      //设置字体
  matrix-&gt;clear();                  //清除当前显示内容
  matrix-&gt;setBrightness(BRIGHTNESS);//设置亮度
}

//显示信息
void ShowMessage(Adafruit_NeoMatrix *matrix, char *message, int len, uint32_t color)
{
  //清除上一次的显示内容
  matrix-&gt;clear();

  //设置文本颜色
  matrix-&gt;setTextColor(color);

  //如果显示的内容过长，或者过小
  if (len &lt; 1 || len &gt; 8)
    return;

  //设置鼠标光标的位置用以确定在哪里显示文字
  //X轴自动居中
  matrix-&gt;setCursor(1 + (8 - len) * 2, 5); 

  //将显示的内容输出至缓存中
  matrix-&gt;print(message);

  //显示缓存中的内容
  matrix-&gt;show();
}

void setup() 
{
  //初始化LED矩阵显示
  InitLED_Matrix();                 

  //显示 6 个字符，显示内容：Hello!，显示颜色：绿色(R,G,B)
  ShowMessage(matrix, &quot;Hello!&quot;, 6, matrix-&gt;Color(0, 255, 0));
}

void loop() 
{
  delay(1000);
}
</code></pre>
<h2 id="%E7%A1%AC%E4%BB%B6%E8%BF%9E%E6%8E%A5">硬件连接</h2>
<hr />
<p><img src="../../static/images/docs/diy/picxel-clock/ledmatrix/ledmatrix-2024-12-05-23-17-41.png" alt="图 3" /></p>
<blockquote>
<p>这里其实我是做了电路设计的，但是模块电路都是一样的。<br />
<img src="../../static/images/docs/diy/picxel-clock/ledmatrix/ledmatrix-2024-12-05-23-17-49.png" alt="图 4" /></p>
</blockquote>
<h2 id="%E4%BB%A3%E7%A0%81%E9%AA%8C%E8%AF%81">代码验证</h2>
<hr />
<p>代码编写完成之后，将ESP32S3开发板接入电脑下载代码。然后观察彩灯矩阵的现象。</p>
<p>实物显示如下：</p>
<p><strong>裸屏显示</strong></p>
<p><img src="../../static/images/docs/diy/picxel-clock/ledmatrix/ledmatrix-2024-12-05-23-18-43.png" alt="图 5" /></p>
<p><strong>使用黑色亚克力面板+白纸格挡光线显示</strong></p>
<blockquote>
<p>叠层从上到下是这样的：黑色亚克力面板 -&gt; 白纸 -&gt; LED矩阵</p>
</blockquote>
<p><img src="../../static/images/docs/diy/picxel-clock/ledmatrix/ledmatrix-2024-12-05-23-18-50.png" alt="图 6" /></p>
<h2 id="%E7%A4%BA%E4%BE%8B%E4%B8%80%EF%BC%9A%E6%98%BE%E7%A4%BA%E4%B8%8B%E9%9B%A8%E7%89%B9%E6%95%88">示例一：显示下雨特效</h2>
<hr />
<h3 id="%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA%E5%88%86%E7%B1%BB">文件创建分类</h3>
<ol>
<li><p>在工程下的<code>include</code> 文件夹下新建一个 <code>anim.h</code>文件。</p>
</li>
<li><p>在工程下的<code>src</code> 文件夹下新建一个 <code>anim.cpp</code>文件。</p>
</li>
</ol>
<h3 id="%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99">代码编写</h3>
<p>在 <code>anim.h</code> 文件中编写以下代码：</p>

<pre class="language-c"><code class="language-c">#ifndef _ANIM_H_
#define _ANIM_H_

#include &lt;Adafruit_NeoMatrix.h&gt;
#include &quot;Arduino.h&quot;


//数字雨动画
void movingPixel(Adafruit_NeoMatrix *matrix, int x, int y, int colorh);
void showRainingCode(Adafruit_NeoMatrix *matrix);

#endif
</code></pre>
<hr />
<p>在 <code>anim.cpp</code> 文件中编写以下代码：</p>

<pre class="language-c"><code class="language-c">#include &quot;anim.h&quot;

//数字雨
int columnIndex[8];
int stepIndex[8];
int glow[8];
bool Running[8]={false, false, false, false, false, false, false, false};
int stepsTillNext[8] = {0, 6, 2, 11, 4, 10, 7, 1};

uint16_t hsv2rgb(Adafruit_NeoMatrix *matrix, uint16_t hue, uint8_t saturation, uint8_t value)
{
    uint8_t red = 0;
    uint8_t green = 0;
    uint8_t blue = 0;
    uint16_t hi = (hue / 60) % 6;
    uint16_t F = 100 * hue / 60 - 100 * hi;
    uint16_t P = value * (100 - saturation) / 100;
    uint16_t Q = value * (10000 - F * saturation) / 10000;
    uint16_t T = value * (10000 - saturation * (100 - F)) / 10000;

    switch (hi)
    {
    case 0:
        red = value;
        green = T;
        blue = P;
        break;
    case 1:
        red = Q;
        green = value;
        blue = P;
        break;
    case 2:
        red = P;
        green = value;
        blue = T;
        break;
    case 3:
        red = P;
        green = Q;
        blue = value;
        break;
    case 4:
        red = T;
        green = P;
        blue = value;
        break;
    case 5:
        red = value;
        green = P;
        blue = Q;
        break;
    default:
        return matrix-&gt;Color(255, 0, 0);
    }
    red = red * 255 / 100;
    green = green * 255 / 100;
    blue = blue * 255 / 100;
    return matrix-&gt;Color(red, green, blue);
}

//数字雨专用的移动像素特效
void movingPixel(Adafruit_NeoMatrix *matrix, int x, int y, int colorh)
{
    int pixel = y;
    matrix-&gt;drawPixel(x, pixel, hsv2rgb(matrix, colorh, 100, 100));
    if(pixel-1 &gt;= 0){ matrix-&gt;drawPixel(x, pixel-1, hsv2rgb(matrix, colorh, 80, 80 ));}
    if(pixel-2 &gt;= 0){ matrix-&gt;drawPixel(x, pixel-2, hsv2rgb(matrix, colorh, 70, 70 ));}
    if(pixel-3 &gt;= 0){ matrix-&gt;drawPixel(x, pixel-3, hsv2rgb(matrix, colorh, 45, 45 ));}
    if(pixel-4 &gt;= 0){ matrix-&gt;drawPixel(x, pixel-4, hsv2rgb(matrix, colorh, 25, 25 ));}
    if(pixel-5 &gt;= 0){ matrix-&gt;drawPixel(x, pixel-5, hsv2rgb(matrix, colorh, 10, 10 ));}
    if(pixel-6 &gt;= 0){ matrix-&gt;drawPixel(x, pixel-6, matrix-&gt;Color(0, 0, 0));}
}

//显示数字雨特效
void showRainingCode(Adafruit_NeoMatrix *matrix) 
{
    for(int i=0; i&lt;8; i++)
    {
        if(stepIndex[i] &gt; stepsTillNext[i])
        {
            Running[i] = true;
            stepsTillNext[i] = 13;  // 进行数组初始化
            columnIndex[i] = random((i*4), ((i+1)*4));
            glow[i] = random(0, 2);     //随机背景置灰值
            stepIndex[i] = 0;
        }
        if(Running[i] == true)
        {
            movingPixel(matrix, columnIndex[i], stepIndex[i], 240);
            if(stepIndex[i] == 13)
            {
                Running[i] = false;
            }
        }
        stepIndex[i] += 1;
    }
}
</code></pre>
<hr />
<p>最后在<code>main.cpp</code>中编写如果代码：</p>

<pre class="language-c"><code class="language-c">#include &lt;Arduino.h&gt;
#include &lt;Adafruit_NeoMatrix.h&gt; //点亮LED矩阵需要的库
#include &quot;my_font.h&quot;            //引用文字库头文件
#include &quot;anim.h&quot;            //引用我们自定义的动画头文件

//像素阵列定义
#define kMatrixWidth   32             //宽度
#define kMatrixHeight  8              //高度
#define BRIGHTNESS     50            //默认亮度 0-255
#define BRIGHTNESS_INTERVAL 30        //亮度调节间隔
#define LED_PIN        8              //像素阵列引脚

Adafruit_NeoMatrix *matrix;     //LED矩阵类指针

//像素矩阵初始化
void InitLED_Matrix(void)
{
  //设置像素矩阵的方向以及排列方式
  matrix = new Adafruit_NeoMatrix(32, 8, LED_PIN, NEO_MATRIX_TOP + NEO_MATRIX_LEFT+
    NEO_MATRIX_COLUMNS +  NEO_MATRIX_ZIGZAG,
    NEO_GRB + NEO_KHZ800);
  matrix-&gt;setTextWrap(false);       //设置文字是否自动换行
  matrix-&gt;setFont(&amp;Picopixel);      //设置字体
  matrix-&gt;clear();                  //清除当前显示内容
  matrix-&gt;setBrightness(BRIGHTNESS);//设置亮度
}

//显示信息
void ShowMessage(Adafruit_NeoMatrix *matrix, char *message, int len, uint32_t color)
{
  //清除上一次的显示内容
  matrix-&gt;clear();

  //设置文本颜色
  matrix-&gt;setTextColor(color);

  //如果显示的内容过长，或者过小
  if (len &lt; 1 || len &gt; 8)
    return;

  //设置鼠标光标的位置用以确定在哪里显示文字
  //X轴自动居中
  matrix-&gt;setCursor(1 + (8 - len) * 2, 5); 

  //将显示的内容输出至缓存中
  matrix-&gt;print(message);

  //显示缓存中的内容
  matrix-&gt;show();
}

void setup() 
{
  //初始化LED矩阵显示
  InitLED_Matrix();                 

  //显示 6 个字符，显示内容：Hello!，显示颜色：绿色(R,G,B)
  ShowMessage(matrix, &quot;Hello!&quot;, 6, matrix-&gt;Color(0, 255, 0));
  delay(2000);
}

void loop() 
{
  //清除之前的显示内容
  matrix-&gt;clear();
  //设置雨滴特效
  showRainingCode(matrix);
  //显示内容
  matrix-&gt;show();
  //控制雨滴下落速度
  delay(250);
}

</code></pre>
<h3 id="%E5%AE%9E%E7%89%A9%E6%95%88%E6%9E%9C">实物效果</h3>
<blockquote>
<p>烧录步骤不再描述，这里直接提供实物效果图。</p>
</blockquote>
<p><strong>使用黑色亚克力面板+白纸格挡光线显示</strong></p>
<blockquote>
<p>叠层从上到下是这样的：黑色亚克力面板 -&gt; 白纸 -&gt; LED矩阵</p>
</blockquote>
<p><img src="../../static/images/docs/diy/picxel-clock/ledmatrix/ledmatrix-2024-12-05-23-22-51.gif" alt="图 9" /></p>
<h2 id="%E7%A4%BA%E4%BE%8B%E4%BA%8C%EF%BC%9A%E6%98%BE%E7%A4%BA%E6%97%B6%E9%92%9F%E5%B9%B6%E8%B5%B0%E6%97%B6">示例二：显示时钟并走时</h2>
<hr />
<blockquote>
<p>并不是真的显示真实时间，这里只是显示个模型，方便我们后面搞好时钟模块的驱动后使用</p>
</blockquote>
<h3 id="%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA%E5%88%86%E7%B1%BB">文件创建分类</h3>
<p>继续继用上一章节的 <code>anim.h</code> 和 <code>anim.cpp</code>，位置和文件名都不变。</p>
<h3 id="%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81">编写代码</h3>
<p>在<code>anim.h</code>中补充如下：</p>

<pre class="language-c"><code class="language-c">//时钟时钟
void weekBarDisplay(Adafruit_NeoMatrix *matrix,int week); 
</code></pre>
<p>代码页面截图：</p>
<p><img src="../../static/images/docs/diy/picxel-clock/ledmatrix/ledmatrix-2024-12-05-23-23-17.png" alt="图 10" /></p>
<p>在<code>anim.cpp</code> 文件的末尾补充如下代码：</p>

<pre class="language-c"><code class="language-c">/**************************************数字时钟*********************************************** */
//日期显示
void weekBarDisplay(Adafruit_NeoMatrix *matrix,int week) 
{
  week = week - 1;         
  for (int i = 0; i &lt; 7; i++)
  {
    if ( i == 5 || i== 6 )
      matrix-&gt;drawFastHLine(3 + 4 * i, 7, 3, matrix-&gt;Color(50, 0, 0));
    else
      matrix-&gt;drawFastHLine(3 + 4 * i, 7, 3, matrix-&gt;Color(50, 50, 50));
  }
  if ( week == 5 || week == 6 )  //周六、日显示为红色
    matrix-&gt;drawFastHLine(3 + 4 * week, 7, 3, matrix-&gt;Color(255, 0, 0));
  else
    matrix-&gt;drawFastHLine(3 + 4 * week, 7, 3, matrix-&gt;Color(255, 255, 255));
}
/**************************************数字时钟*********************************************** */

</code></pre>
<p><img src="../../static/images/docs/diy/picxel-clock/ledmatrix/ledmatrix-2024-12-05-23-23-24.png" alt="图 11" /></p>
<p>在<code>main.cpp</code> 文件中，将<code>loop()</code> 函数中更新为如下代码：</p>

<pre class="language-c"><code class="language-c">void loop() 
{
  static char disp_buf[50] = {0};
  static int hour = 12;
  static int minute = 59;
  static int second = 0;
  static int week = 2;

  matrix-&gt;clear();//清屏
  matrix-&gt;setTextColor(matrix-&gt;Color(0, 0, 80));//设置文本颜色
  matrix-&gt;setCursor(3, 5);//设置显示起始坐标
  sprintf(disp_buf, &quot;%02d:%02d:%02d\0&quot;, hour, minute, second);//格式化时间字符串
  matrix-&gt;print(disp_buf);//显示时分秒
  weekBarDisplay(matrix,week);//显示周（特殊的显示方式）
  matrix-&gt;show();//更新显示

  delay(1000);

  second = second + 1;
  if( second &gt; 59 ) second = 0;
}
</code></pre>
<p>代码截图：</p>
<p><img src="../../static/images/docs/diy/picxel-clock/ledmatrix/ledmatrix-2024-12-05-23-23-40.png" alt="图 12" /></p>
<blockquote>
<p>代码中时钟跑时部分是随便写的，这里就是写了一个显示时间的UI框架，并不是真实时间的跑时。</p>
</blockquote>
<h3 id="%E5%AE%9E%E7%89%A9%E9%AA%8C%E8%AF%81">实物验证</h3>
<blockquote>
<p>烧录步骤不再描述，这里直接提供实物效果图。</p>
</blockquote>
<p><img src="../../static/images/docs/diy/picxel-clock/ledmatrix/ledmatrix-2024-12-05-23-23-52.gif" alt="图 13" /></p>
<p><strong>下方显示的周数，当前是周二，所以第二个高亮</strong></p>
<blockquote class="spoiler warning">
<p> 说明：如果你根据代码操作运行不起来，可以下载👉<a href="https://gitee.com/laoguaige/esp32-s3-r8-n8-pixel-clock/tree/master/example/LEDMatrix"  target="_blank">例程</a>看看</p>
</blockquote>

                        
                    </div>
                </div>
                <div id="previous_next">
                    <div id="previous">
                        
                        <a href="/diy/picxel-clock/dht11.html">
                            <span class="icon"></span>
                            <span class="label">3. 温湿度采集</span>
                        </a>
                        
                    </div>
                    <div id="next">
                        
                        <a href="/diy/picxel-clock/ntptime.html">
                            <span class="label">5. 获取网络时间</span>
                            <span class="icon"></span>
                        </a>
                        
                    </div>
                </div>
                <div id="comments-container"></div>
            </div>
            <div id="toc_wrapper">
                <div id="toc">
                    <div id="toc_content">
                            
                    </div>
                </div>
            </div>
        </div>
    </div>
    <a id="to_top" href="#"></a>
    <div id="doc_footer">
        <div id="footer">
            <div id="footer_top">
                <ul>
<li><a>链接</a><ul><li><a target="_blank" href="https://github.com/teedoc/teedoc">本网站使用 teedoc 构建</a></li>
</ul>
</li>
<li><a>站长</a><ul><li><a target="_blank" href="https://laoguaige.github.io/">老怪鸽</a></li>
<li><a>邮箱: liguoyi@hdochub.cn</a>
</li>
</ul>
</li>
<li><a>源码</a><ul><li><a target="_blank" href="https://github.com/LaoGuaiGe/laoguaige.github.io">本站源文件</a></li>
</ul>
</li>
</ul>

            </div>
            <div id="footer_bottom">
                <ul>
<li><a target="_blank" href="https://laoguaige.github.io/">Copyright © 2024 Hdochub</a></li>
</ul>

            </div>
        </div>
    </div>
    
        <script src="/teedoc-plugin-markdown-parser/mermaid.min.js"></script>
    
        <script>mermaid.initialize({startOnLoad:true});</script>
    
        <script src="/static/js/theme_default/tocbot.min.js"></script>
    
        <script src="/static/js/theme_default/main.js"></script>
    
        <script src="/static/js/theme_default/viewer.min.js"></script>
    
        <script src="/static/css/theme_default/prism.min.js"></script>
    
        <link rel="stylesheet" href="/static/js/add_hint/style.css" type="text/css"/>
    
        <script src="/static/js/add_hint/main.js"></script>
    
        <script src="/static/js/gitalk/gitalk.min.js"></script>
    
        <script src="/static/js/gitalk/main.js"></script>
    
        <script src="/static/js/custom.js"></script>
    
        <script src="/static/js/search/search_main.js"></script>
    
</body>

</html>