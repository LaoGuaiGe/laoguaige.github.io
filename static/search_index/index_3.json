{"/diy/wiki-web/basic.html":{"title":"wikiç½‘ç«™æ­å»º","content":" title: wikiç½‘ç«™æ­å»º keywords: keyword1, keyword2 desc: description for this article show_source: false update: date: 2024 12 05 author: è€æ€ªé¸½ version: 1.0.1 content: æ›´æ–°äº†åŸºæœ¬æ–‡æ¡£ ## åŸºæœ¬æ¶æ„ ä½¿ç”¨ teedocæ¡†æ¶æ­å»ºï¼Œä½¿ç”¨githubçš„pageséƒ¨ç½²è€Œæˆã€‚ ## teedocä»‹ç» **ç®€è€Œå…¨çš„å¼€æºé™æ€ç½‘ç«™/æ–‡æ¡£/åšå®¢ç”Ÿæˆå™¨** 1. ä½¿ç”¨ Markdown æˆ–è€… jupyter notebook ä¹¦å†™ï¼Œè‡ªåŠ¨ç”Ÿæˆ HTML é¡µé¢ 2. ä½¿ç”¨ python ç¼–å†™ï¼Œ è·¨å¹³å°ï¼Œ ä½¿ç”¨ pip å³å¯å®‰è£…ï¼Œ æ”¯æŒæ’ä»¶å®‰è£…åŠè‡ªå®šä¹‰æ’ä»¶ 3. æ”¯æŒå¤šæ–‡æ¡£ï¼Œæ¯ç¯‡æ–‡æ¡£æœ‰å•ç‹¬çš„ç›®å½•ï¼Œä¹Ÿå¯ä»¥å¤šç‰ˆæœ¬ã€‚ä½ çš„å¤§é‡æ–‡æ¡£å†ä¹Ÿä¸ç”¨æ•£è½åœ¨å„ä¸ªåŸŸåä¸‹äº†ï¼åŒæ—¶æ”¯æŒè½»é‡åšå®¢ç³»ç»Ÿ 4. é»˜è®¤ä¸»é¢˜ä¸ºé«˜æ•ˆé˜…è¯»è€Œè®¾è®¡ï¼Œæä¾›ä¸»é¢˜æ’ä»¶æ”¯æŒï¼ŒåŒæ—¶æ”¯æŒè‡ªå®šä¹‰ cssã€jsï¼Œèƒ½é€šè¿‡é¡µé¢æŒ‡å®š id ç²¾ç¡®æ§åˆ¶ä»»ä½•ä¸€ä¸ªé¡µé¢å…ƒç´ çš„æ ·å¼ 5. å¹¶è¡Œæ„å»ºï¼Œå……åˆ†åˆ©ç”¨å¤„ç†å™¨æ€§èƒ½ï¼Œæ–‡æ¡£æ¸²æŸ“å°±åœ¨ä¸€ç¬é—´ï¼Œæ”¯æŒæµè§ˆå™¨å®æ—¶é¢„è§ˆä¿®æ”¹ 6. ç”Ÿæˆçš„éƒ½æ˜¯é™æ€é¡µé¢ï¼Œæ‹·è´åˆ°æœåŠ¡å™¨å³å¯å®Œæˆéƒ¨ç½²ï¼ŒSEO å‹å¥½ï¼Œæ¯”å¦‚ é¡µå…³é”®è¯è‡ªå®šä¹‰ã€sitemapè‡ªåŠ¨ç”Ÿæˆç­‰ ## teedocç›¸å…³èµ„æ–™ å®˜ç½‘: teedoc.neucrack.com æˆ– teedoc.github.io æœ¬æ–‡æ¡£æºæ–‡ä»¶: github.com/teedoc/teedoc.github.io æºç : https://github.com/teedoc/teedoc å¦‚æœä½ å–œæ¬¢è¿™ä¸ªé¡¹ç›®ï¼Œè¯·åŠ¡å¿…ç™»å½• github ç»™é¡¹ç›®ç‚¹ä¸ª star ä»¥ä¸‹åœºæ™¯å¯ä½¿ç”¨teedocï¼š * å»ºæ–‡æ¡£ç½‘ç«™ï¼Œå¹¶ä¸”æœ€å¥½æ”¯æŒæ”¾å¤šä»½æ–‡æ¡£ï¼ˆæ¯”å¦‚ä½ æœ‰ä¸€æœ¬å«Pythonå­¦ä¹ å’ŒC++å­¦ä¹ ä¸¤æœ¬ä¹¦ï¼Œå®ƒä»¬éƒ½æœ‰å•ç‹¬çš„ç›®å½•, teedocåˆ™æ˜¯ä¹¦åº“ï¼‰ * æ–‡æ¡£å’Œç½‘é¡µé¡µé¢å…±å­˜ï¼Œæ”¯æŒè‡ªå®šä¹‰HTMLé¡µé¢ * å»ºWiKiç½‘ç«™ * å»ºä¸ªäººæˆ–è€…ä¼ä¸šçŸ¥è¯†åº“ * å»ºä¸ªäººæˆ–è€…ä¼ä¸šç½‘ç«™ * åšå®¢ ## ä½¿ç”¨teedocçš„ä¼ä¸šæ¡ˆä¾‹ ç½‘ç«™ ç®€ä»‹ ç«™ç‚¹æºæ–‡æ¡£ [teedoc å®˜ç½‘](https://teedoc.github.io) å¥½ç”¨çš„æ–‡æ¡£ç½‘ç«™ç”Ÿæˆå·¥å…· [teedoc/teedoc.github.io](https://github.com/teedoc/teedoc.github.io) [MaixPy](https://maixpy.sipeed.com) è¾¹ç¼˜ AI è®¡ç®— Python SDK [sipeed/MaixPy_DOC](https://github.com/sipeed/MaixPy_DOC) [Sipeed Wiki](https://wiki.sipeed.com) Sipeed å®˜æ–¹Wiki [sipeed/sipeed_wiki](https://github.com/sipeed/sipeed_wiki) [teedoc.github.io/re0 web teedoc/](https://teedoc.github.io/re0 web teedoc/) ä» gitbook è½¬åˆ° teedoc çš„ç¤ºä¾‹ç½‘ç«™ [teedoc/re0 web teedoc](https://github.com/teedoc/re0 web teedoc) [QuecPython](https://python.quectel.com/doc/) QuecPython æ–‡æ¡£ä¸­å¿ƒ [gitee](https://gitee.com/quecpython/Community document) [github](https://github.com/quecpython/Community document) [BPI Steam Doc](https://bpi steam.com/) BananaPi, Steamå›¢é˜Ÿçš„æ–‡æ¡£ï¼ˆWikiï¼‰ï¼ŒåŒ…å«äº†å¼€æºè½¯ä»¶å’Œå¼€æºç¡¬ä»¶èµ„æ–™ï¼ŒAIOTèµ„æ–™ç­‰ç­‰ [BPI STEAM/BPI Doc](https://github.com/BPI STEAM/BPI Doc) [udbg](https://udbg.github.io/) åŸºäºLuaçš„äºŒè¿›åˆ¶è°ƒè¯•/åˆ†æå·¥å…· [udbg/udbg.github.io](https://github.com/udbg/udbg.github.io) [VastUtils](https://sakurajimamaii.github.io/VastDocs/) ä¸€æ¬¾åŠ å¿«ä½ å®‰å“å¼€å‘çš„å®‰å“å·¥å…·é›† [SakurajimaMaii/VastDocs](https://github.com/SakurajimaMaii/VastDocs) æœŸå¾…ä½ çš„ä½¿ç”¨ï¼Œ æ¬¢è¿[æäº¤ issue](https://github.com/teedoc/teedoc.github.io/issues) æˆ–è€… PR æ¥æ·»åŠ ä½ çš„ç½‘ç«™ ## å¿«é€Ÿæ­å»ºwikiç½‘ç«™ ### å®‰è£… python3 éœ€è¦å…ˆå®‰è£…Python3 ï¼ˆä»…æ”¯æŒ Python3ï¼‰ æ¯”å¦‚åœ¨Ubuntuä¸Šï¼š ```sh sudo apt install python3 python3 pip git ``` Windows å’Œ macOSè¯·åˆ°[å®˜ç½‘ä¸‹è½½](https://www.python.org/downloads/) ### å®‰è£… teedoc æ‰“å¼€ç»ˆç«¯(WindowsæŒ‰Ctrl+Rè¾“å…¥cmd)ï¼Œè¾“å…¥ï¼š ```sh pip3 install teedoc ``` ä»¥åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ›´æ–°è½¯ä»¶ï¼š ```sh pip3 install teedoc upgrade ``` å¦‚æœä½ çš„ç½‘ç»œä½¿ç”¨ pypi.org é€Ÿåº¦å¾ˆæ…¢ï¼Œå¯ä»¥é€‰æ‹©å…¶å®ƒæºï¼Œæ¯”å¦‚æ¸…å tuna æºï¼š `pip3 install teedoc i https://pypi.tuna.tsinghua.edu.cn/simple` ç°åœ¨ä½ å¯ä»¥åœ¨ç»ˆç«¯ä½¿ç”¨ `teedoc` å‘½ä»¤äº† å¦‚æœä¸èƒ½ï¼Œè¯·æ£€æŸ¥æ˜¯ä¸æ˜¯`Python`å¯æ‰§è¡Œç›®å½•æ²¡æœ‰åŠ å…¥åˆ°ç¯å¢ƒå˜é‡ `PATH`, æ¯”å¦‚å¯èƒ½åœ¨ `~/.local/bin` ### æ–°å»ºå·¥ç¨‹ æ–°å»ºä¸€ä¸ªç©ºç›®å½•ç”¨æ¥æ”¾æ–‡æ¡£å·¥ç¨‹ ```sh mkdir my_site cd my_site teedoc init ``` é€‰æ‹©1ï¼Œä¹Ÿå°±æ˜¯minimalæ¨¡æ¿è¿›è¡Œç”Ÿæˆï¼Œ ä¹Ÿå¯ä»¥ç›´æ¥`teedoc d my_site template minimal init`è¿›è¡Œç”Ÿæˆ è¿™ä¼šåœ¨ `my_site` ç›®å½•ä¸‹è‡ªåŠ¨ç”Ÿæˆä¸€äº›åŸºç¡€æ–‡ä»¶ ### å®‰è£…æ’ä»¶ è¿™ä¼šæ ¹æ®`site_config.json`ä¸­çš„`plugins`çš„æ’ä»¶è®¾ç½®å®‰è£…æ’ä»¶ ```sh cd my_site teedoc install ``` æ’ä»¶ä¹Ÿæ˜¯ä»¥ `python` åŒ…çš„å½¢å¼å‘å¸ƒçš„ï¼Œ æ‰€ä»¥è¿™ä¼šä» `pypi.org` ä¸‹è½½å¯¹åº”çš„æ’ä»¶ï¼ŒåŒæ ·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶å®ƒæºï¼Œæ¯”å¦‚æ¸…å tuna æºï¼š `teedoc i https://pypi.tuna.tsinghua.edu.cn/simple install` ### æ„å»º `HTML` é¡µé¢å¹¶èµ·ä¸€ä¸ª`HTTP`æœåŠ¡ ```sh teedoc serve ``` è¿™ä¸ªå‘½ä»¤ä¼šå…ˆæ„å»ºæ‰€æœ‰`HTML`é¡µé¢ä»¥åŠæ‹·è´èµ„æºæ–‡ä»¶ï¼Œç„¶åèµ·ä¸€ä¸ª`HTTP`æœåŠ¡ å¦‚æœåªéœ€è¦ç”Ÿæˆé¡µé¢ï¼Œä½¿ç”¨ ```sh teedoc build ``` åœ¨æ˜¾ç¤º `Starting server at 0.0.0.0:2333 ....` åï¼Œå°±å¯ä»¥äº† æ‰“å¼€æµè§ˆå™¨è®¿é—®: `http://127.0.0.1:2333` åŒæ—¶å¯ä»¥çœ‹åˆ°ç›®å½•ä¸‹å¤šäº†ä¸€ä¸ª`out`ç›®å½•ï¼Œé‡Œé¢å°±æ˜¯ç”Ÿæˆçš„é™æ€ç½‘ç«™å†…å®¹ï¼Œç›´æ¥æ‹·è´åˆ°æœåŠ¡å™¨ä½¿ç”¨`nginx`æˆ–è€…`apache`è¿›è¡Œéƒ¨ç½²å³å¯"},"/diy/picxel-clock/hardware.html":{"title":"ç¡¬ä»¶è®¾è®¡","content":" title: ç¡¬ä»¶è®¾è®¡ keywords: keyword1, keyword2 desc: description for this article show_source: false update: date: 2024 12 05 author: è€æ€ªé¸½ version: 1.0.1 content: æ›´æ–°äº†åŸºæœ¬æ–‡æ¡£ ## æ•´ä½“åŸç†å›¾ ![å›¾ 0](../../static/images/docs/diy/picxel clock/hardware/hardware 2024 12 06 00 32 53.png) ## ç¡¬ä»¶è®¾è®¡ ### ç”µæºéƒ¨åˆ† ç¬¬ä¸€ç‰ˆæ—¶ï¼Œä½¿ç”¨ FM5324G ä½œä¸ºæ§åˆ¶ã€‚å®ƒæ˜¯ä¸€ä¸ªé›†æˆäº†é”‚ç”µæ± å……ç”µç®¡ç†ï¼Œç”µæ± 5Vå‡å‹è¾“å‡ºï¼Œç”µæ± ç”µé‡åˆ¤æ–­å’Œ LED ç”µé‡æŒ‡ç¤ºçš„é›†æˆç”µæºç®¡ç† ICã€‚ ![å›¾ 1](../../static/images/docs/diy/picxel clock/hardware/hardware 2024 12 06 00 33 12.png) **ä½†æ˜¯å‘ç°ä½¿ç”¨ä¸€ä¸ª800mAhçš„ç”µæ± ï¼Œå¼€ä¸ª10åˆ†é’Ÿå°±æ²¡ç”µäº†ï¼Œç›´æ¥èˆå¼ƒç”µæºç®¡ç†éƒ¨åˆ†ï¼Œç›´æ¥é€šè¿‡TYPE Cæ¥å£è¿›è¡Œä¾›ç”µã€‚** å½“å‰ç‰ˆï¼š ![å›¾ 3](../../static/images/docs/diy/picxel clock/hardware/hardware 2024 12 06 00 33 27.png) é¦–å…ˆï¼Œå› ä¸ºè¯­éŸ³æ¨¡å—éœ€è¦æœ‰ä¸€ä¸ªä¸‹è½½è®¾å¤‡ï¼Œè¿™é‡Œç›´æ¥å°†TYPE Cæ¥å£çš„æ•°æ®æ¥å£æ¥åˆ°äº†ä¸€ä¸ªCH340Nï¼ˆå›¾ä¸­çš„U9ï¼Œç¼–å·C2977777ï¼‰çš„å™¨ä»¶ä¸Šã€‚æ¥ä¸‹æ¥å¯¹å„ä¸ªå™¨ä»¶è¿›è¡Œè¯´æ˜ã€‚ 1. R56å’ŒR57æ˜¯USBåè®®ä¸Šè¦æ±‚çš„ï¼Œå¿…é¡»æ˜¯5.1Kï¼Œæ¶‰åŠåˆ°PDè¯±éª—ç”µå‹è¾“å‡ºï¼Œå…·ä½“åŸå› è‡ªè¡Œç™¾åº¦ã€‚ 2. D8å’ŒD7æ˜¯ESDä¿æŠ¤å™¨ä»¶ï¼Œé˜²æ­¢é™ç”µçš„ï¼Œé˜²æ­¢é™ç”µæŸååçº§è®¾å¤‡ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨è¿™äº›å™¨ä»¶ã€‚ 3. VBUSé€šè¿‡ä¸€ä¸ªçŸ­æ¥ç¬¦å·è¿æ¥åˆ°äº†5Vï¼Œè¯´æ˜è¿™ä¸ªTYPE Cè¾“å…¥çš„æ˜¯5Vï¼Œæ˜¯æˆ‘çš„ä¸ªäººä¹ æƒ¯ï¼Œé€šå¸¸å¯ä»¥ç›´æ¥åœ¨USBå¤„æ ‡è®°5Vã€‚ 4. U9å°±æ˜¯ä¹‹å‰è¯´çš„CH340Nï¼Œçœ‹[æ•°æ®æ‰‹å†Œ](https://atta.szlcsc.com/upload/public/pdf/source/20230530/6E401E9554E9F5311886CC8B3F89B62E.pdf)ï¼Œæ˜¯ä¸€ä¸ªå°†USB è½¬ä¸²å£çš„èŠ¯ç‰‡ï¼Œè€Œæˆ‘ä»¬çš„è¯­éŸ³è¯†åˆ«æ¨¡å—å°±æ˜¯é€šè¿‡ä¸²å£ä¸‹è½½ã€‚ 5. C26å’ŒC27ï¼Œé¦–å…ˆæ˜¯C26ï¼Œåœ¨CH340Nçš„æ•°æ®æ‰‹å†Œä¸­æŒ‡å‡ºï¼šå½“CH340Nçš„ç”µå‹è¾“å…¥ä¸º5Væ—¶ï¼Œå¿…é¡»åœ¨V3å¼•è„šå¤„å¤–æ¥ä¸€ä¸ª100nfçš„ç”µå®¹ï¼›VCCå¤„å°½é‡åŠ ä¸€ä¸ª100NFçš„ç”µå®¹ã€‚ 6. R27å’ŒD1ï¼Œæ ¹æ®CH340Nçš„å‚å®¶è¯´æ˜ï¼Œä¸ºäº†é˜²æ­¢ä¸CH340Né€šä¿¡çš„è®¾å¤‡ï¼Œé€šè¿‡RXDå’ŒTXDå¼•è„šå°†ç”µå‹åå……ç»™CH340ï¼Œå»ºè®®åœ¨RXDå¼•è„šä¸Šæ¥å…¥ä¸€ä¸ªé™æµç”µé˜»ï¼ŒTXDä¸Šæ¥ä¸€ä¸ªåå‘äºŒæç®¡ï¼Œé˜²æ­¢ç”µæµç”µå‹å€’çŒã€‚ 7. D2ä¹Ÿæ˜¯ä¸€ä¸ªESDå™¨ä»¶ï¼Œé˜²æ­¢ç±»ä¼¼é›·å‡»ï¼Œé™ç”µç­‰å¯¼è‡´çš„ç¬é—´é«˜å‹æŸåè®¾å¤‡ï¼ŒåŠ å…¥ESDå™¨ä»¶åï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢ç¬é—´çš„é«˜å‹å°†è®¾å¤‡çƒ§æ¯ã€‚ **æ€»ç»“ï¼šå°±æ˜¯ä¸€ä¸ªé€šè¿‡USBä¾›ç”µçš„åŒæ—¶ï¼Œè¿˜å¯ä»¥é€šè¿‡USBç»™è¯­éŸ³æ¨¡å—ä¸‹è½½è¯­éŸ³è¯†åˆ«çš„å›ºä»¶** ### ä¸»æ§éƒ¨åˆ† ä½¿ç”¨ç«‹åˆ›å¼€å‘æ¿çš„[ç«‹åˆ›Â·ESP32S3R8N8å¼€å‘æ¿](https://lckfb.com/project/detail/lckfb esp32s3r8n8?param baseInfo)ã€‚ ![å›¾ 4](../../static/images/docs/diy/picxel clock/hardware/hardware 2024 12 06 00 33 56.png) æ²¡å•¥å¥½è¯´çš„ï¼Œå°±æ˜¯ç»™å¼€å‘æ¿ä¾›ç”µ5Vå°±å¥½ï¼Œå¼€å‘æ¿ä¸Šæœ‰LDOï¼Œè¾“å…¥5Våå¼€å‘æ¿ä¼šè¾“å‡º3V3ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œæˆ‘å°±æ˜¯BOTå¼•è„šç”¨æ¥æ¥äº†æŒ‰é”®ï¼Œæ–¹ä¾¿åœ¨è°ƒè¯•å‡ºç°æ•…éšœæ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿›å…¥å‡çº§æ¨¡å¼ï¼Œæ“¦é™¤å†…å­˜ã€‚ ### RTCæ—¶é’Ÿéƒ¨åˆ† ä½¿ç”¨å¸¸è§çš„ä¸€ä¸ªRTCæ—¶é’Ÿæ¨¡å—DS1302ã€‚ç‰¹ç‚¹å¦‚ä¸‹ï¼š ![å›¾ 5](../../static/images/docs/diy/picxel clock/hardware/hardware 2024 12 06 00 34 02.png) åŸç†å›¾è®¾è®¡ ![å›¾ 6](../../static/images/docs/diy/picxel clock/hardware/hardware 2024 12 06 00 34 07.png) DS1302éœ€è¦å¤–éƒ¨æ¥ä¸€ä¸ª32.768KHzçš„æ™¶æŒ¯ä½œä¸ºæ—¶é’Ÿï¼Œå°±æ˜¯å›¾ä¸­çš„X1å™¨ä»¶ã€‚è€Œæ™¶æŒ¯ä¸ºäº†æ›´åŠ çš„ç¨³å®šç²¾ç¡®ï¼Œéœ€è¦åœ¨æ™¶æŒ¯çš„è¾“å…¥è¾“å‡ºåŠ ä¸Šè´Ÿè½½ç”µå®¹ï¼Œæ ¹æ®é‚£ä¸ªæ™¶æŒ¯çš„æ‰‹å†Œè¯´æ˜ï¼ŒåŠ äº†12pfçš„è´Ÿè½½ç”µå®¹ï¼Œå°±æ˜¯å›¾ä¸­çš„C8C9ã€‚VCC1æ˜¯å¤‡ç”¨ç”µæ± çš„ç”µæºè¾“å…¥å£ï¼Œå¦‚æœæƒ³è¦åœ¨è®¾å¤‡æ–­ç”µçš„æƒ…å†µä¸‹ï¼ŒDS1302è¿˜èƒ½å¤Ÿè·‘æ—¶ï¼Œé‚£ä¹ˆå¿…é¡»æ¥å…¥è¿™ä¸ªB1ç”µæ± åº§ï¼Œè¿™ä¸ªç”µæ± åº§æ˜¯æ¥çš„çº½æ‰£ç”µæ± ã€‚C7å•çº¯æ˜¯æ»¤æ³¢ç”¨ã€‚DS1302çš„å…¶ä»–å¼•è„šå°±æ˜¯æ§åˆ¶å¼•è„šäº†ï¼Œå°†å…¶æ¥åˆ°å¼€å‘æ¿å¼•è„šä¸Šï¼Œæ–¹ä¾¿å¼€å‘æ¿æ§åˆ¶ã€‚ ### æ¸©æ¹¿åº¦é‡‡é›†éƒ¨åˆ† åˆæ˜¯ä½¿ç”¨å¸¸è§çš„ä¸€ä¸ªæ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨DHT11ã€‚ç‰¹ç‚¹å¦‚ä¸‹ï¼š ![å›¾ 7](../../static/images/docs/diy/picxel clock/hardware/hardware 2024 12 06 00 34 13.png) åŸç†å›¾è®¾è®¡ ![å›¾ 8](../../static/images/docs/diy/picxel clock/hardware/hardware 2024 12 06 00 34 18.png) DHT11åœ¨æ•°æ®å¼•è„šDATAä¸Šï¼Œå¿…é¡»åŠ ä¸€ä¸ªä¸Šæ‹‰ç”µé˜»ï¼Œè®©DHT11åœ¨ç©ºé—²æ—¶ä¿æŒé«˜ç”µå¹³ã€‚æ ¹æ®å®ƒçš„æ•°æ®æ‰‹å†Œï¼Œè¿™ä¸ªä¸Šæ‹‰ç”µé˜»å°±é€‰æ‹©äº†4.7Kçš„R12ã€‚ç„¶åDHT11æ˜¯æ”¯æŒ3.3V~5Vçš„ç”µå‹è¾“å…¥çš„ï¼Œè¿™é‡Œå› ä¸ºå¼€å‘æ¿æ˜¯3V3çš„GPIOç”µå‹ï¼Œæ‰€ä»¥ä¸ºäº†é€šä¿¡ç¨³å®šï¼Œç»™DHT11çš„æ•°æ®å¼•è„šDATAçš„ä¹Ÿä¿æŒ3.3Vï¼Œç»™DHT11çš„è¾“å…¥ç”µå‹ä¸º3.3Vã€‚ ### WS2812å½©ç¯çŸ©é˜µéƒ¨åˆ† è¿™é‡Œè´­ä¹°çš„æ˜¯æ·˜å®ä¸Šå–``36å…ƒ``çš„ 32 * 8 åƒç´ çš„å½©ç¯çŸ©é˜µï¼š[WS2812Bå…¨å½©è½¯åƒç´ å±8X8 8X32 16X16å¹»å½©5Væ˜¾ç¤ºå¯ç¼–ç¨‹åƒç´ è½¯å±](https://item.taobao.com/item.htm?_u n2t4uge597e5&amp;id 737696448369&amp;skuId 5263566850408&amp;spm a1z09.2.0.0.17c22e8d4Z2Du3) ![å›¾ 9](../../static/images/docs/diy/picxel clock/hardware/hardware 2024 12 06 00 34 25.png) åŸç†å›¾è®¾è®¡ï¼š ![å›¾ 10](../../static/images/docs/diy/picxel clock/hardware/hardware 2024 12 06 00 34 32.png) WS2812æ˜¯ä¸€ä¸ªå•æ€»çº¿çš„è®¾å¤‡ï¼Œæ¯ä¸€ä¸ªç¯ç é‡Œé¢éƒ½å¸¦äº†é©±åŠ¨ç”µè·¯ï¼Œå¯ä»¥åŒæ—¶æ§åˆ¶å¾ˆå¤šä¸ªç¯ï¼Œä½†æ˜¯ä¸ºäº†ä»¥é˜²ä¸‡ä¸€ï¼Œåœ¨è¿™ä¸ªWS2812å½©ç¯çŸ©é˜µçš„ç”µæºè¾“å…¥å£VCCå¤„ï¼ŒåŠ äº†ä¸€ä¸ª1000UFçš„ç”µå®¹ï¼Œé˜²æ­¢å½©ç¯çŸ©é˜µäº®çš„ç¬é—´ç”µå‹ç”µæµä¸è¶³ï¼ŒåŠ äº†ç”µå®¹ä¹‹åï¼Œå¦‚æœå‡ºç°ç”µå‹ç”µæµä¸è¶³çš„æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥ä»è¿™ä¸ªå¤§ç”µå®¹å–ç”µã€‚ ### éŸ³é¢‘é‡‡é›†éƒ¨åˆ† å…³äºæ¨¡æ‹Ÿä¿¡å·ç±»æˆ‘ä¸å¤ªäº†è§£ï¼Œè¿™é‡Œæ˜¯å‚è€ƒçš„ä¸€ä¸ªéŸ³é¢‘é‡‡é›†æ¨¡å—çš„ç”µè·¯ï¼š``MAX4466éŸ³é¢‘é‡‡é›†æ¨¡å—``ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹ç›´æ¥ä¸Šæ·˜å®æœç´¢å°±å¥½ã€‚ ![å›¾ 11](../../static/images/docs/diy/picxel clock/hardware/hardware 2024 12 06 00 34 41.png) åŸç†å›¾è®¾è®¡ï¼š ![å›¾ 12](../../static/images/docs/diy/picxel clock/hardware/hardware 2024 12 06 00 34 45.png) ### æŒ‰é”®éƒ¨åˆ† åœ¨è½¯ä»¶éƒ¨åˆ†å½“ä¸­ä½¿ç”¨ä¸€ä¸ªæŒ‰é”®å»æ§åˆ¶UIç•Œé¢çš„åˆ‡æ¢ã€‚ä½†æ˜¯å½“å‰æˆ‘è™½ç„¶ç”¨ä¸Šäº†æŒ‰é”®ï¼Œç»“æœæˆ‘çš„å¤–å£³éƒ¨åˆ†æ²¡æœ‰åšå¥½ï¼Œå¯¼è‡´æˆ‘ç°åœ¨åˆ‡æ¢ç•Œé¢çš„æ‹†å¼€å¤–å£³å»æŒ‰æŒ‰é”®... å¤§å®¶ç­‰æˆ‘å®Œå–„æˆ–è€…å¤åˆ»çš„æ—¶å€™è‡ªè¡Œå®Œå–„å°±å¥½ã€‚ åŸç†å›¾è®¾è®¡ï¼š ![å›¾ 13](../../static/images/docs/diy/picxel clock/hardware/hardware 2024 12 06 00 34 51.png) ## å¤–å£³éƒ¨åˆ† >! ä¸‹è½½åœ°å€ï¼šhttps://gitee.com/laoguaige/esp32 s3 r8 n8 pixel clock/tree/master/3Dfile ### 3Dæ–‡ä»¶è¯´æ˜ **å› ä¸ºå®ç‰©å¾ˆå¤§ï¼Œæ‰“å°çš„å¤–å£³éœ€è¦åˆ†å¼€ï¼Œåˆ†å·¦å³ä¸¤è¾¹ã€‚** LEDGrid2x.stl ä¸ºå…‰æ ï¼Œéœ€è¦ä¸€ä¸ªéƒ¨ä»¶æ‰“ä¸¤ä¸ªï¼Œæ‹¼åˆ°ä¸€èµ·ï¼› > è¯´æ˜ï¼šå…‰æ ä¸€å®šè¦**é»‘è‰²çš„æè´¨ï¼Œä¸ç®¡æ˜¯3Dæ‰“å°æ—¶é€‰æ‹©é»‘è‰²çš„ææ–™è¿˜æ˜¯åé¢æ”¶åˆ°å–·é»‘æ¼†ï¼Œä¸€å®šè®°å¾—ä½¿ç”¨é»‘è‰²çš„å…‰æ ï¼ä¸ç„¶è§‚æ„Ÿå°±å·®å¾ˆå¤š** ![å›¾ 0](../../static/images/docs/diy/picxel clock/download/download 2024 12 05 22 32 35.png) frontFrame2x.stl ä¸ºå¤–å£³è¾¹æ¡†ï¼Œéœ€è¦ä¸€ä¸ªéƒ¨ä»¶æ‰“ä¸¤ä¸ªï¼Œæ‹¼åˆ°ä¸€èµ·ï¼› ![å›¾ 1](../../static/images/docs/diy/picxel clock/download/download 2024 12 05 22 32 50.png) Housing.stl å’Œ Housing_noV.stl ä¸ºåŒä¸€ä¸ªéƒ¨ä»¶ï¼Œé€‰æ‹©ä¸€ä¸ªè¿›è¡Œæ‰“å°å³å¯ï¼Œéƒ½æ˜¯æˆæœ¬è¾ƒé«˜ï¼Œé…Œæƒ…æ‰“å°ï¼› ![å›¾ 2](../../static/images/docs/diy/picxel clock/download/download 2024 12 05 22 32 57.png) å¦‚è¦ç»„å»ºå®Œæ•´çš„å¤–å£³ï¼Œè¿˜éœ€è¦è´­ä¹°é»‘è‰²çš„äºšå…‹åŠ›é€æ˜é¢æ¿ï¼ ``ç”Ÿäº§çš„è§„æ ¼å‚æ•°ï¼šé»‘èŒ¶è‰² é€æ˜äºšå…‹åŠ› 95Ã—330Ã—2mm`` ## é¡¹ç›®å±•ç¤º ### é™æ€å›¾ ![å›¾ 14](../../static/images/docs/diy/picxel clock/hardware/hardware 2024 12 06 00 36 12.png) ### åŠ¨æ€å›¾ ![å›¾ 15](../../static/images/docs/diy/picxel clock/hardware/hardware 2024 12 06 00 36 36.gif) ![å›¾ 16](../../static/images/docs/diy/picxel clock/hardware/hardware 2024 12 06 00 36 45.gif) ![å›¾ 17](../../static/images/docs/diy/picxel clock/hardware/hardware 2024 12 06 00 36 54.gif) ![å›¾ 18](../../static/images/docs/diy/picxel clock/hardware/hardware 2024 12 06 00 37 07.gif) ![å›¾ 19](../../static/images/docs/diy/picxel clock/hardware/hardware 2024 12 06 00 37 16.gif)"},"/diy/picxel-clock/ntptime.html":{"title":"è·å–ç½‘ç»œæ—¶é—´","content":" title: è·å–ç½‘ç»œæ—¶é—´ keywords: keyword1, keyword2 desc: description for this article show_source: false update: date: 2024 12 05 author: è€æ€ªé¸½ version: 1.0.1 content: æ›´æ–°äº†åŸºæœ¬æ–‡æ¡£ ## NTPä»‹ç» NTPç½‘ç»œæ—¶é—´åè®®ï¼ˆNetwork Time Protocolï¼ŒNTPï¼‰ï¼Œæ˜¯ä¸€ç§ç”¨äºåœ¨è®¡ç®—æœºç½‘ç»œä¸ŠåŒæ­¥æ—¶é—´çš„åè®®ã€‚å®ƒé€šè¿‡åœ¨æ—¶é—´æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´äº¤æ¢æ—¶é—´ä¿¡æ¯æ¥ç¡®ä¿ç½‘ç»œä¸­çš„è®¡ç®—æœºæ—¶é’Ÿä¿æŒå‡†ç¡®çš„æ—¶é—´åŒæ­¥ã€‚ä»¥ä¸‹æ˜¯NTPçš„ä¸€äº›å…³é”®ç‰¹æ€§ï¼š **ç‰¹ç‚¹** **ç²¾ç¡®æ€§ï¼š** NTPèƒ½å¤Ÿæä¾›éå¸¸é«˜çš„æ—¶é—´åŒæ­¥ç²¾åº¦ï¼Œé€šå¸¸åœ¨æ¯«ç§’çº§ï¼Œç”šè‡³å¯ä»¥è¾¾åˆ°å¾®ç§’çº§ã€‚ **å¯æ‰©å±•æ€§ï¼š** NTPè®¾è®¡ç”¨äºåœ¨å¹¿æ³›çš„ç½‘ç»œç¯å¢ƒä¸­å·¥ä½œï¼Œä»å±€åŸŸç½‘åˆ°å¹¿åŸŸç½‘ï¼Œå¯ä»¥æ”¯æŒå¤§é‡å®¢æˆ·ç«¯ã€‚ **åˆ†å±‚ç»“æ„ï¼š** NTPé‡‡ç”¨å±‚çº§åŒ–çš„æ—¶é—´åŒæ­¥æ¶æ„ï¼Œæ—¶é—´ä¿¡æ¯ä»é«˜ç²¾åº¦çš„å‚è€ƒæ—¶é’Ÿæºé€šè¿‡å¤šä¸ªæ—¶é—´æœåŠ¡å™¨å±‚ä¼ é€’åˆ°å®¢æˆ·ç«¯ã€‚ **é²æ£’æ€§ï¼š** NTPèƒ½å¤Ÿå¤„ç†ç½‘ç»œå»¶è¿Ÿã€ä¸¢åŒ…å’Œå…¶ä»–ç½‘ç»œé—®é¢˜ï¼Œç¡®ä¿æ—¶é—´åŒæ­¥çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚ **åº”ç”¨** **æœåŠ¡å™¨åŒæ­¥ï¼š** ç¡®ä¿æœåŠ¡å™¨é›†ç¾¤ä¸­çš„æ‰€æœ‰æœåŠ¡å™¨æ—¶é’ŸåŒæ­¥ã€‚ **ç½‘ç»œå®‰å…¨ï¼š** åœ¨ç½‘ç»œå®‰å…¨ä¸­ï¼ŒåŒæ­¥çš„æ—¶é’Ÿå¯¹äºæ—¥å¿—è®°å½•å’Œäº‹ä»¶å…³è”è‡³å…³é‡è¦ã€‚ **åˆ†å¸ƒå¼ç³»ç»Ÿï¼š** åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿå’Œæ•°æ®åº“ä¸­ï¼Œå‡†ç¡®çš„æ—¶é—´åŒæ­¥æœ‰åŠ©äºç»´æŠ¤æ•°æ®ä¸€è‡´æ€§å’Œåè°ƒæ“ä½œã€‚ **NTPå¹¿æ³›åº”ç”¨äºäº’è”ç½‘ä¸Šçš„å„ç§è®¾å¤‡å’Œç³»ç»Ÿä¸­ï¼Œæ˜¯ç°ä»£ç½‘ç»œåŸºç¡€è®¾æ–½çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚** > ä»¥ä¸Šæ¥è‡ª chatGPT çš„ä»‹ç» ## ç¡¬ä»¶å‡†å¤‡ å› ä¸ºé¡¹ç›®è¦æœ‰ç½‘ç»œæ—¶é—´æ ¡å‡†åŠŸèƒ½ï¼Œè¦ä½¿ç”¨WIFIè·å–ç½‘ç»œæ—¶é—´è¿›è¡Œæ ¡å‡†ã€‚è¿™é‡Œä½¿ç”¨çš„æ˜¯ESP32S3çš„å¼€å‘æ¿ã€‚ > **è´­ä¹°åœ°å€ï¼š**[ç«‹åˆ›Â·ESP32S3R8N8 å¼€å‘æ¿](https://item.szlcsc.com/22034693.html?fromZone s_s__%2522%25E7%25AB%258B%25E5%2588%259B%25E5%25BC%2580%25E5%258F%2591%25E6%259D%25BF%2522) ![å›¾ 1](../../static/images/docs/diy/picxel clock/ledmatrix/ledmatrix 2024 12 05 23 14 24.png) ## å·¥ç¨‹åˆ›å»º åœ¨VSCodeä¸­æ‰“å¼€PlatformIOæ‰©å±•åˆ›å»ºåä¸º`ntpTime`çš„ `Espressif ESP32 S3 DevKitM 1` å·¥ç¨‹ã€‚ å…³äºè¯¦ç»†å›¾æ–‡åˆ›å»ºå·¥ç¨‹çš„è¿‡ç¨‹è¯·å‚è€ƒğŸ‘‰[RTCæ—¶é’Ÿé©±åŠ¨](ds1302.html)ç« èŠ‚çš„å·¥ç¨‹åˆ›å»ºå°èŠ‚ã€‚ ## å®‰è£…é©±åŠ¨åº“ åœ¨é©±åŠ¨åº“å®‰è£…ç•Œé¢ï¼Œæœç´¢``NTPClient``ï¼Œå®‰è£…æ¥è‡ª``Fabrice Weinberg`` çš„ ``NTPClient``åº“ã€‚ > å…³äºè¯¦ç»†å›¾æ–‡å®‰è£…é©±åŠ¨åº“çš„è¿‡ç¨‹è¯·å‚è€ƒğŸ‘‰[RTCæ—¶é’Ÿé©±åŠ¨](ds1302.html)ç« èŠ‚çš„å®‰è£…é©±åŠ¨åº“å°èŠ‚ã€‚ å®‰è£…å®Œæˆä¹‹åï¼Œæ‰“å¼€``platformio.ini``æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»å®‰è£…ä¸Šäº†é©±åŠ¨åº“ã€‚ ![å›¾ 1](../../static/images/docs/diy/picxel clock/ntptime/ntptime 2024 12 05 23 43 21.png) ## ç¼–è¾‘ä»£ç  æ‰“å¼€å·¥ç¨‹ä¸‹çš„``src``æ–‡ä»¶å¤¹ä¸‹çš„``main.cpp``ã€‚ è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š ```c #include <Arduino.h> #include <WiFi.h> #include <NTPClient.h> #include <WiFiUdp.h> //è®¾ç½®ä½ è¦ESP32S3è¿æ¥çš„WIFIåç§° #define WIFI_SSID \"lckfb\" //è®¾ç½®ä½ è¦ESP32S3è¿æ¥çš„WIFIå¯†ç  #define WIFI_PASS \"12345678\" // å®šä¹‰NTPæœåŠ¡å™¨ const char* ntpServer \"pool.ntp.org\"; // å®šä¹‰æ—¶åŒºï¼ˆä»¥å°æ—¶ä¸ºå•ä½ï¼Œä¾‹å¦‚ï¼š+1æˆ– 3ï¼‰ const long gmtOffset 8; // å®šä¹‰å¤ä»¤æ—¶ï¼ˆDaylight Saving Timeï¼ŒDSTï¼‰çš„åç§»é‡ï¼ˆé€šå¸¸ä¸º0æˆ–3600ç§’ï¼‰ const int daylightOffset 0; // åˆ›å»ºUDPå®ä¾‹ WiFiUDP ntpUDP; // åˆ›å»ºNTPå®¢æˆ·ç«¯å®ä¾‹ NTPClient timeClient(ntpUDP, ntpServer, gmtOffset * 3600, daylightOffset * 3600); void setup() { //åˆå§‹åŒ–ä¸²å£ Serial.begin(9600); // è¿æ¥åˆ°Wi Fi WiFi.begin(WIFI_SSID, WIFI_PASS); //å¦‚æœæ²¡æœ‰è¿æ¥ä¸Šä¸²å£å°±ä¸€ç›´è¾“å‡º ... //å¦‚æœè¿æ¥ä¸ä¸Šè¯·ç¡®ä¿ä½ è¦è¿æ¥çš„WIFIä¸æ˜¯5Gé¢‘æ®µ! //å¤§éƒ¨åˆ†ESP32ç³»åˆ—éƒ½åªèƒ½è¿æ¥2.4Gé¢‘æ®µ! while (WiFi.status() ! WL_CONNECTED) { delay(500); Serial.print(\".\"); } // å¯åŠ¨NTPå®¢æˆ·ç«¯ timeClient.begin(); // è®¾ç½®æ—¶é—´åŒæ­¥é—´éš”ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ timeClient.setUpdateInterval(60000); // 1åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡ } void loop() { // æ›´æ–°NTPæ—¶é—´ timeClient.update(); if (timeClient.getEpochTime() > 0) { // è·å–æˆåŠŸ unsigned long epochTime timeClient.getEpochTime(); struct tm *ptm gmtime ((time_t *)&epochTime); //å¹´æ˜¯è‡³1900å¹´åå¼€å§‹è®¡ç®—,æ‰€ä»¥æˆ‘ä»¬å®é™…ä½¿ç”¨å¾—+1900 int year ptm >tm_year + 1900; //æœˆæ˜¯ä»0å¼€å§‹ç®—,æ‰€ä»¥æˆ‘ä»¬å®é™…ä½¿ç”¨å¾—+1 int month ptm >tm_mon + 1; int day ptm >tm_mday; int hour ptm >tm_hour; int minute ptm >tm_min; int second ptm >tm_sec; // æ‰“å°æ—¶é—´ Serial.printf(\"%d %02d %02d %02d:%02d:%02d\\n\", year, month, day, hour, minute, second); } else { // è·å–å¤±è´¥ï¼Œå¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œé‡è¯•æˆ–é”™è¯¯å¤„ç† Serial.println(\"Failed to get NTP time\"); } delay(1000); // æ¯1ç§’å°è¯•ä¸€æ¬¡ } ``` ## ä»£ç éªŒè¯ ä»£ç ç¼–å†™å®Œæˆä¹‹åï¼Œå°†ESP32S3å¼€å‘æ¿æ¥å…¥ç”µè„‘ä¸‹è½½ä»£ç ï¼Œç„¶åæ‰“å¼€ä¸²å£ç›‘è§†å™¨æŸ¥çœ‹ç°è±¡ã€‚ > ä¸‹è½½æ­¥éª¤è¯·å‚è€ƒğŸ‘‰[RTCæ—¶é’Ÿé©±åŠ¨](ds1302.html)ç« èŠ‚çš„ä»£ç éªŒè¯å°èŠ‚ã€‚ å®é™…è·å–ç½‘ç»œæ—¶é—´çš„æ•ˆæœå¦‚ä¸‹ï¼š ![å›¾ 2](../../static/images/docs/diy/picxel clock/ntptime/ntptime 2024 12 05 23 44 35.png) **åç»­æˆ‘ä»¬ä½¿ç”¨åˆ°ç¡¬ä»¶çš„RTCæ—¶é’Ÿæ¨¡å—æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡NTPçš„æ–¹å¼è·å–ç½‘ç»œçš„æ—¶é—´è¿›è¡Œæ ¡å‡†äº†ã€‚** >! è¯´æ˜ï¼šå¦‚æœä½ æ ¹æ®ä»£ç æ“ä½œè¿è¡Œä¸èµ·æ¥ï¼Œå¯ä»¥ä¸‹è½½ğŸ‘‰[ä¾‹ç¨‹](https://gitee.com/laoguaige/esp32 s3 r8 n8 pixel clock/tree/master/example/ntpTime)çœ‹çœ‹"},"/diy/picxel-clock/dht11.html":{"title":"æ¸©æ¹¿åº¦è¯»å–","content":" title: æ¸©æ¹¿åº¦è¯»å– keywords: keyword1, keyword2 desc: description for this article show_source: false update: date: 2024 12 05 author: è€æ€ªé¸½ version: 1.0.1 content: æ›´æ–°äº†åŸºæœ¬æ–‡æ¡£ ## å·¥ç¨‹åˆ›å»º åœ¨VSCodeä¸­æ‰“å¼€PlatformIOæ‰©å±•åˆ›å»ºåä¸º`dht11`çš„ `Espressif ESP32 S3 DevKitM 1` å·¥ç¨‹ã€‚ å…³äºè¯¦ç»†å›¾æ–‡åˆ›å»ºå·¥ç¨‹çš„è¿‡ç¨‹è¯·å‚è€ƒğŸ‘‰[RTCæ—¶é’Ÿé©±åŠ¨](ds1302.html)ç« èŠ‚çš„å·¥ç¨‹åˆ›å»ºå°èŠ‚ã€‚ ## å®‰è£…é©±åŠ¨åº“ å¾€å·¥ç¨‹ä¸­å®‰è£…æ¥è‡ª``Adafruit``çš„``DHT sensor library``åº“ã€‚ å¯ä»¥æ‰“å¼€``platformio.ini``æ–‡ä»¶ï¼ŒéªŒè¯å·¥ç¨‹æ˜¯å¦å·²ç»å®‰è£…ä¸Šäº†``DHT11``çš„é©±åŠ¨åº“ã€‚ å…³äºè¯¦ç»†å›¾æ–‡å®‰è£…é©±åŠ¨åº“çš„è¿‡ç¨‹è¯·å‚è€ƒğŸ‘‰[RTCæ—¶é’Ÿé©±åŠ¨](ds1302.html)ç« èŠ‚çš„å®‰è£…é©±åŠ¨åº“å°èŠ‚ã€‚ ## ç¼–è¾‘ä»£ç  æ‰“å¼€å·¥ç¨‹ä¸‹çš„srcæ–‡ä»¶å¤¹ä¸‹çš„main.cppã€‚ è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š ```c #include <Arduino.h> #include <Adafruit_Sensor.h> #include <DHT.h> //æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨é©±åŠ¨åº“ //DHT11æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨ç›¸å…³å®šä¹‰ #define DHTPIN 4 //ä¼ æ„Ÿå™¨å¼•è„šè¿æ¥4 #define DHTTYPE DHT11 //ä¼ æ„Ÿå™¨æ”¯æŒDHT11, DHT12, DHT21, DHT22, AM2301 DHT dht(DHTPIN, DHTTYPE); //åˆå§‹åŒ–æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨ //æ¹¿åº¦ å’Œ æ¸©åº¦ çš„å…¨å±€å˜é‡ float humidity 0, temperature 0; //æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨æ•°å€¼è¯»å– void readDHT(void) { //è¯»å–æ¸©åº¦å‚æ•°ä¿å­˜åˆ°å…¨å±€å˜é‡ä¸­ humidity dht.readHumidity(); //è¯»å–æ¹¿åº¦å‚æ•°ä¿å­˜åˆ°å…¨å±€å˜é‡ä¸­ temperature dht.readTemperature(); //åˆ¤æ–­æ¸©æ¹¿åº¦æ•°æ®æ˜¯å¦æ˜¯éæ•°å­— if (isnan(humidity) isnan(temperature)) { Serial.println(\"Failed to read from DHT sensor!\"); return; } } void setup() { //ä¸²å£åˆå§‹åŒ– Serial.begin(9600); //DHT11åˆå§‹åŒ– dht.begin(); } void loop() { char disp_buf[50] {0}; readDHT(); //è¯»å–æ¸©æ¹¿åº¦å‚æ•° //æ ¼å¼åŒ–å­—ç¬¦ä¸² sprintf(disp_buf, \"temperature %02.0d C\", (int)temperature); //è¾“å‡ºæ¸©åº¦ Serial.println(disp_buf); //æ ¼å¼åŒ–å­—ç¬¦ä¸² sprintf(disp_buf, \"humidity %02.0d %%\", (int)humidity); //è¾“å‡ºæ¹¿åº¦ Serial.println(disp_buf); delay(1000); } ``` ## ç¡¬ä»¶è¿æ¥ ![å›¾ 0](../../static/images/docs/diy/picxel clock/dht11/dht11 2024 12 05 23 08 38.png) > è¿™é‡Œå…¶å®æˆ‘æ˜¯åšäº†ç”µè·¯è®¾è®¡çš„ï¼Œå¦‚æœä½ å‘ç°è¯»å–ä¸åˆ°æ•°æ®ï¼Œå¯ä»¥å°è¯•å°†æ¨¡å—VDDæˆ–è€…VCCæ¥åˆ°å¼€å‘æ¿çš„5Vçœ‹çœ‹ã€‚ > ![å›¾ 1](../../static/images/docs/diy/picxel clock/dht11/dht11 2024 12 05 23 08 44.png) ## ä»£ç éªŒè¯ ä»£ç ç¼–å†™å®Œæˆä¹‹åï¼Œå°†ESP32S3å¼€å‘æ¿æ¥å…¥ç”µè„‘ä¸‹è½½ä»£ç ï¼Œç„¶åæ‰“å¼€ä¸²å£ç›‘è§†å™¨æŸ¥çœ‹ç°è±¡ã€‚ > ä¸‹è½½æ­¥éª¤è¯·å‚è€ƒğŸ‘‰[RTCæ—¶é’Ÿé©±åŠ¨](ds1302.html)ç« èŠ‚çš„ä»£ç éªŒè¯å°èŠ‚ã€‚ å¯ä»¥çœ‹åˆ°æ¸©æ¹¿åº¦æ•°æ®è¯»å–æ˜¾ç¤ºæ­£å¸¸ã€‚ ![å›¾ 2](../../static/images/docs/diy/picxel clock/dht11/dht11 2024 12 05 23 09 58.png) >! è¯´æ˜ï¼šå¦‚æœä½ æ ¹æ®ä»£ç æ“ä½œè¿è¡Œä¸èµ·æ¥ï¼Œå¯ä»¥ä¸‹è½½ğŸ‘‰[ä¾‹ç¨‹](https://gitee.com/laoguaige/esp32 s3 r8 n8 pixel clock/tree/master/example/dht11)çœ‹çœ‹"},"/diy/picxel-clock/basic.html":{"title":"ESP32S3åƒç´ æ—¶é’Ÿ","content":" title: ESP32S3åƒç´ æ—¶é’Ÿ keywords: keyword1, keyword2 desc: description for this article show_source: false update: date: 2024 12 05 author: è€æ€ªé¸½ version: 1.0.1 content: æ›´æ–°äº†åŸºæœ¬æ–‡æ¡£ ## å®ç‰©å±•ç¤º ![å›¾ 21](../../static/images/docs/diy/picxel clock/basic/basic 2024 12 05 22 14 05.png) ![å›¾ 22](../../static/images/docs/diy/picxel clock/basic/basic 2024 12 05 22 14 25.png) ![å›¾ 23](../../static/images/docs/diy/picxel clock/basic/basic 2024 12 05 22 14 30.png) ![å›¾ 24](../../static/images/docs/diy/picxel clock/basic/basic 2024 12 05 22 14 35.png) ## ä»‹ç» åŸºäºç«‹åˆ›Â·ESP32S3R8N8å¼€å‘æ¿åˆ¶ä½œçš„åƒç´ æ—¶é’Ÿã€‚ ## è½¯ä»¶æ¶æ„ VSCodeä¸‹çš„platformIO + arduinoç¯å¢ƒã€‚ ## å™¨ä»¶æ¸…å• 1. 1ä¸ª ESP32S3R8N8å¼€å‘æ¿ 2. 1ä¸ª DHT11æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨ 3. 1ä¸ª DS1302æ—¶é’Ÿæ¨¡å— 4. 1ä¸ª 8*32å¤§å°WS2812å½©ç¯çŸ©é˜µ 5. 1ä¸ª MAX4466 è¿ç®—æ”¾å¤§å™¨/éŸ³é¢‘é‡‡é›†æ¨¡å— 6. 1ä¸ª æŒ‰é’® 7. 1ä¸ª SU 03Tè¯­éŸ³è¯†åˆ«æ¨¡å—+é…å¥—çš„å–‡å­å’Œéº¦å…‹é£ï¼ˆå’ªå¤´ï¼‰ 8. 1ä¸ª æŒ¯åŠ¨å°ç”µæœº 9. 1ä¸ª å…‰æ•ç”µé˜»+1Kç”µé˜» ## ç¡¬ä»¶è¿æ¥ <div style \"text align:center;\"> <table style \"margin:auto; width:100%\"> <tr> <td style \"text align:center\"><strong>æ¨¡å—åç§°</strong></td> <td style \"text align:center\">æ¨¡å—å¼•è„š</td> <td style \"text align:center\">ESP32S3R8N8ç®¡è„š</td> </tr> <tr> <td rowspan \"2\">DS1307</td> <td>SDA</td> <td>3</td> </tr> <tr> <td style \"text align:center\">SCL</td> <td style \"text align:center\">2</td> </tr> <tr> <td>DHT11</td> <td>OUT</td> <td>4</td> </tr> <tr> <td>WS2812</td> <td>DIN</td> <td>8</td> </tr> <tr> <td>MAX4466</td> <td>OUT</td> <td>1</td> </tr> <tr> <td>æŒ‰é’®</td> <td>KEY</td> <td>0</td> </tr> <tr> <td rowspan \"2\">SU 03Tè¯­éŸ³è¯†åˆ«æ¨¡å—</td> <td>B2</td> <td>13</td> </tr> <tr> <td style \"text align:center\">B3</td> <td style \"text align:center\">12</td> </tr> <tr> <td>æŒ¯åŠ¨ç”µæœºï¼ˆéœ€è¦ä¸‰æç®¡é©±åŠ¨ï¼‰</td> <td>MOTOR</td> <td>11</td> </tr> <tr> <td>å…‰æ•ç”µé˜»ï¼ˆéœ€è¦1kç”µé˜»åˆ†å‹ï¼‰</td> <td>light</td> <td>5</td> </tr> <tr> <td rowspan \"3\">å…±ç”¨éƒ¨åˆ†</td> <td>3V3(MAX4466, DHT11, å…‰æ•ç”µé˜», DS1302)</td> <td>3V3</td> </tr> <tr> <td style \"text align:center\">5V (WS2812, SU 03T, æŒ¯åŠ¨ç”µæœº)</td> <td style \"text align:center\">5V</td> </tr> <tr> <td style \"text align:center\">GND(å…¨éƒ¨) </td> <td style \"text align:center\">GND</td> </tr> </table> </div> ## åŸç†å›¾ **V1.0.1ç‰ˆ åŸç†å›¾** ![å›¾ 25](../../static/images/docs/diy/picxel clock/basic/basic 2024 12 05 22 15 00.png) ## å¾…å®Œå–„é—®é¢˜ 1. å¦‚æœå¤©æ°”è·å–å¤±è´¥ï¼Œåº”è¯¥æ˜¾ç¤ºè·å–å¤±è´¥ã€‚ 2. æ¿å­å‘çƒ­ï¼Œå¤§æ¦‚æ˜¯ä¸€ç›´å¼€å¯WIFIçš„é—®é¢˜ã€‚ 3. WIFIé…ç½‘æ²¡æœ‰å¥½çœ‹çš„HTMLç•Œé¢ï¼Œè¿›å…¥é…ç½‘æ—¶åƒç´ æ—¶é’Ÿæ²¡æœ‰UIæ˜¾ç¤ºã€‚ 4. äº®åº¦è‡ªåŠ¨è°ƒèŠ‚åŠŸèƒ½ä¸å¤©æ°”ç•Œé¢çš„ä»Šæ˜æ—¥åˆ‡æ¢çš„æ¸ç­æ¸äº®å†²çªäº† ## éƒ¨åˆ†ä»£ç å‚è€ƒ https://wokwi.com/projects/383363216212925441 https://gitee.com/adamhxx/arduino open source/tree/master/ESP32C3 CLOCK https://github.com/sf122458/ESP32C3 PixelClock https://github.com/pfalcon/uzlib ## æ›´æ–°æ—¶é—´ > ä¸€æ¬¡æ›´æ–°æ—¶é—´ï¼š2024 4 24 > äºŒæ¬¡æ›´æ–°æ—¶é—´ï¼š2024 7 28 > ä¸‰æ¬¡æ›´æ–°æ—¶é—´ï¼š2024 8 7 æ–°å¢WIFIé…ç½‘ä½†æ˜¯æ²¡æœ‰æ·»åŠ åŠ¨ç”»æœ‰BUGï¼Œé…ç½‘çš„HTMLç•Œé¢æ²¡æœ‰å®Œå–„ > å››æ¬¡æ›´æ–°æ—¶é—´ï¼š2024 8 8 æ–°å¢äº®åº¦è‡ªåŠ¨è°ƒèŠ‚åŠŸèƒ½ï¼Œä½†æ˜¯å‘ç°ä¸å¤©æ°”ç•Œé¢çš„ä»Šæ˜æ—¥åˆ‡æ¢çš„æ¸ç­æ¸äº®å†²çªäº†ï¼Œæœ‰BUG > äº”æ¬¡æ›´æ–°æ—¶é—´ï¼š2024 8 16 æ–°å¢æŒ¯åŠ¨ç”µæœºåŠŸèƒ½ï¼Œåˆå§‹åŒ–å®ŒæŒ¯åŠ¨ä¸€æ¬¡ï¼ŒæŒ‰ä¸‹æŒ‰é”®å°±æŒ¯åŠ¨ä¸€æ¬¡ã€‚è§£å†³é…ç½‘æ—¶ä¼šè‡ªåŠ¨è¿æ¥ä¸Šä¸€ä¸ªwifiå¯¼è‡´æ— æ³•é…ç½‘é—®é¢˜ï¼Œåˆ é™¤è‡ªåŠ¨è¿æ¥wifiéƒ¨åˆ†ã€‚å‘ç°æ— æ³•è¿›è¡Œç¬¬äºŒæ¬¡é…ç½‘çš„BUG > å…­æ¬¡æ›´æ–°æ—¶é—´ï¼š2024 8 24 æ–°å¢è¯­éŸ³è¯†åˆ«åŠŸèƒ½ï¼Œè¯­éŸ³å‘½ä»¤è¡¨è§main.cppæ–‡ä»¶çš„æ³¨é‡Š > ä¸ƒæ¬¡æ›´æ–°æ—¶é—´ï¼š2024 8 31 æ–°å¢è¯­éŸ³è¯†åˆ«ä¾‹ç¨‹å’Œæ•™ç¨‹æ–‡æ¡£"},"/diy/picxel-clock/weather.html":{"title":"è·å–å¤©æ°”æƒ…å†µ","content":" title: è·å–å¤©æ°”æƒ…å†µ keywords: keyword1, keyword2 desc: description for this article show_source: false update: date: 2024 12 05 author: è€æ€ªé¸½ version: 1.0.1 content: æ›´æ–°äº†åŸºæœ¬æ–‡æ¡£ ## ç¡¬ä»¶å‡†å¤‡ ä½ åªéœ€è¦æœ‰ä¸€ä¸ªESP32S3å¼€å‘æ¿ã€‚æˆ‘ç›®å‰ä½¿ç”¨çš„æ˜¯ï¼šç«‹åˆ›å¼€å‘æ¿çš„ç«‹åˆ›Â·ESP32S3R8N8å¼€å‘æ¿ã€‚ > **è´­ä¹°åœ°å€ï¼š**[ç«‹åˆ›Â·ESP32S3R8N8 å¼€å‘æ¿](https://item.szlcsc.com/22034693.html?fromZone s_s__%2522%25E7%25AB%258B%25E5%2588%259B%25E5%25BC%2580%25E5%258F%2591%25E6%259D%25BF%2522) ## å’Œé£å¤©æ°”API ### å’Œé£å¤©æ°”ä»‹ç» > [å’Œâ»›å¤©æ°”](https://www.qweather.com/)æ˜¯ä¸­å›½é¢†å…ˆçš„æ°”è±¡ç§‘æŠ€æœåŠ¡å•†ã€å›½å®¶é«˜æ–°æŠ€æœ¯ ä¼ä¸šï¼Œè‡´åŠ›äºè¿ç”¨å…ˆè¿›æ°”è±¡æ¨¡å‹ç»“åˆå¤§æ•°æ®ã€äººå·¥æ™ºèƒ½ æŠ€æœ¯å‘å±•æ™ºæ…§å‹æ°”è±¡æœåŠ¡ã€‚ ä»–ä»¬çš„ä¸šåŠ¡åŒ…æ‹¬æ°”è±¡æ•°æ®åˆ†å‘ã€åœ°ç†ä¿¡æ¯ã€æ°”è±¡å¯è§† åŒ–ã€ä¸ªäººæ°”è±¡æœåŠ¡ç­‰ï¼Œåœ¨å…¨çƒ10ä¸ªå›½å®¶å»ºæœ‰æ•°æ®ä¸­å¿ƒï¼Œ ä¸º300ä½™å®¶ä¸­å›½åŠå…¨çƒä¼ä¸šã€50ä¸‡å¼€å‘è€…æä¾›ä¼˜è´¨çš„æ•° æ®æœåŠ¡ã€‚ **å¦å¤–çš„è¯** > å’Œé£å¤©æ°”æ”¯æŒç”¨æˆ·å…è´¹ä½¿ç”¨è®¢é˜…ï¼Œåªæ˜¯ä¸€ä¸ªç”¨æˆ·åªèƒ½åˆ›å»ºä¸€ä¸ªé¡¹ç›®APIï¼Œä½†æ˜¯å¯¹æˆ‘ä»¬æ¥è¯´å·²ç»è¶³å¤Ÿäº†ï¼Œæ„Ÿè°¢å’Œé£å¤©æ°”ï¼ ### åˆ›å»ºè‡ªå·±çš„å¤©æ°”API è¯·å‰å¾€ [å’Œé£å¤©æ°”API](https://dev.qweather.com/) å®˜ç½‘ï¼Œæ³¨å†Œè´¦å·å¹¶è¿›å…¥æ§åˆ¶å°ã€‚ ![å›¾ 0](../../static/images/docs/diy/picxel clock/weather/weather 2024 12 05 23 51 48.png) å…³äºå’Œé£å¤©æ°”çš„APIä»‹ç»å’Œå¼€å‘æ–‡æ¡£ï¼Œå‚è€ƒæ§åˆ¶å°å¤„çš„ä»‹ç»ï¼š ![å›¾ 2](../../static/images/docs/diy/picxel clock/weather/weather 2024 12 05 23 52 04.png) å¼€å§‹åˆ›å»ºå±äºæˆ‘ä»¬çš„API ! ![å›¾ 1](../../static/images/docs/diy/picxel clock/weather/weather 2024 12 05 23 51 58.png) å’Œé£å¤©æ°”é¡¹ç›®åˆ›å»ºå‚æ•°å¡«å†™ï¼š ![å›¾ 3](../../static/images/docs/diy/picxel clock/weather/weather 2024 12 05 23 52 18.png) å®Œæˆåˆ›å»ºï¼ ![å›¾ 4](../../static/images/docs/diy/picxel clock/weather/weather 2024 12 05 23 52 23.png) ### APIä»‹ç» å’Œé£å¤©æ°”çš„ [APIä»‹ç»ç½‘é¡µ](https://dev.qweather.com/docs/api/) å¦‚ä¸‹ï¼š ![å›¾ 5](../../static/images/docs/diy/picxel clock/weather/weather 2024 12 05 23 52 33.png) æœ¬æ–‡å°†ç”¨çš„APIæ˜¯``åŸå¸‚å¤©æ°” > æ¯æ—¥å¤©æ°”é¢„æŠ¥ > 3å¤©é¢„æŠ¥API`` ã€‚[ã€APIçš„è¯¦ç»†ä»‹ç»é¡µç‚¹æˆ‘ã€‘](https://dev.qweather.com/docs/api/weather/weather daily forecast/) ![å›¾ 6](../../static/images/docs/diy/picxel clock/weather/weather 2024 12 05 23 52 38.png) >**éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ˜¯å…è´¹è®¢é˜…ï¼Œè¦å°†API Hostæ›´æ”¹ä¸º ``devapi.qweather.com``ã€‚** è¿™é‡Œä»¥è·å–æ·±åœ³``3å¤©çš„å¤©æ°”é¢„æŠ¥ä¸ºä¾‹``ï¼Œå…³é”®çš„APIå‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š ```html https://devapi.qweather.com/v7/weather/3d?location 101280601&key YOUR_KEY ``` >è¯·æ±‚å‚æ•°åŒ…æ‹¬å¿…é€‰å’Œå¯é€‰å‚æ•°ï¼Œå‚æ•°ä¹‹é—´ä½¿ç”¨&è¿›è¡Œåˆ†éš”ã€‚è¿™é‡Œåªç»™å¤§å®¶ä»‹ç»å¿…å¡«é¡¹ã€‚ **1. key(å¿…é€‰)** ï¼š ç”¨æˆ·è®¤è¯keyï¼Œè¯·å‚è€ƒ[å¦‚ä½•è·å–ä½ çš„KEY](https://dev.qweather.com/docs/configuration/project and key/)ã€‚ **2. location(å¿…é€‰)** ï¼š éœ€è¦æŸ¥è¯¢åœ°åŒºçš„[LocationID](https://dev.qweather.com/docs/resource/glossary/#locationid)æˆ–ä»¥è‹±æ–‡é€—å·åˆ†éš”çš„ç»åº¦,çº¬åº¦åæ ‡ï¼ˆåè¿›åˆ¶ï¼Œæœ€å¤šæ”¯æŒå°æ•°ç‚¹åä¸¤ä½ï¼‰ï¼ŒLocationIDå¯é€šè¿‡GeoAPIè·å–ã€‚ä¾‹å¦‚ location 101010100 æˆ– location 116.41,39.92 å…³äºè¿™ä¸ªLocationIDéœ€è¦å„ä½è‡ªè¡Œæ ¹æ®å’Œé£å¤©æ°”å®˜æ–¹çš„githubåœ°å€æŸ¥è¯¢ï¼Œè¿™é‡Œæˆ‘æ‰¾åˆ°æ·±åœ³çš„LocationIDä¸ºï¼š``101280601`` ![å›¾ 7](../../static/images/docs/diy/picxel clock/weather/weather 2024 12 05 23 52 56.png) ### æ‰‹åŠ¨éªŒè¯APIæ˜¯å¦æ­£ç¡® é¦–å…ˆå›åˆ°ä½ çš„å’Œé£å¤©æ°”ç®¡ç†å°ã€‚ä½ ä¼šçœ‹åˆ°ä½ æ–°å»ºçš„é¡¹ç›®ã€‚ ![å›¾ 8](../../static/images/docs/diy/picxel clock/weather/weather 2024 12 05 23 53 03.png) å¤åˆ¶ä½ çš„å¯†é’¥``KEY``ã€‚ ![å›¾ 9](../../static/images/docs/diy/picxel clock/weather/weather 2024 12 05 23 53 09.png) ç„¶åå°†ä½ çš„``KEY``å¡«å……åˆ°ä¸‹æ–¹APIçš„``YOUR_KEY``ä¸­ > ä¸‹æ–¹è¿™ä¸ªæ˜¯è·å–æ·±åœ³3å¤©çš„å¤©æ°”é¢„æŠ¥APIï¼Œåªå‰©KEYæ²¡æœ‰å¡«å†™ ```html https://devapi.qweather.com/v7/weather/3d?location 101280601&key YOUR_KEY ``` ä¾‹å¦‚æˆ‘çš„KEYæ˜¯ `ABCasdsdgsdfgdsgdfgdf`ï¼Œåˆ™æˆ‘çš„APIæ˜¯ ```heml https://devapi.qweather.com/v7/weather/3d?location 101280601&key ABCasdsdgsdfgdsgdfgdf ``` å¡«å†™ä½ çš„``KEY``åï¼Œç›´æ¥å¤åˆ¶è¯¥``API``ï¼Œå°†å®ƒä½œä¸ºç½‘å€è·³è½¬åˆ°å¯¹åº”é¡µé¢ï¼Œä½ å°±ä¼šçœ‹çš„è¿”å›çš„å¤©æ°”æ•°æ®ã€‚ ![å›¾ 10](../../static/images/docs/diy/picxel clock/weather/weather 2024 12 05 23 53 50.png) å…³äºAPIè¿”å›çš„æ•°æ®å…·ä½“çš„æ„æ€æ˜¯ä»€ä¹ˆï¼Œå‚è€ƒè¯¥[APIçš„ä»‹ç»é¡µ](https://dev.qweather.com/docs/api/weather/weather daily forecast/)ã€‚ ![å›¾ 11](../../static/images/docs/diy/picxel clock/weather/weather 2024 12 05 23 53 57.png) **æ ¹æ®è¿”å›çš„å‚æ•°è¯´æ˜ï¼Œè¿™é‡Œæˆ‘å…³æ³¨çš„æ˜¯4ä¸ªæ•°æ®ï¼š** ![å›¾ 12](../../static/images/docs/diy/picxel clock/weather/weather 2024 12 05 23 54 03.png) å›¾æ ‡ä»£ç çš„è¯´æ˜ï¼šè¿”å›çš„æ•°æ®ä¸­å…³äºå¤©æ°”çš„è¯´æ˜åªæœ‰ç©ºè½è½çš„æ•°å­—ï¼Œè¿™äº›æ•°å­—åœ¨APIè¯´æ˜ä¸­ä»£è¡¨ç€å„ä¸ªå¤©æ°”æƒ…å†µã€‚[æ•°å­—å¯¹åº”çš„å¤©æ°”æƒ…å†µé“¾æ¥ã€‚](https://dev.qweather.com/docs/resource/icons/) ![å›¾ 13](../../static/images/docs/diy/picxel clock/weather/weather 2024 12 05 23 54 11.png) åˆ°è¿™é‡Œæˆ‘ä»¬å°±å·²ç»æ˜¯å‡†å¤‡å¥½äº†ï¼Œæ¥ä¸‹æ¥å¯ä»¥ä¸Šå·¥ç¨‹ä»£ç äº†ã€‚è¯·å‡†å¤‡å¥½ä½ çš„``å®Œæ•´API``å’Œ``KEY``ã€‚ ## å·¥ç¨‹åˆ›å»º åœ¨VSCodeä¸­æ‰“å¼€PlatformIOæ‰©å±•åˆ›å»ºåä¸º`weather`çš„ `Espressif ESP32 S3 DevKitM 1` å·¥ç¨‹ã€‚ å…³äºè¯¦ç»†å›¾æ–‡åˆ›å»ºå·¥ç¨‹çš„è¿‡ç¨‹è¯·å‚è€ƒğŸ‘‰[RTCæ—¶é’Ÿé©±åŠ¨](ds1302.html)ç« èŠ‚çš„å·¥ç¨‹åˆ›å»ºå°èŠ‚ã€‚ ## å®‰è£…é©±åŠ¨åº“ åœ¨é©±åŠ¨åº“ä¸‹è½½ç•Œé¢ï¼Œæœç´¢``ArduinoJson``ï¼Œå®‰è£…æ¥è‡ª``Benoit Blanchon`` çš„ ``ArduinoJson``åº“ã€‚å°†è¯¥åº“å®‰è£…åˆ°æˆ‘ä»¬çš„å·¥ç¨‹ä¹‹ä¸­ã€‚ > å…³äºè¯¦ç»†å›¾æ–‡å®‰è£…é©±åŠ¨åº“çš„è¿‡ç¨‹è¯·å‚è€ƒğŸ‘‰[RTCæ—¶é’Ÿé©±åŠ¨](ds1302.html)ç« èŠ‚çš„å®‰è£…é©±åŠ¨åº“å°èŠ‚ã€‚ å®‰è£…å®Œæˆä¹‹åï¼Œæ‰“å¼€``platformio.ini``æ–‡ä»¶ï¼Œåº”è¯¥å¯ä»¥çœ‹åˆ°å·²ç»å®‰è£…ä¸Šäº†é©±åŠ¨åº“ã€‚ ![å›¾ 14](../../static/images/docs/diy/picxel clock/weather/weather 2024 12 05 23 55 51.png) è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå’Œé£å¤©æ°”APIè¿”å›çš„JSONæ ¼å¼æ˜¯å¸¦äº†[Gzipå‹ç¼©](https://dev.qweather.com/docs/best practices/gzip/)çš„ã€‚ ä¸ºäº†èƒ½å¤Ÿåœ¨ESP32S3ä¸­è¿›è¡ŒGzipçš„è§£å‹æ“ä½œï¼Œå¼•ç”¨äº†githubä¸Šçš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ¥è‡ª``pfalcon``çš„[uzlib](https://github.com/pfalcon/uzlib)ã€‚**æ„Ÿè°¢ä¼Ÿå¤§çš„å¼€æºè´¡çŒ®è€…ï¼** ![å›¾ 15](../../static/images/docs/diy/picxel clock/weather/weather 2024 12 05 23 56 12.png) åœ¨æˆ‘ä»¬çš„å·¥ç¨‹ä¸­ï¼Œå»``lib``æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹``uzlib``ï¼Œå°†ä»“åº“ä¸­çš„ ``src`` æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶å…¨éƒ¨æ‹‰ä¸‹æ¥ä¿å­˜åœ¨æˆ‘ä»¬åœ¨å·¥ç¨‹ä¸­æ–°å»ºçš„``uzlib``æ–‡ä»¶å¤¹ä¸‹ã€‚ ![å›¾ 16](../../static/images/docs/diy/picxel clock/weather/weather 2024 12 05 23 56 21.png) ## ç¼–è¾‘ä»£ç  åœ¨å·¥ç¨‹ä¸­çš„``src``æ–‡ä»¶å¤¹ä¸‹çš„æ–°å»º ``weather.cpp`` æ–‡ä»¶ã€‚ å¾€ ``weather.cpp`` ä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼š ```c #include \"weather.h\" Weather::Weather(String apiKey, String location) { this >apiKey apiKey; this >location location; } bool Weather::update() { HTTPClient http; //ç”¨äºè®¿é—®ç½‘ç»œ WiFiClient *stream; int size; http.begin(\"https://devapi.qweather.com/v7/weather/3d?location \"+ this >location + \"&key \" + this >apiKey); //è·å–è¿‘ä¸‰å¤©å¤©æ°”ä¿¡æ¯ int httpcode http.GET(); //å‘é€GETè¯·æ±‚ if(httpcode > 0) { if(httpcode HTTP_CODE_OK) { stream http.getStreamPtr(); //è¯»å–æœåŠ¡å™¨è¿”å›çš„æ•°æ® size http.getSize(); } } else { Serial.printf(\"[HTTP] GET... failed, error: %s\\n\", http.errorToString(httpcode).c_str()); } http.end(); //ç»“æŸå½“å‰è¿æ¥ uint8_t inbuff[size]; stream >readBytes(inbuff, size); uint8_t *outbuf NULL; uint32_t out_size 0; int result ArduinoUZlib::decompress(inbuff,size, outbuf, out_size); deserializeJson(doc, outbuf); today doc[\"daily\"][0].as<JsonObject>(); tomorrow doc[\"daily\"][1].as<JsonObject>(); return true; } //è·å–å¤©æ°”æ•°æ®ä¸­çš„å½“å¤©æœ€é«˜æ°”æ¸©æ•°æ® int Weather::getTempMax(bool is_today) { if(is_today) { return today[\"tempMax\"].as<int>(); } else { return tomorrow[\"tempMax\"].as<int>(); } } //è·å–å¤©æ°”æ•°æ®ä¸­çš„å½“å¤©æœ€ä½æ°”æ¸©æ•°æ® int Weather::getTempMin(bool is_today) { if(is_today) { return today[\"tempMin\"].as<int>(); } else { return tomorrow[\"tempMin\"].as<int>(); } } //è·å–å¤©æ°”æ•°æ®ä¸­çš„å¤©æ°”æ ‡è¯†ä»£ç  int Weather::getWeather(bool is_today, bool is_day) { if(is_today) { if(is_day) return today[\"iconDay\"].as<int>(); else return today[\"iconNight\"].as<int>(); } else { if(is_day) return tomorrow[\"iconDay\"].as<int>(); else return tomorrow[\"iconNight\"].as<int>(); } } ``` åœ¨å·¥ç¨‹ä¸­çš„``include``æ–‡ä»¶å¤¹ä¸‹çš„æ–°å»º ``weather.h`` æ–‡ä»¶ã€‚ å¾€ ``weather.h`` ä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼š ```c #ifndef _WEATHER_H #define _WEATHER_H #include \"Arduino.h\" #include \"ArduinoJson.h\" #include \"ArduinoUZlib.h\" #include \"HTTPClient.h\" //å®šä¹‰å¤©æ°”ç±» class Weather { public: Weather(String apiKey, String location); bool update(); //å‘é€ä¸€æ¬¡è¯·æ±‚ä¿¡æ¯ï¼Œè·å–å¤©æ°”æ•°æ® //åªéœ€è¦ä»Šæ˜æ—¥çš„å¤©æ°”ä¸æ¸©åº¦ï¼Œæ•…ä»…è®¾ç½®äº†ä»¥ä¸‹è‹¥å¹²å‡½æ•° int getTempMax(bool is_today); int getTempMin(bool is_today); int getWeather(bool is_today, bool is_day); private: String apiKey; //å¤©æ°”APIå¯†é’¥ String location; //åœ°ç‚¹ StaticJsonDocument<2048> doc; //Jsonå®¹å™¨ JsonObject today, tomorrow; //å¯æ ¹æ®è¿”å›çš„jsonä¿¡æ¯è‡ªè¡Œå®šä¹‰å…¶ä»–å¤©æ°”æ•°æ® }; #endif ``` æ‰“å¼€å·¥ç¨‹ä¸‹çš„``src``æ–‡ä»¶å¤¹ä¸‹çš„``main.cpp``ï¼Œå¹¶ä¸”å†™å…¥å¦‚ä¸‹ä»£ç ï¼š ```c #include <Arduino.h> #include <WiFi.h> #include \"weather.h\" //å®šä¹‰Weatherç±»ï¼Œç”¨äºè§£æJsonæ•°æ®å¹¶è¿”å›å¤©æ°”æ•°æ® //WIFI #define WIFI_SSID \"lckfb\" //è¦è¿æ¥çš„WIFIåç§° #define WIFI_PASSWORD \"12345678\" //è¦è¿æ¥çš„WIFIå¯†ç  #define WIFI_RETRY_COUNT 20 //WIFIè¿æ¥é‡è¯•æ•° //å’Œé£å¤©æ°”é¢„æŠ¥ #define USER_KEY \"d89d4706adcc4fb89d6f166cb420ee39\" //å¯†é’¥ #define LOCATION_ID \"101280601\" //åœ°ç‚¹æ ‡è¯†ï¼šæ·±åœ³ int weatherid; //æ ¹æ®å’Œé£å¤©æ°”APIè¿”å›çš„å¤©æ°”IDæ˜¾ç¤ºå¯¹åº”å¤©æ°” bool is_day 1; //ç™½å¤©ä¸º1ï¼Œå¤œæ™šä¸º0 bool is_today 1; //ä»Šå¤©ä¸º1ï¼Œæ˜å¤©ä¸º0 //åˆ›å»ºå¤©æ°”å¯¹è±¡ Weather weather(USER_KEY, LOCATION_ID); //æ ¹æ®å’Œé£å¤©æ°”APIè¿”å›å¤©æ°”æ ‡è¯† void WeatherIcon(int weatherid) { switch(weatherid) { case 100://ç™½å¤©æ™´ Serial.println(\"ç™½å¤©æ™´\\r\\n\"); break; case 101://å¤šäº‘ case 102://å°‘äº‘ case 151://å¤œé—´å¤šäº‘ case 152://å¤œé—´å°‘äº‘ case 103://æ™´é—´å¤šäº‘ Serial.println(\"å¤šäº‘\\r\\n\"); break; case 104://é˜´å¤© Serial.println(\"é˜´å¤©\\r\\n\"); break; case 150://å¤œé—´æ™´æœ— Serial.println(\"å¤œé—´æ™´æœ—\\r\\n\"); break; case 153://å¤œé—´æ™´é—´å¤šäº‘ Serial.println(\"å¤œé—´å¤šäº‘\\r\\n\"); break; case 305://å°é›¨ case 309://æ¯›æ¯›é›¨/ç»†é›¨ Serial.println(\"å°é›¨\\r\\n\"); break; case 300://é˜µé›¨ case 350://å¤œé—´é˜µé›¨ case 306://ä¸­é›¨ case 399://é›¨ case 313://å†»é›¨ case 314://å°åˆ°ä¸­é›¨ Serial.println(\"é˜µé›¨\\r\\n\"); break; case 301://å¼ºé˜µé›¨ case 351://å¤œé—´å¼ºé˜µé›¨ case 307://å¤§é›¨ case 308://æç«¯é™é›¨ case 310://æš´é›¨ case 311://å¤§æš´é›¨ case 312://ç‰¹å¤§æš´é›¨ case 315://ä¸­åˆ°å¤§é›¨ case 316://å¤§åˆ°æš´é›¨ case 317://æš´é›¨åˆ°å¤§æš´é›¨ case 318://å¤§æš´é›¨åˆ°ç‰¹å¤§æš´é›¨ Serial.println(\"å¤§é›¨\\r\\n\"); break; case 302://é›·é˜µé›¨ Serial.println(\"é›·é˜µé›¨\\r\\n\"); break; case 303://å¼ºé›·é˜µé›¨ Serial.println(\"å¼ºé›·é˜µé›¨\\r\\n\"); break; //é›ªå¤© case 400://å°é›ª case 401://ä¸­é›ª case 402://å¤§é›ª case 403://æš´é›ª case 404://é›¨å¤¹é›ª case 405://é›¨é›ªå¤©æ°” case 406://é˜µé›¨å¤¹é›ª case 407://é˜µé›¨å¤¹é›ª case 408://å°åˆ°ä¸­é›ª case 409://ä¸­åˆ°å¤§é›ª case 410://é›ª case 456://é˜µé›¨å¤¹é›ª case 457://é˜µé›ª case 499://é›ª Serial.println(\"é›ªå¤©\\r\\n\"); break; //é›¾éœ¾ case 500://è–„é›¾ case 501://é›¾ case 509://æµ“é›¾ case 510://å¼ºæµ“é›¾ case 514://å¤§é›¾ case 515://ç‰¹å¼ºæµ“é›¾ Serial.println(\"é›¾å¤©\\r\\n\"); break; case 502://éœ¾ case 511://ä¸­åº¦éœ¾ case 512://é‡åº¦éœ¾ case 513://ä¸¥é‡éœ¾ Serial.println(\"é›¾éœ¾\\r\\n\"); break; } } void setup() { int count 0; char disp_buf[50] {0}; //ä¸²å£åˆå§‹åŒ– Serial.begin(9600); //å°è¯•è¿æ¥WIFIç½‘ç»œ WiFi.begin(WIFI_SSID, WIFI_PASSWORD); //å°è¯•è¿æ¥ç›´è‡³è¶…æ—¶ while (WiFi.status() ! WL_CONNECTED) { count++; if (count > WIFI_RETRY_COUNT) { Serial.println(\"\\r\\nconnection failed.\\r\\n\"); break; } delay(500); Serial.print(\".\"); } //è·å–å¤©æ°”æ•°æ® weather.update(); //WIFIæ–­å¼€è¿æ¥ WiFi.disconnect(); //æ˜¾ç¤ºæœ€ä½ä¸æœ€é«˜æ¸©åº¦ sprintf(disp_buf, \"TempMin %d\", weather.getTempMin(is_today)); Serial.println(disp_buf); sprintf(disp_buf, \"TempMax %d\", weather.getTempMax(is_today)); Serial.println(disp_buf); //æ˜¾ç¤ºå¤©æ°”æ ‡è¯†ä»£ç  sprintf(disp_buf, \"WeatherCode %d\", weather.getWeather(is_today, is_day)); Serial.println(disp_buf); //æ ¹æ®å¤©æ°”æ ‡è¯†ä»£ç ç¡®å®šå¤©æ°” WeatherIcon(weather.getWeather(is_today, is_day)); } void loop() { delay(1000); } ``` ## ä»£ç éªŒè¯ ä»£ç ç¼–å†™å®Œæˆä¹‹åï¼Œå°†ESP32S3å¼€å‘æ¿æ¥å…¥ç”µè„‘ä¸‹è½½ä»£ç ï¼Œç„¶åæ‰“å¼€ä¸²å£ç›‘è§†å™¨æŸ¥çœ‹ç°è±¡ã€‚ > ä¸‹è½½æ­¥éª¤è¯·å‚è€ƒğŸ‘‰[RTCæ—¶é’Ÿé©±åŠ¨](ds1302.html)ç« èŠ‚çš„ä»£ç éªŒè¯å°èŠ‚ã€‚ å®é™…è·å–å¤©æ°”æ•°æ®çš„æ•ˆæœå¦‚ä¸‹ï¼š æœ€ä½æ¸©åº¦26ï¼Œæœ€é«˜æ¸©åº¦31ï¼Œå¤©æ°”ä»£ç ä¸º307ï¼Œå¯¹åº”çš„å°±æ˜¯å¤§é›¨ã€‚ ![å›¾ 17](../../static/images/docs/diy/picxel clock/weather/weather 2024 12 05 23 57 17.png) æŸ¥çœ‹å’Œé£å¤©æ°”çš„APIä¸­[å¤©æ°”ä»£ç è¯´æ˜](https://dev.qweather.com/docs/resource/icons/)ï¼Œç¡®è®¤æ•°æ®æ˜¯æ­£ç¡®çš„ã€‚ ![å›¾ 18](../../static/images/docs/diy/picxel clock/weather/weather 2024 12 05 23 57 22.png) >! è¯´æ˜ï¼šå¦‚æœä½ æ ¹æ®ä»£ç æ“ä½œè¿è¡Œä¸èµ·æ¥ï¼Œå¯ä»¥ä¸‹è½½ğŸ‘‰[ä¾‹ç¨‹](https://gitee.com/laoguaige/esp32 s3 r8 n8 pixel clock/tree/master/example/weather)çœ‹çœ‹"},"/diy/picxel-clock/ds1302.html":{"title":"æœ¬åœ°æ—¶é’Ÿè¯»å–ä¸æ˜¾ç¤º","content":" title: æœ¬åœ°æ—¶é’Ÿè¯»å–ä¸æ˜¾ç¤º keywords: keyword1, keyword2 desc: description for this article show_source: false update: date: 2024 12 05 author: è€æ€ªé¸½ version: 1.0.1 content: æ›´æ–°äº†åŸºæœ¬æ–‡æ¡£ ## å·¥ç¨‹åˆ›å»º åœ¨VSCodeä¸­æ‰“å¼€PlatformIOæ‰©å±•åˆ›å»ºå·¥ç¨‹ã€‚ ![å›¾ 0](../../static/images/docs/diy/picxel clock/ds1302/ds1302 2024 12 05 22 53 19.png) è®¾ç½®å·¥ç¨‹å‘å¯¼ ![å›¾ 1](../../static/images/docs/diy/picxel clock/ds1302/ds1302 2024 12 05 22 53 26.png) ![å›¾ 2](../../static/images/docs/diy/picxel clock/ds1302/ds1302 2024 12 05 22 53 32.png) ç­‰å¾…åˆ›å»ºå®Œæˆã€‚ ![å›¾ 3](../../static/images/docs/diy/picxel clock/ds1302/ds1302 2024 12 05 22 53 37.png) ## å®‰è£…é©±åŠ¨åº“ åˆ›å»ºå®Œæˆä¹‹åï¼Œæˆ‘ä»¬åœ¨VSCodeä¸­æ‰“å¼€æˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„å·¥ç¨‹æ–‡ä»¶å¤¹ã€‚ ![å›¾ 4](../../static/images/docs/diy/picxel clock/ds1302/ds1302 2024 12 05 22 53 42.png) åœ¨VSCodeä¸­å›åˆ°PlatformIOçš„ä¸»é¡µï¼Œç»™å·¥ç¨‹å®‰è£…DS1302çš„é©±åŠ¨åº“ã€‚ ![å›¾ 5](../../static/images/docs/diy/picxel clock/ds1302/ds1302 2024 12 05 22 54 05.png) ![å›¾ 6](../../static/images/docs/diy/picxel clock/ds1302/ds1302 2024 12 05 22 54 09.png) æœç´¢DS1302ï¼Œå®‰è£…læ¥è‡ª``Rafa Couto``çš„``Ds1302``åº“ã€‚ ![å›¾ 7](../../static/images/docs/diy/picxel clock/ds1302/ds1302 2024 12 05 22 54 14.png) å°†åº“å®‰è£…åˆ°æˆ‘ä»¬çš„å·¥ç¨‹ä¸­ã€‚ ![å›¾ 8](../../static/images/docs/diy/picxel clock/ds1302/ds1302 2024 12 05 22 54 19.png) ![å›¾ 9](../../static/images/docs/diy/picxel clock/ds1302/ds1302 2024 12 05 22 54 29.png) æ‰“å¼€``platformio.ini``æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»å®‰è£…ä¸Šäº†DS1302çš„é©±åŠ¨åº“ã€‚ ![å›¾ 10](../../static/images/docs/diy/picxel clock/ds1302/ds1302 2024 12 05 22 54 35.png) ## ç¼–è¾‘ä»£ç  æ‰“å¼€å·¥ç¨‹ä¸‹çš„``src``æ–‡ä»¶å¤¹ä¸‹çš„``main.cpp``ã€‚ è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š ```C #include <Arduino.h> #include <Ds1302.h> //è®¡æ—¶æ¨¡å—DS1302ç›¸å…³å®šä¹‰ #define RST 10 //ds1302çš„RSTå¼•è„šå®šä¹‰ #define DATA 3 //ds1302çš„DATAå¼•è„šå®šä¹‰ #define CLK 2 //ds1302çš„CLKå¼•è„šå®šä¹‰ Ds1302 rtc(RST, CLK, DATA); //åˆ›å»ºDS1302è¿™ä¸ªå¯¹è±¡ void setup() { //åˆå§‹åŒ–ä¸²å£ Serial.begin(9600); //åˆå§‹åŒ–DS1302 rtc.init(); //æµ‹è¯•æ—¶é’Ÿæ˜¯å¦åœæ­¢å¹¶è®¾ç½®ä¸€ä¸ªæ—¥æœŸæ—¶é—´æ¥å¯åŠ¨å®ƒ if (rtc.isHalted()) { Serial.println(\"RTC is halted. Setting time...\"); //åˆ›å»ºåŸºäºDS1302åº“ä¸‹çš„æ—¶é—´å‚æ•° Ds1302::DateTime dt { .year 24, .month Ds1302::MONTH_JUL, .day 27, .hour 14, .minute 13, .second 0, .dow Ds1302::DOW_SAT }; //å°†è®¾ç½®çš„æ—¶é—´å†™å…¥DS1302æ¨¡å— rtc.setDateTime(&dt); } else { Serial.println(\"RTC is busy.\\r\\n\"); } Serial.println(\"Time start.\\r\\n\"); } void loop() { char outputString[100] {0}; Ds1302::DateTime now; //è·å–å½“å‰æ—¶é—´å¹¶ä¸”å­˜å‚¨åœ¨nowä¸­ rtc.getDateTime(&now); static uint8_t last_second 0; //å¦‚æœç§’æ•°å‘ç”Ÿæ›´æ–° if (last_second ! now.second) { //æ‰‹åŠ¨æ›´æ–°ç§’æ•°ï¼Œæ–¹ä¾¿ä¸‹æ¬¡åˆ¤æ–­ last_second now.second; //æ ¼å¼åŒ–å­—ç¬¦ä¸² sprintf(outputString, \"%d %d %d %d %d:%d:%d\\r\\n\", now.year+2000, now.month, now.day, now.dow, now.hour, now.minute, now.second ); //è¾“å‡ºå­—ç¬¦ä¸² Serial.println(outputString); } delay(1000); } ``` ## ç¡¬ä»¶è¿æ¥ ![å›¾ 11](../../static/images/docs/diy/picxel clock/ds1302/ds1302 2024 12 05 22 55 19.png) > è¿™é‡Œå…¶å®æˆ‘æ˜¯åšäº†ç”µè·¯è®¾è®¡çš„ï¼Œå¦‚æœä½ çš„æ¨¡å—ä¸Šæ²¡æœ‰RSTçš„è¯åº”è¯¥æ˜¯ä¸ç”¨è¿æ¥RSTå¼•è„šçš„ã€‚ > ![å›¾ 12](../../static/images/docs/diy/picxel clock/ds1302/ds1302 2024 12 05 22 55 34.png) ## ä»£ç éªŒè¯ ä»£ç ç¼–å†™å®Œæˆä¹‹åï¼Œå°†**ESP32S3å¼€å‘æ¿**æ¥å…¥ç”µè„‘ã€‚æˆ‘å½“å‰çš„å¼€å‘æ¿ä¸Šæ˜¯**CH340K**çš„é©±åŠ¨ï¼Œæ•…æˆ‘è¿™é‡Œé€‰æ‹©**COM3ç«¯å£**ã€‚ ![å›¾ 13](../../static/images/docs/diy/picxel clock/ds1302/ds1302 2024 12 05 22 56 05.png) ç¼–è¯‘å¹¶ä¸‹è½½åˆ°å¼€å‘æ¿ä¸­ã€‚ ![å›¾ 14](../../static/images/docs/diy/picxel clock/ds1302/ds1302 2024 12 05 22 56 11.png) ç‚¹å‡»æ‰“å¼€ä¸²å£ç›‘è§†å™¨ã€‚ ![å›¾ 15](../../static/images/docs/diy/picxel clock/ds1302/ds1302 2024 12 05 22 56 16.png) å¯ä»¥çœ‹åˆ°å¼€å‘æ¿å¯ä»¥æ­£å¸¸çš„è¯»å–å’Œè®¾ç½®DS1302çš„æ—¶é—´ã€‚è¾“å‡ºæ­£å¸¸ã€‚ ![å›¾ 16](../../static/images/docs/diy/picxel clock/ds1302/ds1302 2024 12 05 22 56 21.png) >! è¯´æ˜ï¼šå¦‚æœä½ æ ¹æ®ä»£ç æ“ä½œè¿è¡Œä¸èµ·æ¥ï¼Œå¯ä»¥ä¸‹è½½ğŸ‘‰[ä¾‹ç¨‹](https://gitee.com/laoguaige/esp32 s3 r8 n8 pixel clock/tree/master/example/ds1302)çœ‹çœ‹"},"/diy/index.html":{"title":"DIYé¡¹ç›®åˆé›†","content":" title: DIYé¡¹ç›®åˆé›† keywords: keyword1, keyword2 desc: description for this article date: 2024 12 07 ## ç‰©è”ç½‘åƒç´ æ—¶é’Ÿ åŸºäºç«‹åˆ›Â·ESP32S3R8N8å¼€å‘æ¿åˆ¶ä½œçš„åƒç´ æ—¶é’Ÿï¼ŒåŒ…å«ç½‘ç»œæ—¶é’Ÿã€å¤©æ°”æ˜¾ç¤ºã€æ¸©æ¹¿åº¦æ˜¾ç¤ºã€é»‘å®¢å¸å›½æ•°å­—é›¨ç‰¹æ•ˆã€éŸ³å¾‹æ‹¾éŸ³ç¯ç­‰åŠŸèƒ½ã€‚ å¼€å‘æ–¹å¼ï¼šVSCodeä¸‹çš„platformIO + arduinoç¯å¢ƒã€‚ ![å›¾ 0](../../static/images/docs/diy/README/README 2024 12 06 00 38 54.png) ## å¤©çŒ›æ˜Ÿå¹³è¡¡è½¦ åŸºäºç«‹åˆ›Â·å¤©çŒ›æ˜ŸMSPM0G3507å¼€å‘æ¿åˆ¶ä½œçš„å°å¹³è¡¡è½¦ã€‚ > MSPM0G3507ä¸ºTIå¾·å·ä»ªå™¨åˆ¶ä½œçš„ARM 32ä½ Cortex M0+ CPUã€‚æœ€é«˜80MHz,128K FLASH + 32K SRAM. ![å›¾ 1](../../static/images/docs/diy/README/README 2024 12 06 00 51 20.jpg) ## ä¸ªäººWIKIç½‘ç«™æ­å»º åŸºäºå¼€æºçš„teedocæ¡†æ¶æ­å»ºçš„ä¸ªäººWIKIèµ„æ–™è®°å½•ç½‘ç«™ã€‚ ![å›¾ 2](../../static/images/docs/diy/README/README 2024 12 06 01 00 55.png) ## å¹´è½»äººçš„ç¬¬ä¸€å°èˆ°é˜²ç‚® K230 AIè§†è§‰è¯†åˆ«å¼€å‘æ¿ + ç”µåŠ¨ç©å…·æª ç»„æˆçš„ç›®æ ‡è‡ªåŠ¨è·Ÿè¸ªç‚®å°ã€‚ ## WIFIå›¾ä¼ å°è½¦ åŸºäºå˜‰ç«‹åˆ›EDAå’ŒESP32S3R8N8å¼€å‘æ¿è®¾è®¡çš„WIFIå›¾ä¼ å°è½¦ã€‚é€šè¿‡ESP32S3è‡ªå¸¦çš„WIFIåŠŸèƒ½ï¼Œå°†OV2640æ‘„åƒå¤´é‡‡é›†çš„å›¾åƒæ•°æ®é€šè¿‡WIFIè¿›è¡Œ10ç±³å·¦å³çš„å›¾ä¼ ã€‚ ## ç”µå­ç‰©æ–™æ”¶çº³ç›’"},"/diy/tracking-cannon/basic.html":{"title":"èˆ°é˜²ç‚®ä»‹ç»","content":" title: èˆ°é˜²ç‚®ä»‹ç» keywords: keyword1, keyword2 desc: description for this article show_source: false update: date: 2024 12 05 author: è€æ€ªé¸½ version: 1.0.1 content: æ›´æ–°äº†åŸºæœ¬æ–‡æ¡£ date: 2025 06 27 author: è€æ€ªé¸½ version: 1.0.2 content: æ›´æ–°äº†PIDå’Œæ»¤æ³¢ç« èŠ‚ ## é¡¹ç›®èƒŒæ™¯ é¡¹ç›®å‚è€ƒæ¥æºï¼š **ã€ç»™ç©å…·æªåŠ è£…äº‘å°å’Œäººè„¸è¯†åˆ«åŠŸèƒ½ï¼Œå®ç°ç›®æ ‡è‡ªåŠ¨è¯†åˆ«é”å®šåŠŸèƒ½ã€‘ ** <iframe src \"//player.bilibili.com/player.html?isOutside true&aid 986378786&bvid BV1at4y1c7kt&cid 858044263&p 1\" scrolling \"no\" border \"0\" frameborder \"no\" framespacing \"0\" allowfullscreen \"true\" style \"width:43vw;height:34vw;min width: 85%;\"></iframe> åŸä½œè€…æ˜¯é‡‡ç”¨çš„ `opencv` ä½œä¸ºè¯†åˆ«æ–¹æ¡ˆï¼Œè€Œ `opencv` éœ€è¦è¿è¡Œåœ¨ç”µè„‘çš„æ“ä½œç³»ç»Ÿä¸Šï¼Œä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚è€Œæœ€è¿‘æ­£å¥½çœ‹åˆ°ç«‹åˆ›å¼€å‘æ¿çš„ `K230 AI` å¼€å‘æ¿åœ¨æ‰¾å†…æµ‹ï¼Œæœ‰å¹¸è”ç³»åˆ°å¹¶ä¸”å‚ä¸å…¶ä¸­ã€‚ å°†å†³å®šä»¥ `K230` ä¸ºä¸»è¦æ ¸å¿ƒï¼Œæ§åˆ¶äºŒç»´èˆµæœºäº‘å°ä½œä¸º`è¿åŠ¨è£…ç½®`ã€æ¿è½½æ‘„åƒå¤´è¯†åˆ«ç‰©å“åŠŸèƒ½ä½œä¸º`ç„å‡†è£…ç½®`ã€ç”µåŠ¨ç©å…·æªä½œä¸º`å‘å°„è£…ç½®`ç­‰ï¼Œä»¥å®ç°è‡ªåŠ¨è¿½è¸ªç‚®å°çš„åŠŸèƒ½ã€‚ ## ç¡¬ä»¶è®¾è®¡ ### ç¡¬ä»¶å‡†å¤‡ 1. **äºŒç»´èˆµæœºäº‘å°** ![å›¾ 3](../../static/images/docs/diy/tracking cannon/basic/basic 2024 12 21 22 32 10.png) åœ°å€ï¼šhttps://item.taobao.com/item.htm?_u l2t4uge5db1c&id 560120308139 2. **ç”µåŠ¨ç©å…·æª** ![å›¾ 2](../../static/images/docs/diy/tracking cannon/basic/basic 2024 12 21 22 31 08.png) åœ°å€ï¼šhttps://item.taobao.com/item.htm?_u l2t4uge530d9&id 684699922229 3. **K230 AIè¯†åˆ«å¼€å‘æ¿** ![å›¾ 0](../../static/images/docs/diy/tracking cannon/basic/basic 2024 12 21 22 29 03.png) åœ°å€ï¼šhttps://lckfb.com/project/detail/lckfb lspi k230 1g canmv?param baseInfo 4. **è¾…åŠ©å·¥å…·** èºä¸æ‰¹å¥—è£…ã€çƒ­èƒ¶æªã€æœé‚¦çº¿ç­‰ã€‚ ### ç¡¬ä»¶è¿æ¥ ![å›¾ 4](../../static/images/docs/diy/tracking cannon/basic/basic 2024 12 21 22 54 53.png) ç”µåŠ¨ç©å…·æªä¹Ÿæ˜¯å¯ä»¥é€šè¿‡å¼€å…³æ§åˆ¶çš„ï¼Œåªéœ€è¦é€šè¿‡ç»§ç”µå™¨çš„æ–¹å¼ï¼Œè¿æ¥åˆ°GPIOä¸Šæ˜¯å¯ä»¥æ§åˆ¶å¼€æªçš„ï¼Œè¿™é‡Œæˆ‘å› ä¸ºæ²¡æœ‰ä¹°ç»§ç”µå™¨æ‰€ä»¥æˆ‘å°±å…ˆä¸ç”»ã€‚ .. details::K230æ’é’ˆæ¥å£ç¤ºæ„å›¾ï¼Œç‚¹å‡»å±•å¼€ ![å›¾ 5](../../static/images/docs/diy/tracking cannon/basic/basic 2024 12 21 22 57 24.png) ## è½¯ä»¶è®¾è®¡ K230çš„å¿«é€Ÿå…¥é—¨è¯·å‚è€ƒï¼šhttps://wiki.lckfb.com/zh hans/lushan pi k230/quick start.html è¯·æŒ‰ç…§ä¸Šé¢çš„é“¾æ¥ï¼Œå®Œæˆå¼€å‘æ¿çš„ç»„è£…ã€`CanMV` å›ºä»¶çƒ§å½•ã€ç”µè„‘è¿æ¥ç­‰æ“ä½œã€‚æˆ‘åœ¨åé¢å°†ä¸ä¼šä»‹ç»ä»€ä¹ˆæ˜¯ `IDE` ï¼Œä»¥åŠå¦‚ä½•è¿æ¥ã€‚ ### IDEæ˜¾ç¤ºå›¾åƒ æ˜¾ç¤ºå›¾åƒåœ¨K230çš„å›ºä»¶ä¸­ä¸€å…±æ”¯æŒ4ç§ï¼Œåˆ†åˆ«æ˜¯ `HDMI` çš„ `VGA` ï¼Œ `HDMI` çš„ `1080P` ã€`LCD`ã€`IDE` ç­‰ã€‚æˆ‘ä»¬å…ˆäº†è§£æ€ä¹ˆå°†æ‘„åƒå¤´é‡‡é›†åˆ°çš„ç”»é¢æ˜¾ç¤ºåœ¨ `IDE` çš„**å›¾åƒç¼“å†²åŒº**ã€‚ æ ¹æ® `K230` èµ„æ–™çš„[Sensorä¾‹ç¨‹è®²è§£](https://developer.canaan creative.com/k230_canmv/dev/zh/example/media/sensor.html) ï¼Œæå–å‡º **æ‘„åƒå¤´çš„åˆå§‹åŒ–** `+` **é‡‡é›†å›¾åƒçš„ä»£ç **ã€‚ ```py # Camera ç¤ºä¾‹ import time import os import sys from media.sensor import * from media.display import * from media.media import * DETECT_WIDTH 640 DETECT_HEIGHT 480 sensor None try: # é…ç½®æ‘„åƒå¤´çš„å›¾åƒå¤§å° sensor Sensor(width DETECT_WIDTH, height DETECT_HEIGHT) # æ‘„åƒå¤´ä¼ æ„Ÿå™¨å¤ä½ sensor.reset() # è®¾ç½®å›¾åƒæ˜¯å¦é•œåƒ # sensor.set_hmirror(False) # è®¾ç½®å›¾åƒæ˜¯å¦ç¿»è½¬ # sensor.set_vflip(False) # è®¾ç½®é€šé“0çš„å›¾åƒè¾“å‡ºå°ºå¯¸ sensor.set_framesize(width DETECT_WIDTH, height DETECT_HEIGHT) #è®¾ç½®é€šé“0è¾“å‡ºæ ¼å¼ä¸ºRGB565ï¼ˆå½©è‰²å›¾åƒï¼‰ sensor.set_pixformat(Sensor.RGB565) # Initåª’ä½“ç®¡ç†å™¨ MediaManager.init() # ä¼ æ„Ÿå™¨å¯åŠ¨è¿è¡Œ sensor.run() while True: sensor.snapshot() #è·å–ä¸€å¸§å›¾åƒ except KeyboardInterrupt as e: print(f\"user stop\") except BaseException as e: print(f\"Exception '{e}'\") finally: # sensor stop run if isinstance(sensor, Sensor): sensor.stop() os.exitpoint(os.EXITPOINT_ENABLE_SLEEP) time.sleep_ms(100) # release media buffer MediaManager.deinit() ``` æ ¹æ®[Displayä¾‹ç¨‹è®²è§£](https://developer.canaan creative.com/k230_canmv/dev/zh/example/media/display.html)ï¼Œæå–å‡ºå°†**å›¾åƒæ˜¾ç¤ºåˆ° `IDE` ä¸Šçš„ä»£ç **ã€‚ ```python import time, os, gc, sys, math from media.sensor import * from media.display import * from media.media import * DETECT_WIDTH 640 DETECT_HEIGHT 480 try: #é…ç½®å›¾åƒæ˜¾ç¤ºæ–¹å¼ä¸ºIDEæ˜¾ç¤ºï¼Œæ˜¾ç¤ºçš„å®½é«˜ä¸ºDETECT_WIDTH+DETECT_HEIGHTï¼Œå¸§ç‡100fps Display.init(Display.VIRT, width DETECT_WIDTH, height DETECT_HEIGHT, fps 100) while True: Display.show_image(img) #æ˜¾ç¤ºä¸€ä¸ªå›¾åƒï¼Œè¿™ä¸ªimgæ˜¯æ‘„åƒå¤´é‡‡é›†çš„ä¸€å¸§å›¾åƒ except KeyboardInterrupt as e: print(f\"user stop\") except BaseException as e: print(f\"Exception '{e}'\") finally: # æ¸…é™¤æ˜¾ç¤ºç¼“å­˜ Display.deinit() os.exitpoint(os.EXITPOINT_ENABLE_SLEEP) time.sleep_ms(100) ``` å°†è¿™ä¸¤ä¸ªä»£ç ä¸€æ•´åˆï¼Œå°±å¾—åˆ°äº†å°†å›¾åƒæ˜¾ç¤ºåˆ° `IDE` ä¸­çš„ä»£ç ï¼š ```python import time import os import sys from media.sensor import * from media.display import * from media.media import * DETECT_WIDTH 640 DETECT_HEIGHT 480 sensor None try: # é…ç½®æ‘„åƒå¤´çš„å›¾åƒå¤§å° sensor Sensor(width DETECT_WIDTH, height DETECT_HEIGHT) # æ‘„åƒå¤´ä¼ æ„Ÿå™¨å¤ä½ sensor.reset() # è®¾ç½®å›¾åƒæ˜¯å¦é•œåƒ # sensor.set_hmirror(False) # è®¾ç½®å›¾åƒæ˜¯å¦ç¿»è½¬ # sensor.set_vflip(False) # è®¾ç½®é€šé“0çš„å›¾åƒè¾“å‡ºå°ºå¯¸ sensor.set_framesize(width DETECT_WIDTH, height DETECT_HEIGHT) #è®¾ç½®é€šé“0è¾“å‡ºæ ¼å¼ä¸ºRGB565ï¼ˆå½©è‰²å›¾åƒï¼‰ sensor.set_pixformat(Sensor.RGB565) #é…ç½®å›¾åƒæ˜¾ç¤ºæ–¹å¼ä¸ºIDEæ˜¾ç¤ºï¼Œæ˜¾ç¤ºçš„å®½é«˜ä¸ºDETECT_WIDTH+DETECT_HEIGHTï¼Œå¸§ç‡100fps Display.init(Display.VIRT, width DETECT_WIDTH, height DETECT_HEIGHT, fps 100) # Initåª’ä½“ç®¡ç†å™¨ MediaManager.init() # ä¼ æ„Ÿå™¨å¯åŠ¨è¿è¡Œ sensor.run() while True: img sensor.snapshot() #è·å–ä¸€å¸§å›¾åƒ Display.show_image(img) #æ˜¾ç¤ºæ‘„åƒå¤´é‡‡é›†çš„å›¾åƒ except KeyboardInterrupt as e: print(f\"user stop\") except BaseException as e: print(f\"Exception '{e}'\") finally: # sensor stop run if isinstance(sensor, Sensor): sensor.stop() # deinit display Display.deinit() os.exitpoint(os.EXITPOINT_ENABLE_SLEEP) time.sleep_ms(100) # release media buffer MediaManager.deinit() ``` å¤§å®¶å¯ä»¥è¿è¡Œä¸Šé¢çš„ä¾‹ç¨‹çœ‹çœ‹ï¼Œåœ¨ `CanMV IDE` ä¸­ä¼šä¸ä¼šæ˜¾ç¤ºå‡ºK230å¼€å‘æ¿æ‘„åƒå¤´çš„ç”»é¢ã€‚ ### é¢œè‰²è¯†åˆ« K230æ˜¯ä¸€ä¸ªAIè§†è§‰èŠ¯ç‰‡ï¼Œæ ¹æ®å®˜ç½‘èµ„æ–™å¯ä»¥çŸ¥é“ï¼Œå…¶å¯ä»¥é€šè¿‡æ‘„åƒå¤´è¯†åˆ«å‡ºå¾ˆå¤šä¸œè¥¿ï¼Œæ¯”å¦‚äººè„¸ã€å½¢çŠ¶ã€é¢œè‰²ã€ç‰©å“ã€æ°´æœç­‰ç­‰ï¼Œè¿™é‡Œæˆ‘æ¯”è¾ƒç†Ÿç»ƒä½¿ç”¨çš„æ˜¯**é¢œè‰²è¯†åˆ«**ï¼Œå°±å…ˆä»¥é¢œè‰²è¯†åˆ«ä¸ºä¾‹ï¼Œè·å–æŒ‡å®šé¢œè‰²çš„ç›®æ ‡æ–¹ä½ã€‚ è€Œæˆ‘ä»¬èƒ½å¤Ÿè·å–é¢œè‰²çš„æ–¹ä½ï¼Œé‚£å°±å¯ä»¥æ ¹æ®å®˜æ–¹ä¾‹ç¨‹æ¨ä¸¾å‡ºè¯†åˆ«å…¶ä»–ä¸œè¥¿æ—¶ï¼Œæ€ä¹ˆè·å–å¯¹åº”è¯†åˆ«ç›®æ ‡çš„æ–¹ä½äº†ã€‚ æ ¹æ® `canMV K230 IDE` è‡ªå¸¦çš„é¢œè‰²è¯†åˆ«ä¾‹ç¨‹ï¼Œæ•´ç†å‡ºå…³é”®çš„ä»£ç ã€‚ ä»¥ä¸‹æ˜¯é¢œè‰²è¯†åˆ«ä¾‹ç¨‹ï¼š ```python # Find Blobs Example # # This example shows off how to find blobs in the image. import time, os, gc, sys from media.sensor import * from media.display import * from media.media import * DETECT_WIDTH ALIGN_UP(320, 16) DETECT_HEIGHT 240 sensor None def camera_init(): global sensor # construct a Sensor object with default configure sensor Sensor(width DETECT_WIDTH,height DETECT_HEIGHT) # sensor reset sensor.reset() # set hmirror # sensor.set_hmirror(False) # sensor vflip # sensor.set_vflip(False) # set chn0 output size sensor.set_framesize(width DETECT_WIDTH,height DETECT_HEIGHT) # set chn0 output format sensor.set_pixformat(Sensor.RGB565) # use IDE as display output Display.init(Display.VIRT, width DETECT_WIDTH, height DETECT_HEIGHT,fps 100,to_ide True) # init media manager MediaManager.init() # sensor start run sensor.run() def camera_deinit(): global sensor # sensor stop run sensor.stop() # deinit display Display.deinit() # sleep os.exitpoint(os.EXITPOINT_ENABLE_SLEEP) time.sleep_ms(100) # release media buffer MediaManager.deinit() def capture_picture(): fps time.clock() while True: fps.tick() try: os.exitpoint() global sensor img sensor.snapshot()#è·å–å›¾åƒ # è®¾ç½®é¢œè‰²é˜ˆå€¼ thresholds [[0, 80, 40, 80, 10, 80]] # çº¢è‰²çš„é˜ˆå€¼ï¼Œè¿™æ ·ä»£ç å°±åªè¯†åˆ«çº¢è‰² # ä»å›¾åƒä¸­æŸ¥æ‰¾é¢œè‰²ï¼Œæ ¹æ®é˜ˆå€¼è¿›è¡Œå¯¹æ¯”ï¼Œå½“é˜ˆå€¼ä¸€è‡´æ—¶ï¼Œå°†å¯¹åº”é¢œè‰²çš„å„ä¸ªå‚æ•°/ä½ç½®ç­‰ä¿å­˜åˆ°blobså˜é‡ä¸­ blobs img.find_blobs(thresholds ,pixels_threshold 500) # ä»blobsä¸­éå†å„ä¸ªè¢«è¯†åˆ«åˆ°çš„é˜ˆå€¼ä¸€æ ·çš„é¢œè‰²ï¼Œå°†éå†åˆ°çš„é¢œè‰²å‚æ•°èµ‹å€¼ç»™blob for blob in blobs: # è°ƒç”¨ç”»çŸ©å½¢APIï¼Œå¡«å…¥éå†åˆ°çš„é¢œè‰²4ä¸ªè§’çš„ä½ç½®ï¼Œè®¾ç½®çŸ©å½¢æ¡†çš„é¢œè‰²ä¸ºRGBçš„RGå…¨è‰² img.draw_rectangle(blob[0], blob[1], blob[2], blob[3], color (255, 255, 0)) # æ˜¾ç¤ºå›¾åƒ Display.show_image(img) img None gc.collect() print(fps.fps()) #è¾“å‡ºå¸§ç‡ except KeyboardInterrupt as e: print(\"user stop: \", e) break except BaseException as e: print(f\"Exception {e}\") break def main(): os.exitpoint(os.EXITPOINT_ENABLE) camera_is_init False try: print(\"camera init\") camera_init() camera_is_init True print(\"camera capture\") capture_picture() except Exception as e: print(f\"Exception {e}\") finally: if camera_is_init: print(\"camera deinit\") camera_deinit() if __name__ \"__main__\": main() ``` **åˆ†æï¼š** å…¶å®ä¸»è¦å°±æ˜¯ [find_blobs](https://developer.canaan creative.com/k230_canmv/dev/zh/api/openmv/image.html#find blobs) `API`ï¼Œå®ƒä¼šå»å›¾åƒä¸­æŸ¥æ‰¾æˆ‘ä»¬è®¾ç½®çš„é˜ˆå€¼çš„é¢œè‰²ï¼Œæ‰¾åˆ° ä¸€ä¸ªå°±è®°å½•èµ·æ¥æˆä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œæ‰¾åˆ°ä¸€ä¸ªå°±è®°ä¸€ä¸ªï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥å¯¹è¯¥é¢œè‰²å¯¹è±¡ä¸ºæ‰€æ¬²ä¸ºäº†ã€‚ ä½†æ˜¯è¿™ä¸ªä¾‹ç¨‹è¿˜æ˜¯æœ‰ä¸€ç‚¹é—®é¢˜ï¼Œä¹Ÿä¸èƒ½è¯´æ˜¯é—®é¢˜ï¼Œåªæ˜¯ä¸ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ï¼Œæˆ‘ä»¬çš„è¦æ±‚æ˜¯åªè¯†åˆ«ä¸€ä¸ªé¢œè‰²ã€‚æ¯•ç«Ÿæˆ‘ä»¬åªæœ‰ä¸€ä¸ªç‚®å°ï¼Œè¯†åˆ«å†å¤šä¸ªä¹Ÿåªèƒ½æ‰“ä¸€ä¸ªã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œè¿™ä¸ªä¾‹ç¨‹æ˜¯ä¼šå°†å›¾åƒä¸­è¯†åˆ«åˆ°çš„é¢œè‰²éƒ½ç”»æ¡†å¹¶è®°å½•ï¼Œç±»ä¼¼ä»¥ä¸‹ç°è±¡ï¼šï¼ˆè¯†åˆ«æµ…è“è‰²ï¼‰ ![å›¾ 6](../../static/images/docs/diy/tracking cannon/basic/basic 2024 12 21 23 09 37.png) å›¾ä¸­çš„ç™½è‰²çŸ©å½¢æ¡†+ç™½è‰²åå­—å°±æ˜¯è¡¨ç¤ºçš„è¯†åˆ«åˆ°çš„é¢œè‰²ã€‚ç°åœ¨è¯†åˆ«å‡ºäº†é‚£ä¹ˆå¤šä¸ªç›®æ ‡ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªç‚®å£æ€ä¹ˆåŠï¼Ÿ**æˆ‘ä»¬å¯ä»¥ä¼˜å…ˆæ‰¾åˆ°æœ€å¤§çš„ï¼Œæœ€è¿‘çš„ä¸€ä¸ªå¼€ç‚®ï¼**è€Œåœ¨å›¾åƒçš„ä¸–ç•Œé‡Œï¼Œåœ¨å¤šä¸ªç›®æ ‡ä¸­ï¼Œåƒç´ è¶Šå¤šçš„ï¼Œè¯´æ˜ç¦»æ‘„åƒå¤´è¶Šè¿‘ï¼é‚£å°±æ˜¯æœ€å¤§çš„ç›®æ ‡ï¼ ä»¥ä¸‹æ˜¯åœ¨ä¸€å †è¯†åˆ«åˆ°çš„å›¾åƒä¸­ï¼Œæ‰¾åˆ°æœ€å¤§åƒç´ çš„å›¾åƒä»£ç ï¼š**(åªå†™å…³é”®çš„äº†)** ```python # æ‹æ‘„ä¸€å¼ å›¾ç‰‡ img sensor.snapshot() # æŸ¥æ‰¾å›¾åƒä¸­æ»¡è¶³çº¢è‰²é˜ˆå€¼ï¼ˆred_thresholdï¼‰çš„åŒºåŸŸ blobs img.find_blobs([red_threshold], pixels_threshold 200, area_threshold 200, merge True) # å¦‚æœæ‰¾åˆ°äº†è‡³å°‘ä¸€ä¸ªblob if blobs: # ä»blobsä¸­æ‰¾åˆ°æœ€å¤§åƒç´ ç‚¹çš„blob largest_blob max(blobs, key lambda b: b.pixels()) # åªå¯¹æœ€å¤§åƒç´ ç‚¹çš„ç›®æ ‡ç”»æ¡†ï¼Œæ¡†çš„é¢œè‰²æ˜¯RGBä¸­çš„Rï¼ˆçº¢è‰²ï¼‰ img.draw_rectangle(largest_blob.rect(), color (255, 0, 0)) # åœ¨æ¡†å†…ç”»åå­—ï¼Œæ ‡è®°ä¸­å¿ƒç‚¹ img.draw_cross(largest_blob.cx(), largest_blob.cy(), color (255, 0, 0)) # å°†ä½ç½®å’Œå®½é«˜æ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸² wz \"x {}, y {}, w {}, h {}\".format(x_offset, y_offset, largest_blob.w(), largest_blob.h()) # å›¾åƒä¸Šæ˜¾ç¤ºä½ç½®å’Œå®½é«˜ä¿¡æ¯çš„å­—ç¬¦ä¸²ï¼Œå­—ç¬¦çš„å¤§å°æ˜¯32 img.draw_string_advanced(0,0,32,wz) ``` > ä¸Šé¢ä»£ç ä¸­çš„é˜ˆå€¼æ³¨é‡Šè™½ç„¶æ˜¯çº¢è‰²é˜ˆå€¼ï¼Œä½†æ˜¯æˆ‘å®é™…ä¸Šç”¨çš„æ˜¯ç»¿è‰²çš„é˜ˆå€¼ ç°åœ¨æˆ‘ä»¬å°±å·²ç»å®Œæˆäº†ç›®æ ‡å®šä½çš„ä»»åŠ¡äº†ï¼Œä¸Šé¢çš„ä»£ç ä¸­æ‰¾åˆ°äº†æœ€å¤§åƒç´ çš„ç›®æ ‡ï¼Œå¹¶ä¸”è¾“å‡ºå®ƒå¯¹äºæ‘„åƒå¤´å›¾åƒå¤§å°çš„Xè½´Yè½´ä½ç½®ã€‚ ![å›¾ 7](../../static/images/docs/diy/tracking cannon/basic/basic 2024 12 21 23 09 46.png) æˆ‘è¿˜åŠ äº†ä¸€äº›è¾…åŠ©å†…å®¹ï¼Œæ¯”å¦‚ç»™å›¾åƒçš„ä¸­å¿ƒç”»ä¸€ä¸ªç»¿è‰²çš„åå­—ã€‚å…¶ä»–å†…å®¹å…·ä½“çœ‹æºç  `main.py`ã€‚ ### èˆµæœºæ§åˆ¶ èˆµæœºæ§åˆ¶çš„åŸºæœ¬åŸç†ï¼Œå‚è€ƒè¯¥åšä¸»çš„æ–‡ç« ï¼š[èˆµæœºç¯‡ï¼ˆä¸€ï¼‰èˆµæœºåŸç†](https://blog.csdn.net/weixin_38288325/article/details/132366604?fromshare blogdetail&sharetype blogdetail&sharerId 132366604&sharerefer PC&sharesource qq_51930953&sharefrom from_link) èˆµæœºæ§åˆ¶ç®€å•æ¥è¯´ï¼Œå°±æ˜¯è¾“å…¥ä¸€ä¸ª20mså‘¨æœŸçš„PWMç»™ä»–ï¼Œé€šè¿‡è°ƒæ•´é«˜ç”µå¹³å ç©ºæ¯”å®ç°èˆµæœºçš„æ—‹è½¬ã€‚ > é¢‘ç‡ç­‰äºå‘¨æœŸçš„å€’æ•°ï¼Œæ‰€ä»¥ `20ms` å‘¨æœŸ `1 / 20` `50 Hz` é¢‘ç‡ åœ¨åºå±±æ´¾K230å¼€å‘æ¿å¼•å‡ºçš„PWMä¸­ï¼ŒPWMåªæœ‰5ä¸ªï¼Œåˆ†åˆ«æ˜¯PWM0~PWM4ã€‚åªæœ‰ç‰¹å®šçš„å¼•è„šæ”¯æŒPWMåŠŸèƒ½ï¼Œå…·ä½“è§ä¸‹å›¾ï¼š ![å›¾ 5](../../static/images/docs/diy/tracking cannon/basic/basic 2024 12 21 22 57 24.png) åœ¨æˆ‘ä»¬çš„èˆµæœºæ¡ˆä¾‹ä¸­ï¼Œä½¿ç”¨çš„æ˜¯ `GPIO46` ã€ `GPIO47` ä¸Šçš„ï¼Œ`PWM2` å’Œ `PWM3`ã€‚ åœ¨ä»£ç ä¸­åˆå§‹åŒ–PWMå‚æ•°å¦‚æœä¸‹ï¼š > é…ç½®æ–¹æ³•å…·ä½“è¯´æ˜ï¼Œè¯·å‚è€ƒç«‹åˆ›å¼€å‘æ¿wikiï¼š[åºå±±æ´¾å¼€å‘æ¿èµ„æ–™ PWM](https://wiki.lckfb.com/zh hans/lushan pi k230/basic/pwm.html) ```python from machine import PWM, FPIOA, Pin # é…ç½®æ’é’ˆå¼•è„šå·12ï¼ŒèŠ¯ç‰‡å¼•è„šå·ä¸º47çš„æ’é’ˆå¤ç”¨ä¸ºPWMé€šé“3è¾“å‡º pwm_io1 FPIOA() pwm_io1.set_function(47, FPIOA.PWM3) # åˆå§‹åŒ–PWMå‚æ•° pwm_ud PWM(3, 50, 50, enable True) # é»˜è®¤é¢‘ç‡50Hz,å ç©ºæ¯”50% 3~12 # é…ç½®æ’é’ˆå¼•è„šå·32ï¼ŒèŠ¯ç‰‡å¼•è„šå·ä¸º46çš„æ’é’ˆå¤ç”¨ä¸ºPWMé€šé“2è¾“å‡º pwm_io2 FPIOA() pwm_io2.set_function(46, FPIOA.PWM2) # åˆå§‹åŒ–PWMå‚æ•° pwm_lr PWM(2, 50, 50, enable True) # é»˜è®¤é¢‘ç‡50Hz,å ç©ºæ¯”50% 2~13 pwm_lr.duty(7.5) #æ—‹è½¬åˆ°ä¸­é—´ pwm_ud.duty(7.7) #æ—‹è½¬åˆ°ä¸­é—´ ``` åœ¨æ¡ˆä¾‹ä¸­ï¼Œæˆ‘å°†å·¦å³æ—‹è½¬çš„èˆµæœºå‘½åä¸º `pwm_lr` ï¼Œä¸Šä¸‹æ—‹è½¬çš„èˆµæœºå‘½åä¸º `pwm_ud` ã€‚ åœ¨ä¸Šé¢çš„æ¡ˆä¾‹ä¸­è¿˜æœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦è¯´æ˜ï¼Œæˆ‘ä¸ºäº†è®©èˆµæœºä¸€ä¸Šç”µå°±é»˜è®¤æ—‹è½¬åˆ°ä¸­é—´ï¼Œè®¾ç½®äº†ä¸¤ä¸ªèˆµæœºåŠ¨ä½œï¼š ```python pwm_lr.duty(7.5) #æ—‹è½¬åˆ°ä¸­é—´ pwm_ud.duty(7.7) #æ—‹è½¬åˆ°ä¸­é—´ ``` è¿™é‡Œçš„ `7.5` æŒ‡çš„æ˜¯å ç©ºæ¯”çš„ç™¾åˆ†æ¯”ï¼Œå³7.5%çš„é«˜ç”µå¹³å ç©ºæ¯”ã€‚æˆ‘ä»¬æ¥æ±‚ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆ7.5æ˜¯ä¸­é—´ã€‚æˆ‘ä»¬ç°åœ¨çŸ¥é“äº†ä»¥ä¸‹å‚æ•°ï¼š * PWMå‘¨æœŸä¸º `20 ms` * PWMé¢‘ç‡ä¸º `50 Hz` * é«˜ç”µå¹³çš„å ç©ºæ¯”ä¸º `7.5%` æ±‚æˆ‘ä»¬å½“å‰æ—‹è½¬çš„è§’åº¦ã€‚ æ ¹æ®180åº¦æ—‹è½¬çš„èˆµæœºæ§åˆ¶åŸç†ï¼Œå¯ä»¥çŸ¥é“èˆµæœºæ—‹è½¬è§’åº¦å’Œå‘¨æœŸçš„å…³ç³»å¦‚ä¸‹å›¾ï¼š ![å›¾ 8](../../static/images/docs/diy/tracking cannon/basic/basic 2024 12 21 23 39 34.png) æˆ‘ä»¬åªè¦æ§åˆ¶åœ¨20msçš„å‘¨æœŸå†…çš„é«˜ç”µå¹³æ—¶é—´ï¼Œå°±å¯ä»¥æ§åˆ¶èˆµæœºçš„æ—‹è½¬è§’åº¦ã€‚ é‚£ä¹ˆè·å–é«˜ç”µå¹³æ—¶é—´å…¬å¼å¦‚ä¸‹ï¼š <center> é«˜ç”µå¹³æ—¶é—´ PWMå‘¨æœŸ Ã— å ç©ºæ¯” </center> å‚ç…§ä¹‹å‰çš„å‚æ•° å¸¦å…¥å¾—åˆ°ï¼š <center> é«˜ç”µå¹³æ—¶é—´ 20 ms Ã— 0.075ï¼ˆ7.5%ï¼‰ </center> é«˜ç”µå¹³çš„æ—¶é—´æ˜¯ `1.5` æ¯«ç§’ ã€‚ è€Œ `1.5 ms` å°±æ˜¯æ§åˆ¶èˆµæœºæ—‹è½¬åˆ°0åº¦ã€‚æ‰€ä»¥ä»£ç ä¸­è®¾ç½® `7.5%` çš„å ç©ºæ¯”å°±æ˜¯è®©èˆµæœºæ—‹è½¬åˆ°ä¸­é—´ï¼ˆèˆµæœºæœ€å·¦æ˜¯ 90åº¦ï¼Œä¸­é—´æ˜¯0åº¦ï¼Œæœ€å³æ˜¯90åº¦ï¼‰ã€‚ è€Œä¸Šä¸‹æ—‹è½¬çš„èˆµæœºå ç©ºæ¯”ï¼Œæˆ‘è®¾ç½®ä¸ºäº†7.7%ï¼Œè¿™ä¸ªæ˜¯æˆ‘çš„æµ‹è¯•å€¼ï¼Œæµ‹è¯•å‡ºæ¥çš„èˆµæœºæ—‹è½¬æ¯”è¾ƒæ¥è¿‘ä¸­é—´çš„å€¼ï¼Œå¤§å®¶è‡ªè¡Œæµ‹è¯•ã€‚ ç°åœ¨180åº¦çš„èˆµæœºï¼Œæˆ‘ä»¬å°†å…¶åˆ†æˆä¸º ` 90~90åº¦` çš„èŒƒå›´ã€‚æˆ‘ä»¬è¿˜è¦çŸ¥é“3ä¸ªå‚æ•°ï¼š 1. æœ€å¤§è§’åº¦ `90åº¦` æ—¶æˆ‘ä»¬è¦è®¾ç½®å¤šå°‘å ç©ºæ¯”ï¼› 2. æœ€å°è§’åº¦ ` 90åº¦` æ—¶æˆ‘ä»¬è¦è®¾ç½®å¤šå°‘å ç©ºæ¯”ï¼› 3. ä¸­é—´è§’åº¦ `0åº¦` æ—¶æˆ‘ä»¬è¦è®¾ç½®å¤šå°‘å ç©ºæ¯”ï¼› ç»è¿‡æˆ‘è‡ªå·±å®æµ‹ï¼Œä¸Šä¸‹åŠ¨ä½œçš„èˆµæœºå ç©ºæ¯”èŒƒå›´æ˜¯ `2.5~12.5%` çš„å ç©ºæ¯”ï¼Œ`2.5% `å ç©ºæ¯”æ—¶è§’åº¦æœ€å°ï¼Œ`12.5%` å ç©ºæ¯”æ—¶è§’åº¦æœ€å¤§ï¼Œ`7.5%` å ç©ºæ¯”æ—¶è§’åº¦å±…ä¸­ã€‚ > **ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ç†è®ºå€¼è®¡ç®—ï¼Ÿè€Œæ˜¯è¦æ‰‹åŠ¨æµ‹è¯•å‘¢ï¼Ÿ** > è¿™ä¸ªæ˜¯å› ä¸ºèˆµæœºäº‘å°ç»“æ„çš„åŸå› ï¼Œæ¯”å¦‚ä¸Šä¸‹æ—‹è½¬çš„èˆµæœºæˆ‘ä»¬è®¾ç½®æ—‹è½¬ä¸ºäº†0åº¦ï¼Œä½†æ˜¯å› ä¸ºç»“æ„ä¸Šçš„åŸå› ï¼Œèˆµæœºè½¬ä¸åˆ°0åº¦ï¼Œå®ƒè¢«ç»“æ„æ¡†ä½“å¡æ­»äº†ï¼Œè¿™ä¸ªå°±æ˜¯èµŒæ­»ç°è±¡ï¼šæ²¡æœ‰è½¬åˆ°0åº¦ï¼Œèˆµæœºå°±ä¸€ç›´è½¬ã€‚ > ä¸ºäº†é˜²æ­¢å µæ­»çš„ç°è±¡å‡ºç°ï¼Œå°±éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æµ‹è¯•ä¸€ä¸ªå®‰å…¨çš„æ—‹è½¬èŒƒå›´ã€‚ è¿™é‡Œä»¥Yè½´ä¸¾ä¾‹(Yè½´å°±æ˜¯ä¸Šä¸‹æ—‹è½¬çš„èˆµæœº)ï¼Œç°åœ¨Yè½´çš„èŒƒå›´åœ¨æ‘„åƒå¤´é‡‡é›†çš„å›¾åƒä¸­æ˜¯ `0 ~ 479` ä¸ªåƒç´ ï¼Œå±å¹•çš„ä¸­å¿ƒå€¼å°±æ˜¯ `480/2 240` ï¼Œè€ŒYè½´çš„èŒƒå›´æ˜¯ä» `0` å¼€å§‹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—å‡ä¸€ï¼Œå±å¹•çš„ä¸­å¿ƒå€¼å°±æ˜¯ `239` ã€‚æˆ‘ä»¬ä»¥å±å¹•ä¸­å¿ƒä¸ºå‚è€ƒï¼Œ **å½“Yè½´çš„å€¼å°äº239æ—¶**ï¼Œæˆ‘ä»¬å°±åˆ¤æ–­è¯†åˆ«ç‰©ä½“æ˜¯ä¸Šæ–¹ï¼› **å½“Yè½´çš„å€¼å¤§äº239æ—¶**ï¼Œæˆ‘ä»¬å°±åˆ¤æ–­è¯†åˆ«ç‰©ä½“æ˜¯ä¸‹æ–¹ï¼› **å½“Yè½´çš„å€¼ç­‰äº239æ—¶**ï¼Œæˆ‘ä»¬å°±åˆ¤æ–­è¯†åˆ«çš„ç‰©ä½“æ˜¯Yè½´ä¸­å¿ƒï¼› ![å›¾ 9](../../static/images/docs/diy/tracking cannon/basic/basic 2024 12 22 00 00 10.png) æˆ‘ä¸ªäººè§‰å¾—å…¨éƒ¨æ˜¯æ­£æ•°çš„èŒƒå›´ï¼Œä¸æ–¹ä¾¿æˆ‘ä»¬å»å¤„ç†èˆµæœºï¼Œ0 ~ 238æ˜¯ä¸Šæ–¹ï¼Œ239æ˜¯ä¸­é—´ï¼Œ240 ~ 379æ˜¯ä¸‹æ–¹ï¼Œè¿™æ ·ä¸å¥½å¸¦å…¥åˆ°æˆ‘ä»¬åé¢çš„èˆµæœºæ§åˆ¶ä¸­ã€‚ä¸ºäº†æ›´åŠ æ–¹ä¾¿æˆ‘è‡ªå·±ï¼Œæˆ‘å°†å…¶Yè½´èŒƒå›´ä¿®æ”¹å¦‚ä¸‹ï¼š æ•°å€¼èŒƒå›´ è¯´æ˜ : : : : 239~0 ä¸Šæ–¹ 0 ä¸­é—´ 0~239 ä¸‹æ–¹ è¿™æ ·åˆ†å¸ƒåæˆ‘ä»¬å°±çŸ¥é“è´Ÿæ•°æ˜¯ä¸Šï¼Œæ­£æ•°æ˜¯ä¸‹ï¼Œæˆ‘ä»¬è¦è®©èˆµæœºå°½é‡å¾€ä¸­é—´ï¼ˆå°±æ˜¯0çš„ä½ç½®ï¼‰ç§»åŠ¨ã€‚ å®ç°çš„ä»£ç ï¼š > å®ç°äº†Xè½´å’ŒYè½´è·ç¦»ä¸­å¿ƒçš„ä½ç½®åé¦ˆ ```python # å¦‚æœæ‰¾åˆ°äº†è‡³å°‘ä¸€ä¸ªblob if blobs: # æ‰¾åˆ°æœ€å¤§çš„blob largest_blob max(blobs, key lambda b: b.pixels()) # ç”»æ¡† img.draw_rectangle(largest_blob.rect(), color (255, 0, 0)) # åœ¨æ¡†å†…ç”»åå­—ï¼Œæ ‡è®°ä¸­å¿ƒç‚¹ img.draw_cross(largest_blob.cx(), largest_blob.cy(), color (255, 0, 0)) # è®¡ç®—ç›¸å¯¹äºå±å¹•ä¸­å¿ƒçš„Xè½´å’ŒYè½´çš„åç§»é‡ x_offset largest_blob.cx() img.width() // 2 y_offset largest_blob.cy() img.height() // 2 # å±å¹•æ˜¾ç¤ºä½ç½®ä¿¡æ¯å’Œåƒç´ å¤§å°ï¼ŒåŒ…å«æ­£è´Ÿå· wz \"x {}, y {}, w {}, h {}\".format(x_offset, y_offset, largest_blob.w(), largest_blob.h()) img.draw_string_advanced(0,0,32,wz) ``` >! **æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼šå¦‚ä½•å°†Yè½´çš„æ•°å€¼åé¦ˆç»™èˆµæœºè®©å®ƒæŒ‰ç…§æˆ‘ä»¬è®¾ç½®çš„æ–¹å‘åŠ¨ä½œï¼Ÿ** æ¥ä¸‹æ¥äº†è§£ä¸€ä¸‹æˆ‘çš„æƒ³æ³•ï¼Œæˆ‘ä»¬è¦è®©èˆµæœºå¾€Yè½´çš„ä¸­å¿ƒ 0 å»åŠ¨ä½œã€‚ å½“è¯†åˆ«ç‰©ä½“Yè½´ä¸º 239 ~ 0æ—¶ï¼Œæˆ‘ä»¬è®©èˆµæœºå‘ä¸‹ï¼Œç›´åˆ°è¯†åˆ«ç‰©ä½“Yè½´çš„æ•°å€¼ä¸º0ï¼› å½“è¯†åˆ«ç‰©ä½“Yè½´ä¸º0 ~ 239 æ—¶ï¼Œæˆ‘ä»¬è®©èˆµæœºå‘ä¸Šï¼Œç›´åˆ°è¯†åˆ«ç‰©ä½“Yè½´çš„æ•°å€¼ä¸º0ï¼› **ç°åœ¨è¿™ä¸ªYè½´å°±æ˜¯èˆµæœºè§’åº¦ä¸ç›®æ ‡æ–¹ä½çš„è¯¯å·®ï¼æˆ‘ä»¬è¦è®©è¯¯å·®å°½é‡ä¿æŒä¸º0ï¼** é¦–å…ˆæ˜¯è€ƒè™‘å¦‚ä½•è§£å†³æ•°å€¼ä¸å¯¹ç­‰é—®é¢˜ã€‚èˆµæœºçš„èŒƒå›´æ˜¯ `2.5 ~ 12.5`ï¼ŒYè½´çš„èŒƒå›´æ˜¯ ` 239 ~ +239` ï¼Œæˆ‘ä»¬è¦å°†Yè½´çš„æ•°å€¼å‹ç¼©åˆ° `2.5 ~ 12.5` çš„èŒƒå›´ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç å®ç°ï¼š ```python # DETECT_WIDTH 640 # DETECT_HEIGHT 480 # min_duty 2.5 #æœ€å°å ç©ºæ¯” # max_duty 12.5 #æœ€å¤§å ç©ºæ¯” ## å°†Yè½´åç§»æ•°å€¼è½¬æ¢ä¸ºå ç©ºæ¯”çš„å‡½æ•° def input_to_duty_cycle(input_min, input_max, input_value): # å®šä¹‰è¾“å…¥è¾“å‡ºèŒƒå›´ # input_min (DETECT_HEIGHT // 2) # input_max (DETECT_HEIGHT // 2) output_min min_duty output_max max_duty # æ£€æŸ¥è¾“å…¥æ˜¯å¦è¶Šç•Œ if input_value < input_min or input_value > input_max: raise ValueError(f\"è¾“å…¥å€¼å¿…é¡»åœ¨ {input_min} å’Œ {input_max} ä¹‹é—´\") # è®¡ç®—çº¿æ€§æ˜ å°„å…¬å¼ slope (output_max output_min) / (input_max input_min) output_value output_min + (input_value input_min) * slope return output_value ``` ç°åœ¨è§£å†³äº†è¿™ä¸ªæ•°å€¼ä¸å¯¹ç­‰é—®é¢˜ï¼Œèˆµæœºçš„å±…ä¸­è§’åº¦æ˜¯ `7.5`ï¼Œå½“è¯†åˆ«ç‰©ä½“åœ¨ä¸Šæ–¹æ—¶ï¼Œèˆµæœºçš„æ•°å€¼è¾“å‡ºå°äº `7.5` ; å½“è¯†åˆ«ç‰©ä½“åœ¨ä¸‹æ–¹æ—¶ï¼Œèˆµæœºçš„æ•°å€¼è¾“å‡ºå¤§äº7.5; å®Œæ•´ä»£ç ï¼š ```python import time, os, gc, sys, math,utime from machine import PWM, FPIOA, Pin, UART from media.sensor import * from media.display import * from media.media import * from pid import PID DETECT_WIDTH 640 DETECT_HEIGHT 480 sensor None ###############################èˆµæœºé…ç½®##################################################### # 2.5 90åº¦ 7.5 0åº¦ 12.5 90åº¦ min_duty 2.5 #æœ€å°å ç©ºæ¯” max_duty 12.5 #æœ€å¤§å ç©ºæ¯” mid_duty 7.5 # ä¸­é—´å€¼ï¼Œå¯¹åº”äº0åº¦ pwm_lr None # é…ç½®æ’é’ˆå¼•è„šå·12ï¼ŒèŠ¯ç‰‡å¼•è„šå·ä¸º47çš„æ’é’ˆå¤ç”¨ä¸ºPWMé€šé“3è¾“å‡º pwm_io1 FPIOA() pwm_io1.set_function(47, FPIOA.PWM3) # åˆå§‹åŒ–PWMå‚æ•° pwm_ud PWM(3, 50, 50, enable True) # é»˜è®¤é¢‘ç‡50Hz,å ç©ºæ¯”50% 3~12 # é…ç½®æ’é’ˆå¼•è„šå·32ï¼ŒèŠ¯ç‰‡å¼•è„šå·ä¸º46çš„æ’é’ˆå¤ç”¨ä¸ºPWMé€šé“2è¾“å‡º pwm_io2 FPIOA() pwm_io2.set_function(46, FPIOA.PWM2) # åˆå§‹åŒ–PWMå‚æ•° pwm_lr PWM(2, 50, 50, enable True) # é»˜è®¤é¢‘ç‡50Hz,å ç©ºæ¯”50% 2~13 pwm_lr.duty(7.5) #æ—‹è½¬åˆ°ä¸­é—´ pwm_ud.duty(7.7) #æ—‹è½¬åˆ°ä¸­é—´ ########################################################################################## ## å°†Yè½´åç§»æ•°å€¼è½¬æ¢ä¸ºå ç©ºæ¯”çš„å‡½æ•° def input_to_duty_cycle(input_min, input_max, input_value): # å®šä¹‰è¾“å…¥è¾“å‡ºèŒƒå›´ # input_min (DETECT_HEIGHT // 2) # input_max (DETECT_HEIGHT // 2) output_min min_duty output_max max_duty # æ£€æŸ¥è¾“å…¥æ˜¯å¦è¶Šç•Œ if input_value < input_min or input_value > input_max: raise ValueError(f\"è¾“å…¥å€¼å¿…é¡»åœ¨ {input_min} å’Œ {input_max} ä¹‹é—´\") # è®¡ç®—çº¿æ€§æ˜ å°„å…¬å¼ slope (output_max output_min) / (input_max input_min) output_value output_min + (input_value input_min) * slope return output_value try: # åˆå§‹åŒ–æ‘„åƒå¤´ sensor Sensor(width DETECT_WIDTH, height DETECT_HEIGHT) # ä¼ æ„Ÿå™¨å¤ä½ sensor.reset() # å¼€å¯é•œåƒ sensor.set_hmirror(True)#False # sensor vflip sensor.set_vflip(True)#False True # è®¾ç½®å›¾åƒä¸€å¸§çš„å¤§å° sensor.set_framesize(width DETECT_WIDTH, height DETECT_HEIGHT) # è®¾ç½®å›¾åƒè¾“å‡ºæ ¼å¼ä¸ºå½©è‰²çš„RGB565 sensor.set_pixformat(Sensor.RGB565) # ä½¿ç”¨IDEæ˜¾ç¤ºå›¾åƒ Display.init(Display.VIRT, width DETECT_WIDTH, height DETECT_HEIGHT, fps 100) # åˆå§‹åŒ–åª’ä½“ç®¡ç†å™¨ MediaManager.init() # æ‘„åƒå¤´ä¼ æ„Ÿå™¨å¼€å¯è¿è¡Œ sensor.run() # å®šä¹‰è¦è¯†åˆ«é¢œè‰²çš„é˜ˆå€¼ï¼Œè¿™é‡Œéœ€è¦æ ¹æ®ä½ çš„å…·ä½“æƒ…å†µè°ƒæ•´ # ä½ å¯ä»¥é€šè¿‡å°è¯•ä¸åŒçš„é˜ˆå€¼æ¥æ‰¾åˆ°æœ€é€‚åˆä½ çš„ç‰©ä½“é¢œè‰²å€¼ red_threshold (0, 42, 17, 94, 6, 50) while True: # æ‹æ‘„ä¸€å¼ å›¾ç‰‡ img sensor.snapshot() # æŸ¥æ‰¾å›¾åƒä¸­æ»¡è¶³çº¢è‰²é˜ˆå€¼çš„åŒºåŸŸ blobs img.find_blobs([red_threshold], pixels_threshold 200, area_threshold 200, merge True) # å¦‚æœæ‰¾åˆ°äº†è‡³å°‘ä¸€ä¸ªblob if blobs: # æ‰¾åˆ°æœ€å¤§çš„blob largest_blob max(blobs, key lambda b: b.pixels()) # ç”»æ¡† img.draw_rectangle(largest_blob.rect(), color (255, 0, 0)) # åœ¨æ¡†å†…ç”»åå­—ï¼Œæ ‡è®°ä¸­å¿ƒç‚¹ img.draw_cross(largest_blob.cx(), largest_blob.cy(), color (255, 0, 0)) # è®¡ç®—ç›¸å¯¹äºå±å¹•ä¸­å¿ƒçš„Xè½´å’ŒYè½´çš„åç§»é‡ x_offset largest_blob.cx() img.width() // 2 y_offset largest_blob.cy() img.height() // 2 # å±å¹•æ˜¾ç¤ºä½ç½®ä¿¡æ¯å’Œåƒç´ å¤§å°ï¼ŒåŒ…å«æ­£è´Ÿå· wz \"x {}, y {}, w {}, h {}\".format(x_offset, y_offset, largest_blob.w(), largest_blob.h()) img.draw_string_advanced(0,0,32,wz) duty_ud_value input_to_duty_cycle( (DETECT_HEIGHT // 2), (DETECT_HEIGHT // 2), y_offset) print(duty_ud_value) # ä¸­å¿ƒç”»åå­— img.draw_cross(img.width() // 2, img.height() // 2, color (0, 255, 0), size 10, thickness 3) # IDEæ˜¾ç¤ºå›¾ç‰‡ Display.show_image(img) except KeyboardInterrupt as e: print(f\"user stop\") except BaseException as e: print(f\"Exception {e}\") finally: # sensor stop run if isinstance(sensor, Sensor): sensor.stop() # deinit display Display.deinit() if isinstance(pwm_lr, PWM): pwm_lr.deinit() # release media buffer MediaManager.deinit() os.exitpoint(os.EXITPOINT_ENABLE_SLEEP) time.sleep_ms(100) ``` ![å›¾ 9](../../static/images/docs/diy/tracking cannon/basic/basic 2025 06 26 22 53 07.gif) å¦‚æœæˆ‘ä»¬å°†æ‘„åƒå¤´å›ºå®šåœ¨èˆµæœºä¸Šï¼Œèˆµæœºç§»åŠ¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„æ‘„åƒå¤´ä¹Ÿç§»åŠ¨ã€‚é‚£æŒ‰ç…§æƒ³æ³•å°±æ˜¯å±å¹•è·Ÿèˆµæœºä¸€èµ·åŠ¨ï¼Œè¿™æ ·å°±èƒ½å¤Ÿç¨³å®šçš„å›ºå®šåˆ°ä¸­å¿ƒï¼Œå®ç°äº†è¯†åˆ«ç„å‡†åŠŸèƒ½ã€‚ å°†è¿™ä¸ªä»£ç ç›´æ¥åº”ç”¨åˆ°èˆµæœºä¸Šçš„æ•ˆæœ: GIFåŠ¨å›¾ï¼ˆæ²¡æœ‰PIDçš„ç›´æ¥æ§åˆ¶ï¼‰ ![å›¾ 15](../../static/images/docs/diy/tracking cannon/basic/basic 2025 06 26 23 03 47.gif) ### PIDè‡ªåŠ¨æ§åˆ¶ å¤§å®¶æ ¹æ®ä¸Šé¢çš„èˆµæœºæ§åˆ¶ç« èŠ‚ï¼Œåº”è¯¥æ˜¯å¯ä»¥å®ç°æœ€ç®€å•çš„èˆµæœºè¿½è¸ªåŠŸèƒ½ï¼Œä½†æ˜¯å¤§å®¶ä¼šå‘ç°æœ‰ä¸ç¨³å®šæˆ–è€…æŠ–åŠ¨çš„ç°è±¡ï¼Œæ¯”å¦‚æˆ‘ä¸¾ä¸€äº›ä¾‹å­ï¼š 1. å½“è¯†åˆ«ç›®æ ‡å¿«é€Ÿè¿åŠ¨æ—¶ï¼Œèˆµæœºçš„è¿åŠ¨é€Ÿåº¦ä¸ä¼šè·Ÿç€è¯†åˆ«ç›®æ ‡çš„é€Ÿåº¦è€Œè¿›è¡Œå˜åŒ–ï¼Œä¸€ç›´ä¿æŒä¸€ä¸ªé€Ÿåº¦ï¼› 2. è¶…è°ƒç°è±¡ã€‚è¯¯å·®å·²ç»åˆ°0äº†ï¼Œä½†æ˜¯å› ä¸ºèˆµæœºçš„æ—‹è½¬æƒ¯æ€§ï¼Œï¼ˆå‡è®¾çš„ï¼Œå®é™…çš„èˆµæœºé€Ÿåº¦ä¸€ç›´ä¸å˜æƒ¯æ€§å¾ˆå°ï¼‰å¯¼è‡´ä¼šè¶…å‡º0è¯¯å·®ï¼Œæ¯”å¦‚ 1 > 0 > 1ï¼Œå› ä¸ºæƒ¯æ€§ä»0åˆ°1äº†ï¼Œåˆä» 1 > 0 > 1ï¼Œå¯¼è‡´æ€ä¹ˆéƒ½ä¸èƒ½æ­£å¸¸çš„è¯¯å·®ä¸º0ï¼Œèˆµæœºä¸€ç›´æŠ–ã€‚ è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±è¦äº†è§£ä¸€ä¸ªæœ€å¸¸ç”¨çš„æ§åˆ¶ç®—æ³•ï¼š**PIDç®—æ³•**ã€‚ #### PIDä»‹ç» PIDæ§åˆ¶å™¨ï¼Œå³æ¯”ä¾‹ ç§¯åˆ† å¾®åˆ†æ§åˆ¶å™¨ï¼Œæ˜¯ä¸€ç§å¹¿æ³›åº”ç”¨äºå·¥ä¸šæ§åˆ¶ç³»ç»Ÿä¸­çš„**åé¦ˆå›è·¯æ§åˆ¶å™¨**ã€‚å®ƒé€šè¿‡æ§åˆ¶ç³»ç»Ÿçš„åå·®ï¼ˆè®¾å®šå€¼ä¸å®é™…å€¼ä¹‹é—´çš„å·®ï¼‰æ¥è°ƒèŠ‚æ§åˆ¶å˜é‡ï¼Œä½¿å¾—ç³»ç»Ÿè¾¾åˆ°æˆ–ç»´æŒåœ¨ä¸€ä¸ªé¢„å®šçš„çŠ¶æ€ã€‚PIDæ§åˆ¶å™¨ç”±ä¸‰ä¸ªåŸºæœ¬æ§åˆ¶åŠ¨ä½œç»„æˆï¼š`æ¯”ä¾‹ï¼ˆProportionalï¼‰`ã€`ç§¯åˆ†ï¼ˆIntegralï¼‰` å’Œ `å¾®åˆ†ï¼ˆDerivativeï¼‰` ï¼Œä¸‹é¢è¯¦ç»†ä»‹ç»è¿™ä¸‰ä¸ªéƒ¨åˆ†ï¼š **æ¯”ä¾‹ï¼ˆPï¼‰æ§åˆ¶** æ¯”ä¾‹æ§åˆ¶çš„ä½œç”¨æ˜¯æ ¹æ®è®¾å®šå€¼ä¸å®é™…å€¼ä¹‹é—´çš„è¯¯å·®ï¼ˆeï¼‰ï¼Œè¿›è¡Œæ¯”ä¾‹æ”¾å¤§åä½œä¸ºæ§åˆ¶è¾“å‡ºã€‚å…¶æ•°å­¦è¡¨è¾¾å¼ä¸ºï¼š <center> P Kp * e </center> å…¶ä¸­ï¼Œ`Kp` æ˜¯æ¯”ä¾‹å¢ç›Šï¼Œå†³å®šäº†æ¯”ä¾‹æ§åˆ¶çš„å¼ºåº¦ã€‚æ¯”ä¾‹æ§åˆ¶çš„ç‰¹ç‚¹æ˜¯åŠ¨ä½œå¿«é€Ÿç›´æ¥ï¼Œ**ä½†é€šå¸¸ä¼šå­˜åœ¨ä¸€ä¸ªç¨³æ€è¯¯å·®ï¼Œå³ç³»ç»Ÿç¨³å®šåï¼Œè¾“å‡ºå€¼ä¸è®¾å®šå€¼ä¹‹é—´ä»ä¼šæœ‰ä¸€å®šçš„å·®è·ã€‚** .. details::è¯¯å·®çš„è¯´æ˜ï¼Œç‚¹å‡»å±•å¼€ æ ¹æ®è®¾å®šå€¼ä¸å®é™…å€¼ä¹‹é—´çš„è¯¯å·®ï¼ˆeï¼‰ï¼Œåº”è¯¥å¾ˆå¥½ç†è§£ ï¼Œæˆ‘ä»¬ä¹‹å‰çš„èˆµæœºæ§åˆ¶ç« èŠ‚å°±è¯´æ˜äº†è¯¯å·®çš„æ¦‚å¿µï¼Œå°½å¯èƒ½çš„è®©è¯¯å·®ä¸º0ã€‚ å®é™…å€¼å°±æ˜¯æ‘„åƒå¤´è¯†åˆ«ç‰©ä½“çš„æ–¹ä½ï¼› è®¾å®šå€¼å°±æ˜¯æ‘„åƒå¤´é‡‡é›†çš„å›¾åƒä¸­å¿ƒï¼› æˆ‘ä»¬è¦è®©å›¾åƒä¸­å¿ƒæ¥è¿‘ç‰©ä½“æ–¹ä½ã€‚è®©å®ƒä»¬çš„è¯¯å·®è¶Šæ¥è¶Šå°ï¼Œç›´åˆ°ä¸º0ã€‚ .. details::ç¨³æ€è¯¯å·®çš„è¯´æ˜ï¼Œç‚¹å‡»å±•å¼€ å³ç³»ç»Ÿç¨³å®šåï¼Œè¾“å‡ºå€¼ä¸è®¾å®šå€¼ä¹‹é—´ä»ä¼šæœ‰ä¸€å®šçš„å·®è·ã€‚å°±æ˜¯è¯¯å·®å€¼æ˜æ˜æ˜¯0äº†ï¼Œä½†æ˜¯å®é™…ä¸Šå´æ˜¯åœ¨1~2ä¹‹é—´å¾˜å¾Šï¼Œå°±æ˜¯åˆ°ä¸äº†0ã€‚ **ç§¯åˆ†ï¼ˆIï¼‰æ§åˆ¶** ç§¯åˆ†æ§åˆ¶çš„ä½œç”¨æ˜¯å¯¹åå·®è¿›è¡Œç§¯åˆ†è¿ç®—ï¼Œ**ä»¥æ¶ˆé™¤ç¨³æ€è¯¯å·®**ã€‚ç§¯åˆ†ä½œç”¨è€ƒè™‘äº†è¯¯å·®çš„å†å²ç´¯ç§¯ï¼Œå…¶æ•°å­¦è¡¨è¾¾å¼ä¸º <center> ![å›¾ 12](../../static/images/docs/diy/tracking cannon/basic/basic 2024 12 22 00 35 56.png) </center> > ä½ ä¹Ÿå¯ä»¥è¿™ä¹ˆçœ‹è¿™ä¸ªå‚æ•°ï¼šI Ki * eçš„å†å²ç´¯ç§¯ å…¶ä¸­ï¼Œ`Ki` æ˜¯ç§¯åˆ†å¢ç›Šã€‚ç§¯åˆ†æ§åˆ¶èƒ½å¤Ÿæ¶ˆé™¤ç¨³æ€è¯¯å·®ï¼Œ**ä½†å¯èƒ½ä¼šå¼•èµ·ç³»ç»Ÿçš„å“åº”é€Ÿåº¦å˜æ…¢ï¼Œå¹¶ä¸”å¯èƒ½é€ æˆç³»ç»Ÿçš„è¶…è°ƒå’ŒæŒ¯è¡ã€‚** .. details::è¶…è°ƒå’ŒæŒ¯è¡çš„è¯´æ˜ï¼Œç‚¹å‡»å±•å¼€ \t**è¶…è°ƒ** æ„å‘³ç€ç³»ç»Ÿè¾“å‡ºè¶…è¿‡äº†è®¾å®šå€¼ï¼Œæ¯”å¦‚ä½ çš„èˆµæœºå€¼è®¾å®šèŒƒå›´æ˜¯`2.5~12.5%` ï¼Œä½†æ˜¯PIDè®¡ç®—çš„ç»“æœè¶…è¿‡äº†12.5ï¼Œå˜æˆ15ï¼Ÿ20ï¼Ÿ100ï¼Ÿæˆ–è€…æ›´é«˜ï¼Œè¿™ä¸ªæ˜¯ä¸¥é‡çš„é—®é¢˜ï¼› **æŒ¯è¡** åˆ™æ˜¯æŒ‡ç³»ç»Ÿåœ¨è®¾å®šå€¼é™„è¿‘åå¤æ³¢åŠ¨ï¼Œå°±æ˜¯çŒ›è¿‡å¤´äº†ï¼Œååº”è¿‡æ¿€ï¼Œåˆ¹è½¦ä¸äº†ã€‚ **å¾®åˆ†ï¼ˆDï¼‰æ§åˆ¶** å¾®åˆ†æ§åˆ¶çš„ä½œç”¨æ˜¯æ ¹æ®è¯¯å·®å˜åŒ–çš„é€Ÿç‡ï¼ˆå³åå·®çš„å¾®åˆ†ï¼‰æ¥è¿›è¡Œæ§åˆ¶ï¼Œä»¥é¢„æµ‹è¯¯å·®çš„æœªæ¥è¶‹åŠ¿ã€‚å¾®åˆ†ä½œç”¨çš„æ•°å­¦è¡¨è¾¾å¼ä¸ºï¼š <center> ![å›¾ 11](../../static/images/docs/diy/tracking cannon/basic/basic 2024 12 22 00 35 06.png) </center> å…¶ä¸­ï¼Œ`Kd` æ˜¯å¾®åˆ†å¢ç›Šã€‚å¾®åˆ†æ§åˆ¶æœ‰åŠ©äºå‡å°‘ç³»ç»Ÿçš„è¶…è°ƒå’ŒæŒ¯è¡ï¼Œæé«˜ç³»ç»Ÿçš„åŠ¨æ€æ€§èƒ½ï¼Œ**ä½†å®ƒå¯¹å™ªå£°æ•æ„Ÿï¼Œå¯èƒ½ä¼šæ”¾å¤§æ§åˆ¶ä¿¡å·ä¸­çš„å™ªå£°ã€‚** .. details::å™ªå£°çš„è¯´æ˜ï¼Œç‚¹å‡»å±•å¼€ å™ªå£°å°±æ˜¯å¹²æ‰°ï¼Œæˆ‘ä»¬ç”¨ç”µæœºé€Ÿåº¦PIDåšä¸€ä¸ªä¾‹å­ï¼Œå½“å‰æˆ‘ä»¬é€Ÿåº¦ä¸º0ï¼Œæˆ‘ä»¬è®¾ç½®ç›®æ ‡é€Ÿåº¦ä¸º10ï¼Œé€šè¿‡PIDçš„è®¡ç®—ï¼Œç”µæœºæ—‹è½¬é€Ÿåº¦ä¼šé€æ¸æ¥è¿‘10ï¼Œè¿™ä¸ªæ—¶å€™ä½ å»æ‰‹åŠ¨å¹²é¢„å®ƒï¼Œè®©ç”µæœºä¸èƒ½è½¬ï¼Œè¿™ä¸ªå°±æ˜¯å¹²æ‰°ï¼Œä½ å¹²æ‰°äº†ç”µæœºçš„è¿åŠ¨ï¼Œç”µæœºçš„é€Ÿåº¦å˜æ…¢äº†ï¼Œå¯¼è‡´PIDçš„è¯¯å·®åœ¨æ—¶é—´ä¸Šä¸€ç›´è¶Šæ¥è¶Šå¤§ï¼Œé‚£ä¹ˆPIDä¸ºäº†è®©ç”µæœºé€Ÿåº¦æ›´å¿«æ¥è¿‘ç›®æ ‡ï¼ŒPIDè®¡ç®—çš„å€¼å°±è¶Šæ¥è¶Šå¤§ï¼Œç”µæœºçš„æ—‹è½¬åŠ›åº¦å°±è¶Šæ¥è¶Šå¤§ï¼Œç›´åˆ°æŒ£è„±ä½ çš„æŸç¼šã€‚é‚£å¯¹å™ªå£°æ•æ„Ÿï¼Œè¡¨ç¤ºçš„å°±æ˜¯ä½ å¹²æ‰°äº†ä¸€ä¸‹ï¼ŒPIDå°±å´©æºƒäº†ï¼Œå¯¹å™ªå£°äº§ç”Ÿè¿‡å¤§çš„ååº”ï¼Œå¯¼è‡´æ§åˆ¶è¾“å‡ºä¸ç¨³å®šã€‚ **PIDæ§åˆ¶å™¨çš„åŸºæœ¬å½¢å¼** å°†ä¸Šè¿°ä¸‰ä¸ªæ§åˆ¶ä½œç”¨ç»“åˆèµ·æ¥ï¼ŒPIDæ§åˆ¶å™¨çš„ç†è®ºåŸºæœ¬å½¢å¼å¯ä»¥è¡¨ç¤ºä¸ºï¼š <center> ![å›¾ 13](../../static/images/docs/diy/tracking cannon/basic/basic 2024 12 22 00 37 48.png) </center> å…¶ä¸­ `u(t)` æ˜¯æ§åˆ¶å™¨çš„è¾“å‡ºï¼Œ`e(t)` æ˜¯åœ¨æ—¶é—´tæ—¶çš„åå·®ã€‚é€šè¿‡PIDæˆ‘ä»¬å°±èƒ½å¤Ÿè®©èˆµæœºåŠ¨ä½œçš„æ›´åŠ å¿«é€Ÿï¼Œç¨³å®šçš„åˆ°è¾¾æˆ‘ä»¬è®¾ç½®çš„ç›®æ ‡ä½ç½®ã€‚ #### PIDå…¬å¼è½¬ä¸ºä»£ç  ä¸Šé¢çš„åŸç†éƒ¨åˆ†å¤§å®¶çœ‹çœ‹å°±å¯ä»¥äº†ï¼Œæˆ‘ä»¬ä»å®é™…åº”ç”¨å…¥æ‰‹ã€‚é¦–å…ˆå°†ä»¥ä¸ŠPIDæ•°å­¦å…¬å¼è½¬åŒ–ä¸ºä»£ç å…¬å¼ï¼š ```python out (Kp * p) + (Ki * i) + (Kd * d) ``` æ•´ç†å‚æ•°ï¼Œå‚æ•°åˆ†ä¸ºé™æ€å‚æ•°å’ŒåŠ¨æ€å‚æ•°ï¼š ```python #é™æ€å‚æ•° Kp 0 Ki 0 Kd 0 #åŠ¨æ€å‚æ•° i 0\t\t\t#ç§¯åˆ†I e 0\t\t\t#å½“å‰è¯¯å·® last_e 0\t\t#ä¹‹å‰è¯¯å·® max_out 0\t\t#æœ€å¤§è¾“å‡º ``` å°†ä»£ç å…¬å¼ä¸€ä¸€æ‹†åˆ†ï¼Œå¾—åˆ°ä¸‹é¢çš„PIDçš„è®¡ç®—å‡½æ•°ï¼š ```PYTHON def pid_calc(reference, feedback):#reference ç›®æ ‡ä½ç½®\tfeedback å½“å‰ä½ç½® last_e e #æ›´æ–°ä¹‹å‰çš„è¯¯å·® e reference feedback #é€šè¿‡å½“å‰å€¼å’Œç›®æ ‡å€¼è®¡ç®—è·å–æ–°çš„è¯¯å·® #è®¡ç®—æ¯”ä¾‹P p e * Kp #è®¡ç®—ç§¯åˆ†I i + e * Ki #è®¡ç®—å¾®åˆ†D d (e last_e) * Kd #è®¡ç®—PIDè¾“å‡º out p + i + d #è¾“å‡ºé™åˆ¶ if out > max_out: out max_out elif out < max_out: out max_out return out ``` > ! æ³¨æ„ï¼ŒPIDè®¡ç®—æ˜¯è¦å®æ—¶çš„ï¼Œè¯·ç¡®ä¿PIDçš„è®¡ç®—ä¸ä¼šè¢«é˜»å¡å¤ªä¹…ï¼›ç§¯åˆ†`I`æ˜¯ç´¯åŠ çš„ï¼Œå¿…é¡»æ˜¯å…¨å±€å˜é‡ï¼› ç°åœ¨PIDéƒ¨åˆ†çš„ä»£ç åŸºæœ¬å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥æ˜¯æœ€é‡è¦çš„å¦‚ä½•ä½¿ç”¨PIDã€‚æˆ‘å°†PIDçš„ä»£ç ç»™å°è£…æˆä¸ºäº†ä¸€ä¸ªåº“æ–‡ä»¶ä¸Šä¼ åˆ°K230é‡Œé¢ã€‚ ```python class PID: def __init__(self, kp, ki, kd, maxI, maxOut): #é™æ€å‚æ•° self.kp kp self.ki ki self.kd kd #åŠ¨æ€å‚æ•° self.change_p 0 self.change_i 0 self.change_d 0 self.max_change_i maxI #ç§¯åˆ†é™å¹… self.maxOutput maxOut #è¾“å‡ºé™å¹… self.error_sum 0 #å½“å‰è¯¯å·® self.last_error 0 #ä¹‹å‰è¯¯å·® def change_zero(self):#PIDå˜åŒ–ç´¯è®¡çš„å‚æ•°æ¸…é›¶ self.change_p 0 self.change_i 0 self.change_d 0 def pid_calc(self, reference, feedback):#reference ç›®æ ‡ä½ç½®\tfeedback å½“å‰ä½ç½® self.last_error self.error_sum self.error_sum reference feedback #è·å–æ–°çš„è¯¯å·® #è®¡ç®—å¾®åˆ† dout (self.error_sum self.last_error) * self.kd #è®¡ç®—æ¯”ä¾‹ pout self.error_sum * self.kp #è®¡ç®—ç§¯åˆ† self.change_i + self.error_sum * self.ki #ç§¯åˆ†é™å¹… if self.change_i > self.max_change_i : self.change_i self.max_change_i elif self.change_i < self.max_change_i: self.change_i self.max_change_i #è®¡ç®—è¾“å‡º self.output pout + dout + self.change_i #è¾“å‡ºé™å¹… if self.output > self.maxOutput: self.output self.maxOutput elif self.output < self.maxOutput: self.output self.maxOutput return self.output ``` å°†ä¸Šé¢çš„ä»£ç ä¿å­˜ï¼Œå¹¶ä¸”å¯¹æ•´ä¸ªæ–‡ä»¶å‘½åä¸º pid.pyï¼Œå®Œæˆåä¸Šä¼ åˆ°K230çš„sdcardæ–‡ä»¶å¤¹é‡Œé¢ã€‚ ![å›¾ 16](../../static/images/docs/diy/tracking cannon/basic/basic 2025 06 26 23 08 12.png) æ¥ä¸‹æ¥æ˜¯å¦‚ä½•ä½¿ç”¨è¿™ä¸ªåº“ã€‚åœ¨æˆ‘ä»¬çš„main.pyä»£ç ä¸­ï¼Œå¼•å…¥è¯¥æ–‡ä»¶ï¼š ```python from pid import PID ``` ç„¶ååˆ›å»º PID å¯¹è±¡ï¼Œå¹¶å¯¹å…¶é™æ€å‚æ•°è¿›è¡Œè®¾ç½®ï¼š ```python lr_kp 0.013 lr_ki 0.0008 lr_kd 0.016 lr_max_out 12.5 #æœ€å¤§è¾“å‡º pid_lr PID(lr_kp, lr_ki, lr_kd, 10, lr_max_out) #åˆ›å»ºå·¦å³ç”µæœºçš„PIDå¯¹è±¡ ud_kp 0.013 ud_ki 0.00091 ud_kd 0.02 ud_max_out 12.5 #æœ€å¤§è¾“å‡º pid_ud PID(ud_kp, ud_ki, ud_kd, 10, ud_max_out) #åˆ›å»ºä¸Šä¸‹ç”µæœºçš„PIDå¯¹è±¡ ``` åˆ›å»º PID å¯¹è±¡åï¼Œåº”ç”¨åˆ°æˆ‘ä»¬çš„èˆµæœºåŠ¨ä½œä»£ç ä¸­ï¼Œæˆ‘å°†å…³é”®ä»£ç å–å‡ºåˆ†æï¼š ```python # å¦‚æœæ‰¾åˆ°äº†è‡³å°‘ä¸€ä¸ªç›®æ ‡è‰²å— if blobs: # æ‰¾åˆ°æœ€å¤§çš„ç›®æ ‡è‰²å— largest_blob max(blobs, key lambda b: b.pixels()) # ç»™ç›®æ ‡è‰²å—ç”»æ¡†æ ‡è®°å‡ºæ¥ img.draw_rectangle(largest_blob.rect(), color (255, 0, 0)) # åœ¨æ ‡è®°æ¡†å†…ç”»åå­—ï¼Œæ ‡è®°ä¸­å¿ƒç‚¹ img.draw_cross(largest_blob.cx(), largest_blob.cy(), color (255, 0, 0)) # è®¡ç®—ç›®æ ‡è‰²å—ç›¸å¯¹äºå±å¹•ä¸­å¿ƒçš„Xè½´å’ŒYè½´çš„åç§»é‡ x_offset largest_blob.cx() img.width() // 2 y_offset largest_blob.cy() img.height() // 2 # åœ¨å±å¹•æ˜¾ç¤ºç›®æ ‡è‰²å—çš„ä½ç½®ä¿¡æ¯å’Œåƒç´ å¤§å°ï¼ŒåŒ…å«æ­£è´Ÿå· wz \"x {}, y {}, w {}, h {}\".format(x_offset, y_offset, largest_blob.w(), largest_blob.h()) \t# æ˜¾ç¤ºå­—ç¬¦ä¸² img.draw_string_advanced(0,0,32,wz) # æ ¹æ®ä¸­å¿ƒåç§»é‡è®¡ç®—PWMçš„PID # 0ä¸ºç›®æ ‡å€¼ï¼Œx_offsetè¡¨ç¤ºå½“å‰è®¾å®šå€¼ pid_lr_value pid_lr.pid_calc(0,x_offset) pid_ud_value pid_ud.pid_calc(0,y_offset) \t\t\t''' å…³é”®ç‚¹ä¸€ ''' # å°†PIDå€¼è½¬æ¢ä¸ºèˆµæœºçš„èŒƒå›´å¹¶ä¸”è¾“å‡ºå®é™…çš„å ç©ºæ¯” duty_lr_value input_to_duty_cycle(pid_lr_value) duty_ud_value input_to_duty_cycle(pid_ud_value) \t\t\t''' å…³é”®ç‚¹äºŒ ''' # æ ¹æ®è®¡ç®—åçš„å ç©ºæ¯”æ§åˆ¶èˆµæœºåŠ¨ä½œ #pwm_lr.duty(duty_lr_value) #pwm_ud.duty(duty_ud_value) ``` > lrè¡¨ç¤ºå·¦å³æ—‹è½¬çš„èˆµæœºï¼Œudè¡¨ç¤ºä¸Šä¸‹æ—‹è½¬çš„èˆµæœºã€‚ å¤§å®¶å¯ä»¥åœ¨ä¸Šé¢çš„ä»£ç ä¸­çœ‹åˆ° **å…³é”®ç‚¹ä¸€** å’Œ **å…³é”®ç‚¹äºŒ** çš„æ³¨é‡Šï¼Œåœ¨å…³é”®ç‚¹ä¸€çš„ä½ç½®å¯ä»¥é€šè¿‡`print`è¾“å‡ºä¸€ä¸‹`PID`è®¡ç®—åçš„å€¼`pid_lr_value`ï¼›åœ¨å…³é”®ç‚¹äºŒçš„ä½ç½®è¾“å‡ºå®é™…å ç©ºæ¯”å€¼`duty_lr_value`ã€‚ ```python print(f\"pid_lr_value {pid_lr_value}, pid_ud_value {pid_ud_value}\\r\\n\") print(f\"duty_lr_value {duty_lr_value}, duty_ud_value {duty_ud_value}\\r\\n\") ``` ![å›¾ 17](../../static/images/docs/diy/tracking cannon/basic/basic 2025 06 26 23 18 34.gif) #### PIDè°ƒå‚ å½“å¤§å®¶å–æ¶ˆèˆµæœºåŠ¨ä½œçš„æ³¨é‡Šå¹¶ä¸‹è½½æ‰§è¡Œåï¼Œä¼šå‘ç°è¿™ä¸ªPIDçš„æ•ˆæœå¹¶ä¸ç†æƒ³ï¼Œæœ‰çš„ååº”æ…¢ï¼Œæœ‰çš„ååº”å¿«ï¼Œæœ‰çš„åŸºæœ¬æ²¡æœ‰åŠ¨ã€‚è¿™ä¸ªæ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰è°ƒå¥½PIDã€‚ ![å›¾ 19](../../static/images/docs/diy/tracking cannon/basic/basic 2025 06 26 23 36 26.gif) é‚£å¦‚ä½•è°ƒæ•´å¥½PIDçš„å‚æ•°å‘¢ï¼Ÿ åœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦å¯¹PIDæ§åˆ¶å™¨çš„å‚æ•° `Kp \\ Ki \\ Kd` è¿›è¡Œè°ƒæ•´ï¼Œä»¥è¾¾åˆ°ç†æƒ³çš„æ§åˆ¶æ•ˆæœã€‚è¿™é€šå¸¸é€šè¿‡ä»¥ä¸‹æ­¥éª¤è¿›è¡Œï¼š * **å…ˆè®¾å®šæ¯”ä¾‹å¢ç›Š `Kp`** ï¼šä½¿ç³»ç»Ÿå“åº”å¿«é€Ÿï¼Œä½†å¯èƒ½ä¼šå‡ºç°ç¨³æ€è¯¯å·®ã€‚ * **è°ƒæ•´ç§¯åˆ†å¢ç›Š `Ki`** ï¼šæ¶ˆé™¤ç¨³æ€è¯¯å·®ï¼Œä½†è¦æ³¨æ„è¶…è°ƒå’ŒæŒ¯è¡ã€‚ * **æœ€åè°ƒæ•´å¾®åˆ†å¢ç›Š `Kd`** ï¼šæ”¹å–„ç³»ç»Ÿçš„åŠ¨æ€è¡Œä¸ºï¼Œå‡å°‘è¶…è°ƒå’ŒæŒ¯è¡ã€‚ æˆ‘è°ƒè¯• PID æ˜¯é€šè¿‡ä¸²å£ å’Œ [Vofa+å·¥å…·](https://www.vofa.plus/)ã€‚Vofa+æ˜¯ä¸€æ¬¾ä¸Šä½æœºå·¥å…·ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºç›®å‰å¯¹è¿™ä¸ªé¡¹ç›®æ¥è¯´æœ€å¤§çš„ä½œç”¨æ˜¯æ˜¾ç¤ºå‡ºæ•°æ®æ³¢å½¢å˜åŒ–ã€‚ <table> <thead> <tr> <th><img src \"../../static/images/docs/diy/tracking cannon/basic/basic 2025 06 26 23 23 55.png\" width \"1200\"></th> </tr> <tr> <th><center>Vofa+ ä¸Šä½æœºç•Œé¢</center></th> </tr> </thead> </table> ç›®å‰æˆ‘è¿˜ä¸çŸ¥é“K230çš„å•æ­¥è°ƒè¯•æ‰‹æ®µï¼Œæ‰€ä»¥åªèƒ½ç›²è°ƒPIDï¼šè®¾ç½®ä¸€ä¸ªP\\I\\Då€¼ï¼Œç„¶åçœ‹PIDè¾“å‡ºçš„æ•°æ®æ›²çº¿å’Œç›®æ ‡æ•°æ®æ›²çº¿çš„å·®åˆ«ã€‚å¦‚æœè¯¯å·®å¾ˆå¤§ï¼Œåˆ™é‡æ–°è®¾ç½®ä¸€ä¸ªP\\I\\Då€¼ç»§ç»­è°ƒåˆ°è¯¯å·®å°ä¸ºæ­¢ã€‚ å½“ç„¶ï¼Œå¦‚æœæœ‰æ—¶é—´å’Œç²¾åŠ›ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å†™ä¸€å¥—é€šè¿‡ä¸²å£è°ƒæ•´å‚æ•°çš„ä»£ç ã€‚ **ç¡¬ä»¶è¿æ¥** > å›¾ä¸­çš„è¿™ä¸ªå¸¦é‡‘è¾¹çš„æ¨¡å—æ˜¯CH340çš„USBè½¬ä¸²å£æ¨¡å—ï¼Œæ˜¯å¾ˆå¸¸ç”¨çš„ä¸œè¥¿äº†ã€‚è¿™ä¸ªå› ä¸ºæ²¡æœ‰æ‰¾åˆ°æ›´å¥½çš„å®ç‰©å›¾ï¼Œå°±æ‰¾äº†è¿™ä¸ªï¼Œç°åœ¨è¿™ä¸ªå›¾æ¨¡å—ä¸Šçš„RXDå’ŒTXDæ¥åˆ°ä¸€èµ·äº†ï¼Œå®é™…è¿æ¥çš„æ—¶å€™æ˜¯**ä¸è¦çŸ­æ¥åœ¨ä¸€èµ·çš„ï¼Œ** åˆ‡è®°ã€‚ ![å›¾ 20](../../static/images/docs/diy/tracking cannon/basic/basic 2025 06 26 23 38 08.png) æˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„ä»£ç æµ‹è¯•ä¸€ä¸‹k230çš„ä¸²å£å‘é€åŠŸèƒ½ å’Œ vofa+çš„ä½¿ç”¨ï¼š > K230çš„ä¸²å£çŸ¥è¯†å’Œä½¿ç”¨æ–¹æ³•ï¼Œå‚è€ƒç«‹åˆ›å¼€å‘æ¿çš„[åºå±±æ´¾ä¸²å£ç« èŠ‚æ•™ç¨‹](https://wiki.lckfb.com/zh hans/lushan pi k230/basic/uart.html) ```python from machine import UART from machine import FPIOA # é…ç½®å¼•è„š fpioa FPIOA() fpioa.set_function(5, FPIOA.UART2_TXD) fpioa.set_function(6, FPIOA.UART2_RXD) # åˆå§‹åŒ–UART2ï¼Œæ³¢ç‰¹ç‡115200ï¼Œ8ä½æ•°æ®ä½ï¼Œæ— æ ¡éªŒï¼Œ1ä½åœæ­¢ä½ uart UART(UART.UART2, baudrate 115200, bits UART.EIGHTBITS, parity UART.PARITY_NONE, stop UART.STOPBITS_ONE) # è¦å‘é€çš„å­—ç¬¦ä¸² message \"Hello,LuShan Pi!\\r\\n\" # é€šè¿‡UARTå‘é€æ•°æ® uart.write(message) # é‡Šæ”¾UARTèµ„æº uart.deinit() ``` æ•ˆæœå›¾ï¼š ![å›¾ 21](../../static/images/docs/diy/tracking cannon/basic/basic 2025 06 26 23 39 15.png) #### Vofa+çš„ä½¿ç”¨ è¿™é‡Œå°±ä»‹ç»Vofa+çš„æ•°æ®æ¥æ”¶åè®® å’Œ æ³¢å½¢çš„æ˜¾ç¤ºæ–¹æ³•ã€‚ **æ¥æ”¶åè®®** æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯ FireWateråè®®ï¼Œå…¶åè®®æ ¼å¼å¦‚ä¸‹ï¼š ```txt <any>:ch0,ch1,ch2,...,chN\\n ``` å‚æ•°è¯´æ˜ï¼š å…ƒç´  æè¿° **\\<any\\>** è¡¨ç¤ºæ•°æ®åç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰ **:** å¿…é¡»åŠ è‹±æ–‡å†’å·ï¼Œä¸ç„¶è§£æä¸äº†æ•°æ®ï¼Œå°±ä¸ä¼šæ˜¾ç¤ºåœ¨Vofa+ä¸Šã€‚ **ch0~chN** chè¡¨ç¤ºé€šé“æ•°æ®ï¼Œ0~Nè¡¨ç¤ºæ˜¯ç¬¬å‡ ä¸ªé€šé“çš„æ•°æ®ã€‚æ¯”å¦‚æˆ‘è¦å‘é€ä¸¤ä¸ªæµ®ç‚¹æ•°æ®ï¼ˆfloatï¼‰åˆ°vofa+æ˜¾ç¤ºæ³¢å½¢ï¼Œåˆ†åˆ«æ˜¯1.2 å’Œ 21.4ã€‚é‚£ä¹ˆå°±å¯ä»¥å†™ä¸º `float:1.2,21.4\\n`ï¼Œè¿™æ ·å°±å¯ä»¥æ˜¾ç¤ºä¸¤ä¸ªæ•°æ®ã€‚ **,** è¡¨ç¤ºæ¯ä¸€ä¸ªæ•°æ®ä¹‹é—´çš„é—´éš” **\\n** ç»“å°¾å¿…é¡»åŠ \\nï¼Œä¸ç„¶è§£æä¸äº†æ•°æ®ï¼Œå°±ä¸ä¼šæ˜¾ç¤ºåœ¨Vofa+ä¸Šã€‚ ç¤ºä¾‹ï¼š ```c float:1.2,21.4\\n temp:25.3\\n sensor:0.5,1.7,3.2\\n ``` >! **å…³é”®æ³¨æ„äº‹é¡¹** >! 1. â€‹**â€‹å†’å·ä¸èƒ½çœç•¥â€‹**â€‹ï¼šæ•°æ®åç§°åå¿…é¡»ç«‹å³è·Ÿè‹±æ–‡å†’å·ï¼ˆ`:`ï¼‰ >! 2. â€‹**â€‹é€—å·åˆ†éš”æ•°æ®â€‹**â€‹ï¼šå¤šä¸ªæ•°å€¼å¿…é¡»ç”¨è‹±æ–‡é€—å·ï¼ˆ`,`ï¼‰åˆ†éš” >! 3. â€‹**â€‹ç»“å°¾å¿…é¡»æœ‰`\\n`â€‹**â€‹ï¼šæ¢è¡Œç¬¦æ˜¯æ•°æ®ç»“æŸçš„å¼ºåˆ¶æ ‡è®° >! 4. â€‹**â€‹é€šé“é¡ºåºâ€‹**â€‹ï¼šæ•°æ®å€¼çš„é¡ºåºå¯¹åº”é€šé“ç´¢å¼•ï¼ˆç¬¬ä¸€ä¸ªå€¼ ch0ï¼Œç¬¬äºŒä¸ªå€¼ ch1ï¼Œä»¥æ­¤ç±»æ¨ï¼‰ <table> <thead> <tr> <th><img src \"../../static/images/docs/diy/tracking cannon/basic/basic 2025 06 26 23 46 26.png\" width \"1200\"></th> </tr> <tr> <th><center>Vofa+ ä¸Šå…³äº FireWater åè®®çš„æè¿°</center></th> </tr> </thead> </table> #### æ³¢å½¢æ˜¾ç¤º åœ¨ Vofa+ çš„å·¦ä¾§è¾¹æ æ‰¾æ§ä»¶ï¼Œå°†æ³¢å½¢å›¾æ§ä»¶æ‹‰å‡ºåˆ°æ”¾ç½®åŒºå³å¯ã€‚ <table> <thead> <tr> <th><img src \"../../static/images/docs/diy/tracking cannon/basic/basic 2025 06 26 23 47 31.png\" width \"1200\"></th> </tr> <tr> <th><center>æ”¾ç½®æ³¢å½¢å›¾æ§ä»¶</center></th> </tr> </thead> </table> æˆ‘ä»¬å¯ä»¥é€šè¿‡ Vofa+ æœ¬èº«è‡ªå·±å¸¦çš„ Demo æ•°æ®æµ‹è¯•èƒ½ä¸èƒ½æ˜¾ç¤ºå‡ºæ³¢å½¢ã€‚ ä¸è¿‡ Vofa+ æ¥æ”¶åˆ°æ•°æ®åï¼Œè¿˜ä¸èƒ½é©¬ä¸Šæ˜¾ç¤ºåœ¨æ³¢å½¢å›¾ä¸Šï¼Œè¿˜éœ€è¦æˆ‘ä»¬é…ç½®æ³¢å½¢çš„è¾“å…¥æ•°æ®ã€‚ <table> <thead> <tr> <th><img src \"../../static/images/docs/diy/tracking cannon/basic/basic 2025 06 26 23 49 46.png\" width \"600\"></th> \t <th><img src \"../../static/images/docs/diy/tracking cannon/basic/basic 2025 06 26 23 49 21.png\" width \"600\"></th> </tr> <tr> <th><center>æ”¾å¤§æ³¢å½¢ç”»é¢</center></th> \t <th><center>è®¾ç½®æ³¢å½¢çš„è¾“å…¥æ˜¾ç¤ºæ•°æ®</center></th> </tr> </thead> </table> ä¸å‡ºæ„å¤–çš„è¯ï¼Œä½ åº”è¯¥ä¼šæ˜¾ç¤ºä¸‹é¢çš„ç”»é¢ï¼š > 5ä¸ªé€šé“çš„æ•°æ®ï¼Œä¸æ–­æ›´æ–°å°±å¯ä»¥å¾—åˆ°æ³¢å½¢ã€‚ <table> <thead> <tr> <th><img src \"../../static/images/docs/diy/tracking cannon/basic/basic 2025 06 26 23 53 08.png\" width \"1200\"></th> </tr> <tr> <th><center>æ³¢å½¢æ˜¾ç¤ºç”»é¢</center></th> </tr> </thead> </table> ç°åœ¨å„ä½å°±å¯ä»¥è‡ªè¡Œè°ƒè¯•ä½ çš„PIDå•¦ã€‚ #### åŠ PIDåçš„æ•ˆæœåŠä»£ç  å¦‚æœä½ å‘ç°ä½ å¾€å·¦ï¼Œè€Œèˆµæœºå¾€å³ï¼Œè¯´æ˜ææ€§åäº†ï¼Œè®©å‚æ•°å˜æˆè´Ÿæ•°å³å¯ã€‚ å¦‚æœä½ å‘ç°å“åº”é€Ÿåº¦æ…¢ï¼Œé‚£å°±åŠ å¤§ Kp å€¼ã€‚ å¦‚æœä½ å‘ç°ï¼Œå›¾åƒçš„ä¸­å¿ƒè·Ÿç›®æ ‡çš„ä¸­å¿ƒå§‹ç»ˆæœ‰è¯¯å·®ï¼Œé‚£ä½ å°±åŠ å¤§ Ki å€¼ï¼›å¦‚æœèˆµæœºä¸€ç›´åœ¨ç›®æ ‡ä½ç½®åå¤æ¨ªè·³æŠ–åŠ¨ï¼Œé‚£ä½ å°±å‡å° Ki å€¼ã€‚ å¦‚æœä½ æƒ³å®ç°äº†PIDçš„åŸºæœ¬å¿«é€Ÿè¿½è¸ªï¼Œæƒ³è®©å®ƒæ›´å¿«ï¼Œé‚£å°±è°ƒæ•´ Kd å€¼ã€‚ è¿™ä¸ªæ˜¯æˆ‘çš„è°ƒè¯•ç»“æœï¼š ![å›¾ 27](../../static/images/docs/diy/tracking cannon/basic/basic 2025 06 27 00 27 29.gif) å®ç°è¿™ä¸ªæ•ˆæœçš„ä»£ç ï¼š ```python import time, os, gc, sys, math,utime from machine import PWM, FPIOA, Pin, UART from media.sensor import * from media.display import * from media.media import * from pid import PID DETECT_WIDTH 640 DETECT_HEIGHT 480 sensor None ###############################èˆµæœºé…ç½®##################################################### # 2.5 90åº¦ 7.5 0åº¦ 12.5 90åº¦ min_duty 2.5 #æœ€å°å ç©ºæ¯” max_duty 12.5 #æœ€å¤§å ç©ºæ¯” mid_duty 7.5 # ä¸­é—´å€¼ï¼Œå¯¹åº”äº0åº¦ pwm_lr None # é…ç½®æ’é’ˆå¼•è„šå·12ï¼ŒèŠ¯ç‰‡å¼•è„šå·ä¸º47çš„æ’é’ˆå¤ç”¨ä¸ºPWMé€šé“3è¾“å‡º pwm_io1 FPIOA() pwm_io1.set_function(47, FPIOA.PWM3) # åˆå§‹åŒ–PWMå‚æ•° pwm_ud PWM(3, 50, 50, enable True) # é»˜è®¤é¢‘ç‡50Hz,å ç©ºæ¯”50% 3~12 # é…ç½®æ’é’ˆå¼•è„šå·32ï¼ŒèŠ¯ç‰‡å¼•è„šå·ä¸º46çš„æ’é’ˆå¤ç”¨ä¸ºPWMé€šé“2è¾“å‡º pwm_io2 FPIOA() pwm_io2.set_function(46, FPIOA.PWM2) # åˆå§‹åŒ–PWMå‚æ•° pwm_lr PWM(2, 50, 50, enable True) # é»˜è®¤é¢‘ç‡50Hz,å ç©ºæ¯”50% 2~13 pwm_lr.duty(7.5) #æ—‹è½¬åˆ°ä¸­é—´ pwm_ud.duty(4) #æ—‹è½¬åˆ°ä¸­é—´ ########################################################################################## ###############################PIDé…ç½®##################################################### lr_kp 0.17 lr_ki 0.016 lr_kd 0 lr_max_out DETECT_WIDTH//2\t\t#PIDæœ€å¤§è¾“å‡º pid_lr PID(lr_kp, lr_ki, lr_kd, lr_max_out, lr_max_out) ud_kp 0.17 ud_ki 0.016 ud_kd 0 ud_max_out DETECT_HEIGHT//2\t\t#PIDæœ€å¤§è¾“å‡º pid_ud PID(ud_kp, ud_ki, ud_kd, ud_max_out, ud_max_out) ########################################################################################## ## å°†Yè½´åç§»æ•°å€¼è½¬æ¢ä¸ºå ç©ºæ¯”çš„å‡½æ•° def input_to_duty_cycle(input_min, input_max, input_value): # å®šä¹‰è¾“å…¥è¾“å‡ºèŒƒå›´ # input_min (DETECT_HEIGHT // 2) # input_max (DETECT_HEIGHT // 2) output_min min_duty output_max max_duty # æ£€æŸ¥è¾“å…¥æ˜¯å¦è¶Šç•Œ if input_value < input_min or input_value > input_max: raise ValueError(f\"è¾“å…¥å€¼å¿…é¡»åœ¨ {input_min} å’Œ {input_max} ä¹‹é—´\") # è®¡ç®—çº¿æ€§æ˜ å°„å…¬å¼ slope (output_max output_min) / (input_max input_min) output_value output_min + (input_value input_min) * slope return output_value try: # åˆå§‹åŒ–æ‘„åƒå¤´ sensor Sensor(width DETECT_WIDTH, height DETECT_HEIGHT) # ä¼ æ„Ÿå™¨å¤ä½ sensor.reset() # å¼€å¯é•œåƒ sensor.set_hmirror(True)#False # sensor vflip sensor.set_vflip(True)#False True # è®¾ç½®å›¾åƒä¸€å¸§çš„å¤§å° sensor.set_framesize(width DETECT_WIDTH, height DETECT_HEIGHT) # è®¾ç½®å›¾åƒè¾“å‡ºæ ¼å¼ä¸ºå½©è‰²çš„RGB565 sensor.set_pixformat(Sensor.RGB565) # ä½¿ç”¨IDEæ˜¾ç¤ºå›¾åƒ Display.init(Display.VIRT, width DETECT_WIDTH, height DETECT_HEIGHT, fps 100) # åˆå§‹åŒ–åª’ä½“ç®¡ç†å™¨ MediaManager.init() # æ‘„åƒå¤´ä¼ æ„Ÿå™¨å¼€å¯è¿è¡Œ sensor.run() # å®šä¹‰è¦è¯†åˆ«é¢œè‰²çš„é˜ˆå€¼ï¼Œè¿™é‡Œéœ€è¦æ ¹æ®ä½ çš„å…·ä½“æƒ…å†µè°ƒæ•´ # ä½ å¯ä»¥é€šè¿‡å°è¯•ä¸åŒçš„é˜ˆå€¼æ¥æ‰¾åˆ°æœ€é€‚åˆä½ çš„ç‰©ä½“é¢œè‰²å€¼ red_threshold (0, 42, 17, 94, 6, 50) while True: # æ‹æ‘„ä¸€å¼ å›¾ç‰‡ img sensor.snapshot() # æŸ¥æ‰¾å›¾åƒä¸­æ»¡è¶³çº¢è‰²é˜ˆå€¼çš„åŒºåŸŸ blobs img.find_blobs([red_threshold], pixels_threshold 200, area_threshold 200, merge True) # å¦‚æœæ‰¾åˆ°äº†è‡³å°‘ä¸€ä¸ªblob if blobs: # æ‰¾åˆ°æœ€å¤§çš„blob largest_blob max(blobs, key lambda b: b.pixels()) # ç”»æ¡† img.draw_rectangle(largest_blob.rect(), color (255, 0, 0)) # åœ¨æ¡†å†…ç”»åå­—ï¼Œæ ‡è®°ä¸­å¿ƒç‚¹ img.draw_cross(largest_blob.cx(), largest_blob.cy(), color (255, 0, 0)) # è®¡ç®—ç›¸å¯¹äºå±å¹•ä¸­å¿ƒçš„Xè½´å’ŒYè½´çš„åç§»é‡ x_offset largest_blob.cx() img.width() // 2 y_offset largest_blob.cy() img.height() // 2 # å±å¹•æ˜¾ç¤ºä½ç½®ä¿¡æ¯å’Œåƒç´ å¤§å°ï¼ŒåŒ…å«æ­£è´Ÿå· wz \"x {}, y {}, w {}, h {}\".format(x_offset, y_offset, largest_blob.w(), largest_blob.h()) img.draw_string_advanced(0,0,32,wz) # æ ¹æ®ä¸­å¿ƒåç§»é‡è®¡ç®—PWMçš„PID # 0ä¸ºç›®æ ‡å€¼ï¼Œx_offsetè¡¨ç¤ºå½“å‰è®¾å®šå€¼ pid_lr_value pid_lr.pid_calc(0,x_offset) pid_ud_value pid_ud.pid_calc(0,y_offset) ''' å…³é”®ç‚¹ä¸€ ''' # å°†PIDå€¼è½¬æ¢ä¸ºèˆµæœºçš„èŒƒå›´å¹¶ä¸”è¾“å‡ºå®é™…çš„å ç©ºæ¯” duty_lr_value input_to_duty_cycle( (DETECT_WIDTH // 2), (DETECT_WIDTH // 2), pid_lr_value) duty_ud_value input_to_duty_cycle( (DETECT_HEIGHT // 2), (DETECT_HEIGHT // 2), pid_ud_value) print(f\"pid_lr_value {pid_lr_value}, pid_ud_value {pid_ud_value}\\r\\n\") print(f\"duty_lr_value {duty_lr_value}, duty_ud_value {duty_ud_value}\\r\\n\") ''' å…³é”®ç‚¹äºŒ ''' # æ ¹æ®è®¡ç®—åçš„å ç©ºæ¯”æ§åˆ¶èˆµæœºåŠ¨ä½œ pwm_lr.duty(duty_lr_value) pwm_ud.duty(duty_ud_value) # ä¸­å¿ƒç”»åå­— img.draw_cross(img.width() // 2, img.height() // 2, color (0, 255, 0), size 10, thickness 3) # IDEæ˜¾ç¤ºå›¾ç‰‡ Display.show_image(img) except KeyboardInterrupt as e: print(f\"user stop\") except BaseException as e: print(f\"Exception &#039;{e}&#039;\") finally: # sensor stop run if isinstance(sensor, Sensor): sensor.stop() # deinit display Display.deinit() if isinstance(pwm_lr, PWM): pwm_lr.deinit() # release media buffer MediaManager.deinit() os.exitpoint(os.EXITPOINT_ENABLE_SLEEP) time.sleep_ms(100) ``` ### æ•°æ®æ»¤æ³¢ ç›¸ä¿¡å¤§å®¶åœ¨è°ƒè¯•çš„æ—¶å€™ï¼Œä¼šå‘ç°è¯†åˆ«ç‰©ä½“çš„ä¸­å¿ƒä½ç½®è·³å˜éå¸¸é¢‘ç¹ï¼Œè¯†åˆ«çš„ç‰©ä½“æ˜æ˜æ ¹æœ¬æ²¡æœ‰åŠ¨ï¼Œä½†æ˜¯å› ä¸ºè¯†åˆ«ä»£ç çš„é—®é¢˜ï¼Œè¯†åˆ«çš„ä½ç½®ä¸€ç›´åœ¨å˜åŠ¨ï¼Œæœ‰æ—¶å€™å˜åŠ¨å°ï¼Œæœ‰æ—¶å€™å˜åŠ¨å¤§ã€‚è¿™ä¸ªå˜åŠ¨ä¼šå½±å“åˆ°æˆ‘ä»¬çš„PIDè®¡ç®—ï¼Œå¯¼è‡´èˆµæœºä¸ç¨³å®šï¼šè¯†åˆ«åˆ°ç‰©ä½“åï¼Œæ˜æ˜èˆµæœºå·²ç»æŒ‡å‘è¯†åˆ«ç‰©ä½“çš„ä¸­å¿ƒäº†ï¼Œä½†æ˜¯èˆµæœºè¿˜æ˜¯ä¼šæœ‰ä¸€äº›åŠ¨ä½œè°ƒæ•´ï¼Œå¯¼è‡´ä¸€ç›´åŠ¨ï¼Œéƒ½ä¸åœçš„ã€‚ é‚£ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ»¤æ³¢çš„æ–¹å¼ï¼Œå°†æ•°æ®è·³å˜ä¸å¤§çš„æ—¶å€™ï¼Œè¿‡æ»¤æ‰ã€‚æœ€ç®€å•çš„æ»¤æ³¢å°±æ˜¯é‡‡é›†å¤šæ¬¡ç„¶åå–å¹³å‡å€¼ï¼Œè¿™ä¸ªå¹³å‡å€¼å°±æ˜¯æ»¤æ³¢åçš„ç»“æœã€‚ å¦‚æœä½ çš„PIDæ²¡æœ‰è°ƒå¥½ï¼Œé‚£ä¹Ÿå¯ä»¥ç›´æ¥ç”¨æ»¤æ³¢ï¼Œåº”è¯¥ä¹Ÿå¯ä»¥å®ç°ä¸€ä¸ªæ¯”è¾ƒä¸é”™çš„æ•ˆæœã€‚ è¿™é‡Œæˆ‘ç”¨ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„æ»¤æ³¢ç®—æ³•ï¼š**`ä¸€é˜¶ä½é€šæ»¤æ³¢ç®—æ³•`**ã€‚ æˆ‘å°†ä»£ç å°è£…æˆä¸ºäº†ä¸€ä¸ªåº“æ–‡ä»¶ï¼Œå°†ä¸‹é¢ä»£ç ä¿å­˜å¹¶å‘½åä¸º filter.pyï¼Œå®Œæˆåä¸Šä¼ åˆ°K230çš„sdcardæ–‡ä»¶å¤¹é‡Œé¢ã€‚ ```python #ä¸€é˜¶ä½é€šæ»¤æ³¢å™¨ class LowPassFilter: def __init__(self, alpha): self.alpha alpha # æ»¤æ³¢å™¨çš„ç³»æ•°ï¼Œ0 < alpha < 1 self.last_output None def update(self, value): if self.last_output is None: # åˆå§‹åŒ–æ»¤æ³¢å™¨çš„è¾“å‡º self.last_output value else: # æ›´æ–°æ»¤æ³¢å™¨çš„è¾“å‡º self.last_output self.alpha * value + (1 self.alpha) * self.last_output return self.last_output ``` ![å›¾ 28](../../static/images/docs/diy/tracking cannon/basic/basic 2025 06 27 00 52 59.png) æ¥ä¸‹æ¥æ˜¯ä»‹ç»å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ»¤æ³¢ç®—æ³•ï¼Œé¦–å…ˆä½¿ç”¨å‰å…ˆå¯¼å…¥åº“ï¼š ```python from filter import LowPassFilter ``` ç„¶ååˆå§‹åŒ–æ»¤æ³¢å‚æ•°ï¼š ```python #æ»¤æ³¢ alpha 0.1 # æ»¤æ³¢å™¨ç³»æ•°ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´è¿™ä¸ªå€¼ lr_filter LowPassFilter(alpha) # å·¦å³èˆµæœºæ»¤æ³¢å™¨ ``` æ¥ç€åœ¨å…³é”®ä»£ç ä¸­è°ƒç”¨APIå‡½æ•° `.update`ï¼Œæ¯”å¦‚æˆ‘é‡‡é›†çš„ä½ç½®æ•°æ®æ˜¯ pid_lr_valueï¼Œæˆ‘è¦å¯¹å…¶æ»¤æ³¢åˆ™è¾“å…¥pid_lr_valueï¼ŒAPI`.update`è¿”å›çš„æ•°å€¼å°±æ˜¯æ»¤æ³¢åçš„æ•°å€¼ï¼š ```python # å¯¹ç›®æ ‡ç‰©ä½“çš„ä¸­å¿ƒä½ç½®è¿›è¡Œæ»¤æ³¢ filter_lr_value lr_filter.update(x_offset) filter_ud_value ud_filter.update(y_offset) ``` å®ç°æ•ˆæœï¼š ![å›¾ 10](../../static/images/docs/diy/tracking cannon/basic/basic 2024 12 22 00 06 01.gif) å®Œæ•´ä»£ç ï¼š ```python import time, os, gc, sys, math,utime from machine import PWM, FPIOA, Pin, UART from media.sensor import * from media.display import * from media.media import * from pid import PID from filter import LowPassFilter DETECT_WIDTH 640 DETECT_HEIGHT 480 sensor None ###############################èˆµæœºé…ç½®##################################################### # 2.5 90åº¦ 7.5 0åº¦ 12.5 90åº¦ min_duty 2.5 #æœ€å°å ç©ºæ¯” max_duty 12.5 #æœ€å¤§å ç©ºæ¯” mid_duty 7.5 # ä¸­é—´å€¼ï¼Œå¯¹åº”äº0åº¦ pwm_lr None # é…ç½®æ’é’ˆå¼•è„šå·12ï¼ŒèŠ¯ç‰‡å¼•è„šå·ä¸º47çš„æ’é’ˆå¤ç”¨ä¸ºPWMé€šé“3è¾“å‡º pwm_io1 FPIOA() pwm_io1.set_function(47, FPIOA.PWM3) # åˆå§‹åŒ–PWMå‚æ•° pwm_ud PWM(3, 50, 50, enable True) # é»˜è®¤é¢‘ç‡50Hz,å ç©ºæ¯”50% 3~12 # é…ç½®æ’é’ˆå¼•è„šå·32ï¼ŒèŠ¯ç‰‡å¼•è„šå·ä¸º46çš„æ’é’ˆå¤ç”¨ä¸ºPWMé€šé“2è¾“å‡º pwm_io2 FPIOA() pwm_io2.set_function(46, FPIOA.PWM2) # åˆå§‹åŒ–PWMå‚æ•° pwm_lr PWM(2, 50, 50, enable True) # é»˜è®¤é¢‘ç‡50Hz,å ç©ºæ¯”50% 2~13 pwm_lr.duty(7.5) #æ—‹è½¬åˆ°ä¸­é—´ pwm_ud.duty(7.7) #æ—‹è½¬åˆ°ä¸­é—´ ########################################################################################## ###############################PIDé…ç½®##################################################### lr_kp 0.17 lr_ki 0.016 lr_kd 0 lr_max_out DETECT_WIDTH//2\t\t#PIDæœ€å¤§è¾“å‡º pid_lr PID(lr_kp, lr_ki, lr_kd, lr_max_out, lr_max_out) ud_kp 0.17 ud_ki 0.016 ud_kd 0 ud_max_out DETECT_HEIGHT//2\t\t#PIDæœ€å¤§è¾“å‡º pid_ud PID(ud_kp, ud_ki, ud_kd, ud_max_out, ud_max_out) ########################################################################################## ###############################ä¸€é˜¶ä½é€šæ»¤æ³¢å™¨é…ç½®############################################ alpha 0.1 # æ»¤æ³¢å™¨ç³»æ•°ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´è¿™ä¸ªå€¼ lr_filter LowPassFilter(alpha) # å·¦å³èˆµæœºæ»¤æ³¢å™¨ ud_filter LowPassFilter(alpha) # ä¸Šä¸‹èˆµæœºæ»¤æ³¢å™¨ ########################################################################################## ## å°†Yè½´åç§»æ•°å€¼è½¬æ¢ä¸ºå ç©ºæ¯”çš„å‡½æ•° def input_to_duty_cycle(input_min, input_max, input_value): # å®šä¹‰è¾“å…¥è¾“å‡ºèŒƒå›´ # input_min (DETECT_HEIGHT // 2) # input_max (DETECT_HEIGHT // 2) output_min min_duty output_max max_duty # æ£€æŸ¥è¾“å…¥æ˜¯å¦è¶Šç•Œ if input_value < input_min or input_value > input_max: raise ValueError(f\"è¾“å…¥å€¼å¿…é¡»åœ¨ {input_min} å’Œ {input_max} ä¹‹é—´\") # è®¡ç®—çº¿æ€§æ˜ å°„å…¬å¼ slope (output_max output_min) / (input_max input_min) output_value output_min + (input_value input_min) * slope return output_value try: # åˆå§‹åŒ–æ‘„åƒå¤´ sensor Sensor(width DETECT_WIDTH, height DETECT_HEIGHT) # ä¼ æ„Ÿå™¨å¤ä½ sensor.reset() # å¼€å¯é•œåƒ sensor.set_hmirror(True)#False # sensor vflip sensor.set_vflip(True)#False True # è®¾ç½®å›¾åƒä¸€å¸§çš„å¤§å° sensor.set_framesize(width DETECT_WIDTH, height DETECT_HEIGHT) # è®¾ç½®å›¾åƒè¾“å‡ºæ ¼å¼ä¸ºå½©è‰²çš„RGB565 sensor.set_pixformat(Sensor.RGB565) # ä½¿ç”¨IDEæ˜¾ç¤ºå›¾åƒ Display.init(Display.VIRT, width DETECT_WIDTH, height DETECT_HEIGHT, fps 100) # åˆå§‹åŒ–åª’ä½“ç®¡ç†å™¨ MediaManager.init() # æ‘„åƒå¤´ä¼ æ„Ÿå™¨å¼€å¯è¿è¡Œ sensor.run() # å®šä¹‰è¦è¯†åˆ«é¢œè‰²çš„é˜ˆå€¼ï¼Œè¿™é‡Œéœ€è¦æ ¹æ®ä½ çš„å…·ä½“æƒ…å†µè°ƒæ•´ # ä½ å¯ä»¥é€šè¿‡å°è¯•ä¸åŒçš„é˜ˆå€¼æ¥æ‰¾åˆ°æœ€é€‚åˆä½ çš„ç‰©ä½“é¢œè‰²å€¼ red_threshold (0, 42, 17, 94, 6, 50) while True: # æ‹æ‘„ä¸€å¼ å›¾ç‰‡ img sensor.snapshot() # æŸ¥æ‰¾å›¾åƒä¸­æ»¡è¶³çº¢è‰²é˜ˆå€¼çš„åŒºåŸŸ blobs img.find_blobs([red_threshold], pixels_threshold 400, area_threshold 400, merge True) # å¦‚æœæ‰¾åˆ°äº†è‡³å°‘ä¸€ä¸ªblob if blobs: # æ‰¾åˆ°æœ€å¤§çš„blob largest_blob max(blobs, key lambda b: b.pixels()) # ç”»æ¡† img.draw_rectangle(largest_blob.rect(), color (255, 0, 0)) # åœ¨æ¡†å†…ç”»åå­—ï¼Œæ ‡è®°ä¸­å¿ƒç‚¹ img.draw_cross(largest_blob.cx(), largest_blob.cy(), color (255, 0, 0)) # è®¡ç®—ç›¸å¯¹äºå±å¹•ä¸­å¿ƒçš„Xè½´å’ŒYè½´çš„åç§»é‡ x_offset largest_blob.cx() img.width() // 2 y_offset largest_blob.cy() img.height() // 2 # å±å¹•æ˜¾ç¤ºä½ç½®ä¿¡æ¯å’Œåƒç´ å¤§å°ï¼ŒåŒ…å«æ­£è´Ÿå· wz \"x {}, y {}, w {}, h {}\".format(x_offset, y_offset, largest_blob.w(), largest_blob.h()) img.draw_string_advanced(0,0,32,wz) # å¯¹ç›®æ ‡ç‰©ä½“çš„ä¸­å¿ƒä½ç½®è¿›è¡Œæ»¤æ³¢ filter_lr_value lr_filter.update(x_offset) filter_ud_value ud_filter.update(y_offset) # æ ¹æ®ä¸­å¿ƒåç§»é‡è®¡ç®—PWMçš„PID # 0ä¸ºç›®æ ‡å€¼ï¼Œx_offsetè¡¨ç¤ºå½“å‰è®¾å®šå€¼ pid_lr_value pid_lr.pid_calc(0,filter_lr_value) pid_ud_value pid_ud.pid_calc(0,filter_ud_value) # å°†PIDå€¼è½¬æ¢ä¸ºèˆµæœºçš„èŒƒå›´å¹¶ä¸”è¾“å‡ºå®é™…çš„å ç©ºæ¯” duty_lr_value input_to_duty_cycle( (DETECT_WIDTH // 2), (DETECT_WIDTH // 2), pid_lr_value) duty_ud_value input_to_duty_cycle( (DETECT_HEIGHT // 2), (DETECT_HEIGHT // 2), pid_ud_value) # æ ¹æ®è®¡ç®—åçš„å ç©ºæ¯”æ§åˆ¶èˆµæœºåŠ¨ä½œ pwm_lr.duty(duty_lr_value) pwm_ud.duty(duty_ud_value) # ä¸­å¿ƒç”»åå­— img.draw_cross(img.width() // 2, img.height() // 2, color (0, 255, 0), size 10, thickness 3) # IDEæ˜¾ç¤ºå›¾ç‰‡ Display.show_image(img) except KeyboardInterrupt as e: print(f\"user stop\") except BaseException as e: print(f\"Exception &#039;{e}&#039;\") finally: # sensor stop run if isinstance(sensor, Sensor): sensor.stop() # deinit display Display.deinit() if isinstance(pwm_lr, PWM): pwm_lr.deinit() # release media buffer MediaManager.deinit() os.exitpoint(os.EXITPOINT_ENABLE_SLEEP) time.sleep_ms(100) ```"},"/diy/picxel-clock/download.html":{"title":"åƒç´ æ—¶é’Ÿèµ„æ–™ä¸‹è½½","content":" title: åƒç´ æ—¶é’Ÿèµ„æ–™ä¸‹è½½ keywords: keyword1, keyword2 desc: description for this article show_source: false update: date: 2024 12 05 author: è€æ€ªé¸½ version: 1.0.1 content: æ›´æ–°äº†åŸºæœ¬æ–‡æ¡£ ## é¡¹ç›®å¼€æºåœ°å€ >! å¼€æºåœ°å€ï¼šhttps://gitee.com/laoguaige/esp32 s3 r8 n8 pixel clock å¦‚æœä½ å–œæ¬¢è¿™ä¸ªé¡¹ç›®ï¼Œé¼“åŠ±é¼“åŠ±ï¼Œç»™å¼€æºé¡¹ç›®ç‚¹ä¸ªâ­Starå§~ ## å›ºä»¶ä¸‹è½½ >! ä¸‹è½½åœ°å€ï¼šhttps://gitee.com/laoguaige/esp32 s3 r8 n8 pixel clock/tree/master/firmware ### å½“å‰å›ºä»¶ åºå· å›ºä»¶åç§° æ›´æ–°æ—¶é—´ å¤‡æ³¨ 1 ESP32S3R8N8_PixelClock_0.0.1.bin 2024 07 28 åŒ…å« æ—¶é’Ÿ / å¤©æ°” / æ¸©æ¹¿åº¦ / æ•°å­—é›¨ / éŸ³å¾‹æ‹¾éŸ³ç¯ 2 ESP32S3R8N8_PixelClock_0.0.2.bin 2024 07 28 åŒ…å« æ—¶é’Ÿ / å¤©æ°” / æ¸©æ¹¿åº¦ / æ•°å­—é›¨ / éŸ³å¾‹æ‹¾éŸ³ç¯ / WIFIé…ç½‘ ### å›ºä»¶çƒ§å½•æ­¥éª¤ ä½¿ç”¨ä¹é‘«çš„[FLASHä¸‹è½½å™¨](https://www.espressif.com.cn/zh hans/support/download/other tools)ã€‚ ![å›¾ 3](../../static/images/docs/diy/picxel clock/download/download 2024 12 05 22 37 52.png) ä¸‹è½½åè¿è¡Œã€‚å›ºä»¶çƒ§å½•æ“ä½œå¦‚ä¸‹ï¼š ![å›¾ 4](../../static/images/docs/diy/picxel clock/download/download 2024 12 05 22 37 55.png) çƒ§å½•å®Œæˆä¹‹åæ–­ç”µé‡å¯å³å¯ã€‚ ### åœ¨PlatformIOä¸­ç”Ÿæˆå›ºä»¶ å‚è€ƒï¼šhttps://blog.csdn.net/Argon_Ghost/article/details/139307638?ops_request_misc &request_id &biz_id 102&utm_term PlatformIO%E7%94%9F%E6%88%90%E5%9B%BA%E4%BB%B6&utm_medium distribute.pc_search_result.none task blog 2~all~sobaiduweb~default 1 139307638.142^v100^pc_search_result_base4&spm 1018.2226.3001.4187 ## 3Då¤–å£³æ–‡ä»¶ä¸‹è½½ >! ä¸‹è½½åœ°å€ï¼šhttps://gitee.com/laoguaige/esp32 s3 r8 n8 pixel clock/tree/master/3Dfile ### 3Dæ–‡ä»¶è¯´æ˜ **å› ä¸ºå®ç‰©å¾ˆå¤§ï¼Œæ‰“å°çš„å¤–å£³éœ€è¦åˆ†å¼€ï¼Œåˆ†å·¦å³ä¸¤è¾¹ã€‚** LEDGrid2x.stl ä¸ºå…‰æ ï¼Œéœ€è¦ä¸€ä¸ªéƒ¨ä»¶æ‰“ä¸¤ä¸ªï¼Œæ‹¼åˆ°ä¸€èµ·ï¼› > è¯´æ˜ï¼šå…‰æ ä¸€å®šè¦é»‘è‰²çš„æè´¨ï¼Œä¸ç®¡æ˜¯3Dæ‰“å°æ—¶é€‰æ‹©é»‘è‰²çš„ææ–™è¿˜æ˜¯åé¢æ”¶åˆ°å–·é»‘æ¼†ï¼Œä¸€å®šè®°å¾—ä½¿ç”¨é»‘è‰²çš„å…‰æ ï¼ä¸ç„¶è§‚æ„Ÿå°±å·®å¾ˆå¤š ![å›¾ 0](../../static/images/docs/diy/picxel clock/download/download 2024 12 05 22 32 35.png) frontFrame2x.stl ä¸ºå¤–å£³è¾¹æ¡†ï¼Œéœ€è¦ä¸€ä¸ªéƒ¨ä»¶æ‰“ä¸¤ä¸ªï¼Œæ‹¼åˆ°ä¸€èµ·ï¼› ![å›¾ 1](../../static/images/docs/diy/picxel clock/download/download 2024 12 05 22 32 50.png) Housing.stl å’Œ Housing_noV.stl ä¸ºåŒä¸€ä¸ªéƒ¨ä»¶ï¼Œé€‰æ‹©ä¸€ä¸ªè¿›è¡Œæ‰“å°å³å¯ï¼Œéƒ½æ˜¯æˆæœ¬è¾ƒé«˜ï¼Œé…Œæƒ…æ‰“å°ï¼› ![å›¾ 2](../../static/images/docs/diy/picxel clock/download/download 2024 12 05 22 32 57.png) å¦‚è¦ç»„å»ºå®Œæ•´çš„å¤–å£³ï¼Œè¿˜éœ€è¦è´­ä¹°é»‘è‰²çš„äºšå…‹åŠ›é€æ˜é¢æ¿ï¼ ``ç”Ÿäº§çš„è§„æ ¼å‚æ•°ï¼šé»‘èŒ¶è‰² é€æ˜äºšå…‹åŠ› 95Ã—330Ã—2mm``"},"/diy/picxel-clock/led-oscillating.html":{"title":"FFTéŸ³å¾‹ç¯","content":" title: FFTéŸ³å¾‹ç¯ keywords: keyword1, keyword2 desc: description for this article show_source: false update: date: 2024 12 05 author: è€æ€ªé¸½ version: 1.0.1 content: æ›´æ–°äº†åŸºæœ¬æ–‡æ¡£ >! æœ¬æ–‡ç»§æ‰¿è‡ªä¹‹å‰çš„ğŸ‘‰[å½©ç¯é©±åŠ¨](ledmatrix.html)ç« èŠ‚ **æœ¬æ–‡å®Œæˆçš„æ•ˆæœï¼š** ![å›¾ 0](../../static/images/docs/diy/picxel clock/led oscillating/led oscillating 2024 12 06 00 05 00.gif) ## ç¡¬ä»¶å‡†å¤‡ ### WS2812çŸ©é˜µå½©ç¯ ![å›¾ 0](../../static/images/docs/diy/picxel clock/ledmatrix/ledmatrix 2024 12 05 23 14 08.png) **è´­ä¹°åœ°å€ï¼š**[WS2812Bå…¨å½©è½¯åƒç´ å±8X8 8X32 16X16å¹»å½©5Væ˜¾ç¤ºå¯ç¼–ç¨‹åƒç´ è½¯å±](https://item.taobao.com/item.htm?spm a1z09.2.0.0.24ee2e8dC5LwBl&id 737696448369&_u r2t4uge57a73&skuId 5263566850408) ### éº¦å…‹é£æ¨¡å— ![å›¾ 1](../../static/images/docs/diy/picxel clock/led oscillating/led oscillating 2024 12 06 00 05 36.png) è´­ä¹°åœ°å€ï¼š[GY MAX4466 å£°éŸ³ä¼ æ„Ÿå™¨æ¨¡å— MAX4466éº¦å…‹é£å‰ç½®æ”¾å¤§å™¨ æä¾›ç¨‹åº](https://item.taobao.com/item.htm?spm a21n57.1.item.2.2af5523csIlNsa&priceTId 2147bfce17220928379633421e49bd&utparam %7B%22aplus_abtest%22:%22c7a787e4caab2b1c51f9ce5bba439f54%22%7D&id 619436010637&ns 1&abbucket 4) ### ESP32S3å¼€å‘æ¿ ![å›¾ 1](../../static/images/docs/diy/picxel clock/ledmatrix/ledmatrix 2024 12 05 23 14 24.png) **è´­ä¹°åœ°å€ï¼š**[ç«‹åˆ›Â·ESP32S3R8N8 å¼€å‘æ¿](https://item.szlcsc.com/22034693.html?fromZone s_s__%2522%25E7%25AB%258B%25E5%2588%259B%25E5%25BC%2580%25E5%258F%2591%25E6%259D%25BF%2522) ## å·¥ç¨‹åˆ›å»º åœ¨VSCodeä¸­æ‰“å¼€PlatformIOæ‰©å±•åˆ›å»ºåä¸º`OscillatingLED`çš„ `Espressif ESP32 S3 DevKitM 1` å·¥ç¨‹ã€‚ å…³äºè¯¦ç»†å›¾æ–‡åˆ›å»ºå·¥ç¨‹çš„è¿‡ç¨‹è¯·å‚è€ƒğŸ‘‰[RTCæ—¶é’Ÿé©±åŠ¨](ds1302.html)ç« èŠ‚çš„å·¥ç¨‹åˆ›å»ºå°èŠ‚ã€‚ ## å®‰è£…é©±åŠ¨åº“ åˆ›å»ºå®Œæˆä¹‹åï¼Œæ‰“å¼€é©±åŠ¨åº“ä¸‹è½½ç•Œé¢ã€‚å®ç°åŠŸèƒ½çš„æœ€åº•å±‚çš„é©±åŠ¨ï¼Œéœ€è¦åˆ†åˆ«å®‰è£…ä¸‰ä¸ªåº“ï¼š 1. æœç´¢``Adafruit NeoMatrix``ï¼Œå®‰è£…æ¥è‡ª``Adafruit``çš„``Adafruit NeoMatrix``åº“ã€‚ 2. æœç´¢``Adafruit GFX Library``ï¼Œå®‰è£…æ¥è‡ª``Adafruit``çš„``Adafruit GFX Library``åº“ã€‚ 3. æœç´¢``arduinoFFT``ï¼Œå®‰è£…æ¥è‡ª``Enrique Condes``çš„``arduinoFFT``åº“ã€‚ å°†å®ƒä»¬éƒ½å®‰è£…åˆ°æˆ‘ä»¬çš„å·¥ç¨‹å½“ä¸­ã€‚ > å…³äºè¯¦ç»†å›¾æ–‡å®‰è£…é©±åŠ¨åº“çš„è¿‡ç¨‹è¯·å‚è€ƒğŸ‘‰[RTCæ—¶é’Ÿé©±åŠ¨](ds1302.html)ç« èŠ‚çš„å®‰è£…é©±åŠ¨åº“å°èŠ‚ã€‚ éƒ½å®‰è£…å®Œæˆä¹‹åï¼Œæ‰“å¼€``platformio.ini``æ–‡ä»¶ï¼Œåº”è¯¥å¯ä»¥çœ‹åˆ°å·²ç»å®‰è£…ä¸Šäº†ä¸‰ä¸ªé©±åŠ¨åº“ã€‚ ![å›¾ 2](../../static/images/docs/diy/picxel clock/led oscillating/led oscillating 2024 12 06 00 07 06.png) ## ç¼–è¾‘ä»£ç  åœ¨å·¥ç¨‹ä¸‹çš„``include``æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ª ``musicfft.h``æ–‡ä»¶ã€‚ æ¥ä¸‹æ¥å¾€ ``musicfft.h`` æ–‡ä»¶å†™å…¥ä»£ç ï¼š ```c #include <Adafruit_NeoMatrix.h> #include <arduinoFFT.h> #define CHANNEL 1 //éŸ³é¢‘è¾“å…¥å¼•è„š #define xres 32 #define yres 8 const uint16_t samples 64; //é‡‡æ ·ç‚¹æ•°ï¼Œå¿…é¡»ä¸º2çš„æ•´æ•°æ¬¡å¹‚ const double samplingFrequency 4000; //Hz, å£°éŸ³é‡‡æ ·é¢‘ç‡ unsigned int sampling_period_us; unsigned long microseconds; unsigned long lastTime 0; unsigned long fallingTime 0; double vReal[samples]; //FFTé‡‡æ ·è¾“å…¥æ ·æœ¬æ•°ç»„ double vImag[samples]; //FFTè¿ç®—è¾“å‡ºæ•°ç»„ int freq_gain2[xres] {30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30}; int Intensity[xres] {}; // initialize Frequency Intensity to zero int FallingPoint[xres] {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}; int Displacement 1; // Create LED Object //ArduinoFFT FFT ArduinoFFT(); //åˆ›å»ºFFTå¯¹è±¡ ArduinoFFT<double> FFT ArduinoFFT<double>(vReal, vImag, samples, samplingFrequency); void getSamples(){ microseconds micros(); for(int i 0; i < samples; i++){ vReal[i] analogRead(CHANNEL); vImag[i] 0; microseconds + sampling_period_us; } bool reduce false; if ((millis() lastTime) > 16) { lastTime millis(); reduce true; } //FFT FFT.windowing(vReal, 1, FFT_WIN_TYP_HAMMING, FFT_FORWARD); FFT.compute(vReal, vImag, samples, FFT_FORWARD); FFT.complexToMagnitude(vReal, vImag, samples); //Update Intensity Array int t 16; for(int i t; i < (xres*Displacement)+t; i+ Displacement){ vReal[i] constrain(vReal[i], 0 ,3596); // set max value for input data vReal[i] map(vReal[i], freq_gain2[(i t)/Displacement], 1548, 0, yres); // map data to fit our display if(reduce){ Intensity[(i t)/Displacement] ; // Decrease displayed value } if (vReal[i] > Intensity[(i t)/Displacement]) // Match displayed value to measured value Intensity[(i t)/Displacement] vReal[i]; } } void drawYLine(Adafruit_NeoMatrix *matrix, int16_t x, int16_t y, int16_t h, int16_t c){ for(int i y;i<y+h;i++){ matrix >drawPixel(x,7 i,c); } } uint16_t hsv2rgb2(Adafruit_NeoMatrix *matrix, uint16_t hue, uint8_t saturation, uint8_t value) { uint8_t red 0; uint8_t green 0; uint8_t blue 0; uint16_t hi (hue / 60) % 6; uint16_t F 100 * hue / 60 100 * hi; uint16_t P value * (100 saturation) / 100; uint16_t Q value * (10000 F * saturation) / 10000; uint16_t T value * (10000 saturation * (100 F)) / 10000; switch (hi) { case 0: red value; green T; blue P; break; case 1: red Q; green value; blue P; break; case 2: red P; green value; blue T; break; case 3: red P; green Q; blue value; break; case 4: red T; green P; blue value; break; case 5: red value; green P; blue Q; break; default: return matrix >Color(255, 0, 0); } red red * 255 / 100; green green * 255 / 100; blue blue * 255 / 100; return matrix >Color(red, green, blue); } void displayUpdate(Adafruit_NeoMatrix *matrix, int displayPattern){ int color 0; switch(displayPattern){ case 0: for(int i 0; i < xres; i++){ drawYLine(matrix,i,yres Intensity[i],Intensity[i],hsv2rgb2(matrix, color, 80, 80 )); drawYLine(matrix,i,0,yres 1 Intensity[i],hsv2rgb2(matrix, color, 80, 80 )); color + 360/xres; } break; case 1: if ((millis() fallingTime) > 130) { for(int i 0; i < xres; i++){ if(FallingPoint[i]>0){ FallingPoint[i] ; } } fallingTime millis(); } for(int i 0; i < xres; i++){ drawYLine(matrix,i,0,yres 1,matrix >Color(0,0,0)); if(FallingPoint[i]<Intensity[i]){ FallingPoint[i] Intensity[i]; } drawYLine(matrix,i,yres Intensity[i]+1,Intensity[i] 1,hsv2rgb2(matrix, color, 80, 80 )); if(FallingPoint[i]>0){ matrix >drawPixel(i,yres FallingPoint[i],matrix >Color(255,255,255)); } color + 360/xres; } break; case 2: for(int i 0; i < xres; i++){ drawYLine(matrix,i,0,yres,matrix >Color(0,0,0)); drawYLine(matrix,i,0,Intensity[i]+1,hsv2rgb2(matrix, color, 80, 80 )); color + 360/xres; } break; } } ``` æ¥ä¸‹æ¥åœ¨ ``main.cpp``ä¸­ç¼–å†™ä»¥ä¸‹ä»£ç ï¼š ```c #include <Arduino.h> #include <Adafruit_NeoMatrix.h> //ç‚¹äº®LEDçŸ©é˜µéœ€è¦çš„åº“ #include \"musicfft.h\" //éŸ³ä¹é¢‘è°±åº“ //åƒç´ é˜µåˆ—å®šä¹‰ #define kMatrixWidth 32 //å®½åº¦ #define kMatrixHeight 8 //é«˜åº¦ #define BRIGHTNESS 10 //é»˜è®¤äº®åº¦ 0 255 #define BRIGHTNESS_INTERVAL 30 //äº®åº¦è°ƒèŠ‚é—´éš” #define LED_PIN 8 //åƒç´ é˜µåˆ—å¼•è„š Adafruit_NeoMatrix *matrix; //LEDçŸ©é˜µç±»æŒ‡é’ˆ //åƒç´ çŸ©é˜µåˆå§‹åŒ– void InitLED_Matrix(void) { //è®¾ç½®åƒç´ çŸ©é˜µçš„æ–¹å‘ä»¥åŠæ’åˆ—æ–¹å¼ matrix new Adafruit_NeoMatrix(32, 8, LED_PIN, NEO_MATRIX_TOP + NEO_MATRIX_LEFT+ NEO_MATRIX_COLUMNS + NEO_MATRIX_ZIGZAG, NEO_GRB + NEO_KHZ800); matrix >setTextWrap(false); //è®¾ç½®æ–‡å­—æ˜¯å¦è‡ªåŠ¨æ¢è¡Œ matrix >clear(); //æ¸…é™¤å½“å‰æ˜¾ç¤ºå†…å®¹ matrix >setBrightness(BRIGHTNESS);//è®¾ç½®äº®åº¦ } void showFFT(void) { //è¿›è¡Œé‡‡æ · getSamples(); //æ›´æ–°é¢‘è°±æŸ± displayUpdate(matrix, 2); } void setup() { //åˆå§‹åŒ–LEDçŸ©é˜µæ˜¾ç¤º InitLED_Matrix(); } void loop() { matrix >clear(); showFFT(); matrix >show(); delay(50); } ``` ## ç¡¬ä»¶è¿æ¥ ![å›¾ 3](../../static/images/docs/diy/picxel clock/led oscillating/led oscillating 2024 12 06 00 08 04.png) # 6. ä»£ç éªŒè¯ ä»£ç ç¼–å†™å®Œæˆä¹‹åï¼Œå°†ESP32S3å¼€å‘æ¿æ¥å…¥ç”µè„‘ä¸‹è½½ä»£ç ã€‚ç„¶åè§‚å¯Ÿå½©ç¯çŸ©é˜µçš„ç°è±¡ã€‚ å®ç‰©æ˜¾ç¤ºå¦‚ä¸‹ï¼š **ä½¿ç”¨é»‘è‰²äºšå…‹åŠ›é¢æ¿+ç™½çº¸æ ¼æŒ¡å…‰çº¿æ˜¾ç¤º** > å å±‚ä»ä¸Šåˆ°ä¸‹æ˜¯è¿™æ ·çš„ï¼šé»‘è‰²äºšå…‹åŠ›é¢æ¿ > ç™½çº¸ > LEDçŸ©é˜µ ![å›¾ 0](../../static/images/docs/diy/picxel clock/led oscillating/led oscillating 2024 12 06 00 05 00.gif) >! è¯´æ˜ï¼šå¦‚æœä½ æ ¹æ®ä»£ç æ“ä½œè¿è¡Œä¸èµ·æ¥ï¼Œå¯ä»¥ä¸‹è½½ğŸ‘‰[ä¾‹ç¨‹](https://gitee.com/laoguaige/esp32 s3 r8 n8 pixel clock/tree/master/example/OscillatingLED)çœ‹çœ‹"},"/diy/picxel-clock/ledmatrix.html":{"title":"å½©ç¯é©±åŠ¨","content":" title: å½©ç¯é©±åŠ¨ keywords: keyword1, keyword2 desc: description for this article show_source: false excerpt_separator: \"\" update: date: 2024 12 05 author: è€æ€ªé¸½ version: 1.0.1 content: æ›´æ–°äº†åŸºæœ¬æ–‡æ¡£ ## ç¡¬ä»¶å‡†å¤‡ ### WS2812çŸ©é˜µå½©ç¯ ![å›¾ 0](../../static/images/docs/diy/picxel clock/ledmatrix/ledmatrix 2024 12 05 23 14 08.png) **è´­ä¹°åœ°å€ï¼š**[WS2812Bå…¨å½©è½¯åƒç´ å±8X8 8X32 16X16å¹»å½©5Væ˜¾ç¤ºå¯ç¼–ç¨‹åƒç´ è½¯å±](https://item.taobao.com/item.htm?spm a1z09.2.0.0.24ee2e8dC5LwBl&id 737696448369&_u r2t4uge57a73&skuId 5263566850408) ### ESP32S3å¼€å‘æ¿ ![å›¾ 1](../../static/images/docs/diy/picxel clock/ledmatrix/ledmatrix 2024 12 05 23 14 24.png) **è´­ä¹°åœ°å€ï¼š**[ç«‹åˆ›Â·ESP32S3R8N8 å¼€å‘æ¿](https://item.szlcsc.com/22034693.html?fromZone s_s__%2522%25E7%25AB%258B%25E5%2588%259B%25E5%25BC%2580%25E5%258F%2591%25E6%259D%25BF%2522) ## å·¥ç¨‹åˆ›å»º åœ¨VSCodeä¸­æ‰“å¼€PlatformIOæ‰©å±•åˆ›å»ºåä¸º`LEDMatrix`çš„ `Espressif ESP32 S3 DevKitM 1` å·¥ç¨‹ã€‚ å…³äºè¯¦ç»†å›¾æ–‡åˆ›å»ºå·¥ç¨‹çš„è¿‡ç¨‹è¯·å‚è€ƒğŸ‘‰[RTCæ—¶é’Ÿé©±åŠ¨](ds1302.html)ç« èŠ‚çš„å·¥ç¨‹åˆ›å»ºå°èŠ‚ã€‚ ## å®‰è£…é©±åŠ¨åº“ æœ€åº•å±‚çš„é©±åŠ¨ï¼Œéœ€è¦åˆ†åˆ«å®‰è£…ä¸¤ä¸ªåº“ï¼š 1. æœç´¢``Adafruit NeoMatrix``ï¼Œå®‰è£…æ¥è‡ª``Adafruit``çš„``Adafruit NeoMatrix``åº“ã€‚ 2. æœç´¢``Adafruit GFX Library``ï¼Œå®‰è£…æ¥è‡ª``Adafruit``çš„``Adafruit GFX Library``åº“ã€‚ å°†å®ƒä»¬éƒ½å®‰è£…åˆ°æˆ‘ä»¬çš„å·¥ç¨‹å½“ä¸­ã€‚ > å…³äºè¯¦ç»†å›¾æ–‡å®‰è£…é©±åŠ¨åº“çš„è¿‡ç¨‹è¯·å‚è€ƒğŸ‘‰[RTCæ—¶é’Ÿé©±åŠ¨](ds1302.html)ç« èŠ‚çš„å®‰è£…é©±åŠ¨åº“å°èŠ‚ã€‚ éƒ½å®‰è£…å®Œæˆä¹‹åï¼Œæ‰“å¼€``platformio.ini``æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»å®‰è£…ä¸Šäº†ä¸¤ä¸ªé©±åŠ¨åº“ã€‚ ![å›¾ 2](../../static/images/docs/diy/picxel clock/ledmatrix/ledmatrix 2024 12 05 23 16 11.png) ## ç¼–è¾‘ä»£ç  é¦–å…ˆå¯¼å…¥æˆ‘ä»¬çš„å­—åº“ï¼Œè¿™é‡Œæˆ‘æä¾›ç»™å¤§å®¶ä¸€ä¸ªasciiçš„å­—åº“ã€‚åœ¨å·¥ç¨‹ä¸‹çš„``include``æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ª ``my_font.h``æ–‡ä»¶ã€‚ æ¥ä¸‹æ¥å¾€ ``my_font.h`` æ–‡ä»¶å†™å…¥æˆ‘ä»¬çš„å­—æ¨¡ä»£ç ï¼š > ç›´æ¥å¤åˆ¶ä»¥ä¸‹ä»£ç åˆ°ä½ çš„æ–‡ä»¶ä¸‹ ```c #include \"Arduino.h\" #include \"Adafruit_GFX.h\" const uint8_t PicopixelBitmaps[] PROGMEM { 0xE8, 0xB4, 0x57, 0xD5, 0xF5, 0x00, 0x4E, 0x3E, 0x80, 0xA5, 0x4A, 0x4A, 0x5A, 0x50, 0x80, 0x6A, 0x40, 0x95, 0x80, 0xAA, 0x80, 0x5D, 0x00, 0x60, 0xE0, 0x80, 0x25, 0x48, 0xF6, 0xDE, 0x59, 0x2E, 0xE7, 0xCE, 0xE7, 0x9E, 0xB7, 0x92, 0xF3, 0x9E, 0xF3, 0xDE, 0xE4, 0x92, 0xF7, 0xDE, 0xF7, 0x9E, 0xA0, 0x46, 0x64, 0xE3, 0x80, 0x98, 0xC5, 0x04, 0x56, 0xC6, 0x57, 0xDA, 0xD7, 0x5C, 0x72, 0x46, 0xD6, 0xDC, 0xF3, 0xCE, 0xF3, 0x48, 0x72, 0xD4, 0xB7, 0xDA, 0xF8, 0x24, 0xD4, 0xBB, 0x5A, 0x92, 0x4E, 0x8E, 0xEB, 0x58, 0x80, 0x9D, 0xB9, 0x90, 0x56, 0xD4, 0xD7, 0x48, 0x56, 0xD4, 0x40, 0xD7, 0x5A, 0x71, 0x1C, 0xE9, 0x24, 0xB6, 0xD4, 0xB6, 0xA4, 0x8C, 0x6B, 0x55, 0x00, 0xB5, 0x5A, 0xB5, 0x24, 0xE5, 0x4E, 0xEA, 0xC0, 0x91, 0x12, 0xD5, 0xC0, 0x54, 0xF0, 0x90, 0xC7, 0xF0, 0x93, 0x5E, 0x71, 0x80, 0x25, 0xDE, 0x5E, 0x30, 0x6E, 0x80, 0x77, 0x9C, 0x93, 0x5A, 0xB8, 0x45, 0x60, 0x92, 0xEA, 0xAA, 0x40, 0xD5, 0x6A, 0xD6, 0x80, 0x55, 0x00, 0xD7, 0x40, 0x75, 0x90, 0xE8, 0x71, 0xE0, 0xBA, 0x40, 0xB5, 0x80, 0xB5, 0x00, 0x8D, 0x54, 0xAA, 0x80, 0xAC, 0xE0, 0xE5, 0x70, 0x6A, 0x26, 0xFC, 0xC8, 0xAC, 0x5A}; const GFXglyph PicopixelGlyphs[] PROGMEM { {0, 0, 0, 2, 0, 1}, // 0x20 ' ' {0, 1, 5, 2, 0, 4}, // 0x21 '!' {1, 3, 2, 4, 0, 4}, // 0x22 '\"' {2, 5, 5, 6, 0, 4}, // 0x23 '#' {6, 3, 6, 4, 0, 4}, // 0x24 '$' {9, 3, 5, 4, 0, 4}, // 0x25 '%' {11, 4, 5, 5, 0, 4}, // 0x26 '&' {14, 1, 2, 2, 0, 4}, // 0x27 ''' {15, 2, 5, 3, 0, 4}, // 0x28 '(' {17, 2, 5, 3, 0, 4}, // 0x29 ')' {19, 3, 3, 4, 0, 3}, // 0x2A '*' {21, 3, 3, 4, 0, 3}, // 0x2B '+' {23, 2, 2, 3, 0, 0}, // 0x2C ',' {24, 3, 1, 4, 0, 2}, // 0x2D ' ' {25, 1, 1, 2, 0, 0}, // 0x2E '.' {26, 3, 5, 4, 0, 4}, // 0x2F '/' {28, 3, 5, 4, 0, 4}, // 0x30 '0' {30, 3, 5, 4, 0, 4}, // 0x31 '1' {32, 3, 5, 4, 0, 4}, // 0x32 '2' {34, 3, 5, 4, 0, 4}, // 0x33 '3' {36, 3, 5, 4, 0, 4}, // 0x34 '4' {38, 3, 5, 4, 0, 4}, // 0x35 '5' {40, 3, 5, 4, 0, 4}, // 0x36 '6' {42, 3, 5, 4, 0, 4}, // 0x37 '7' {44, 3, 5, 4, 0, 4}, // 0x38 '8' {46, 3, 5, 4, 0, 4}, // 0x39 '9' {48, 1, 3, 2, 0, 3}, // 0x3A ':' {49, 2, 4, 3, 0, 3}, // 0x3B ';' {50, 2, 3, 3, 0, 3}, // 0x3C '<' {51, 3, 3, 4, 0, 3}, // 0x3D ' ' {53, 2, 3, 3, 0, 3}, // 0x3E '>' {54, 3, 5, 4, 0, 4}, // 0x3F '?' {56, 3, 5, 4, 0, 4}, // 0x40 '@' {58, 3, 5, 4, 0, 4}, // 0x41 'A' {60, 3, 5, 4, 0, 4}, // 0x42 'B' {62, 3, 5, 4, 0, 4}, // 0x43 'C' {64, 3, 5, 4, 0, 4}, // 0x44 'D' {66, 3, 5, 4, 0, 4}, // 0x45 'E' {68, 3, 5, 4, 0, 4}, // 0x46 'F' {70, 3, 5, 4, 0, 4}, // 0x47 'G' {72, 3, 5, 4, 0, 4}, // 0x48 'H' {74, 1, 5, 2, 0, 4}, // 0x49 'I' {75, 3, 5, 4, 0, 4}, // 0x4A 'J' {77, 3, 5, 4, 0, 4}, // 0x4B 'K' {79, 3, 5, 4, 0, 4}, // 0x4C 'L' {81, 5, 5, 6, 0, 4}, // 0x4D 'M' {85, 4, 5, 5, 0, 4}, // 0x4E 'N' {88, 3, 5, 4, 0, 4}, // 0x4F 'O' {90, 3, 5, 4, 0, 4}, // 0x50 'P' {92, 3, 6, 4, 0, 4}, // 0x51 'Q' {95, 3, 5, 4, 0, 4}, // 0x52 'R' {97, 3, 5, 4, 0, 4}, // 0x53 'S' {99, 3, 5, 4, 0, 4}, // 0x54 'T' {101, 3, 5, 4, 0, 4}, // 0x55 'U' {103, 3, 5, 4, 0, 4}, // 0x56 'V' {105, 5, 5, 6, 0, 4}, // 0x57 'W' {109, 3, 5, 4, 0, 4}, // 0x58 'X' {111, 3, 5, 4, 0, 4}, // 0x59 'Y' {113, 3, 5, 4, 0, 4}, // 0x5A 'Z' {115, 2, 5, 3, 0, 4}, // 0x5B '[' {117, 3, 5, 4, 0, 4}, // 0x5C '\\' {119, 2, 5, 3, 0, 4}, // 0x5D ']' {121, 3, 2, 4, 0, 4}, // 0x5E '^' {122, 4, 1, 4, 0, 1}, // 0x5F '_' {123, 2, 2, 3, 0, 4}, // 0x60 '`' {124, 3, 4, 4, 0, 3}, // 0x61 'a' {126, 3, 5, 4, 0, 4}, // 0x62 'b' {128, 3, 3, 4, 0, 2}, // 0x63 'c' {130, 3, 5, 4, 0, 4}, // 0x64 'd' {132, 3, 4, 4, 0, 3}, // 0x65 'e' {134, 2, 5, 3, 0, 4}, // 0x66 'f' {136, 3, 5, 4, 0, 3}, // 0x67 'g' {138, 3, 5, 4, 0, 4}, // 0x68 'h' {140, 1, 5, 2, 0, 4}, // 0x69 'i' {141, 2, 6, 3, 0, 4}, // 0x6A 'j' {143, 3, 5, 4, 0, 4}, // 0x6B 'k' {145, 2, 5, 3, 0, 4}, // 0x6C 'l' {147, 5, 3, 6, 0, 2}, // 0x6D 'm' {149, 3, 3, 4, 0, 2}, // 0x6E 'n' {151, 3, 3, 4, 0, 2}, // 0x6F 'o' {153, 3, 4, 4, 0, 2}, // 0x70 'p' {155, 3, 4, 4, 0, 2}, // 0x71 'q' {157, 2, 3, 3, 0, 2}, // 0x72 'r' {158, 3, 4, 4, 0, 3}, // 0x73 's' {160, 2, 5, 3, 0, 4}, // 0x74 't' {162, 3, 3, 4, 0, 2}, // 0x75 'u' {164, 3, 3, 4, 0, 2}, // 0x76 'v' {166, 5, 3, 6, 0, 2}, // 0x77 'w' {168, 3, 3, 4, 0, 2}, // 0x78 'x' {170, 3, 4, 4, 0, 2}, // 0x79 'y' {172, 3, 4, 4, 0, 3}, // 0x7A 'z' {174, 3, 5, 4, 0, 4}, // 0x7B '{' {176, 1, 6, 2, 0, 4}, // 0x7C '' {177, 3, 5, 4, 0, 4}, // 0x7D '}' {179, 4, 2, 5, 0, 3} }; // 0x7E '~' const GFXfont Picopixel PROGMEM {(uint8_t *)PicopixelBitmaps, (GFXglyph *)PicopixelGlyphs, 0x20, 0x7E, 7}; ``` å­—æ¨¡å‡†å¤‡å®Œæ¯•ï¼Œæˆ‘ä»¬å¯ä»¥ç‚¹äº®å½©ç¯çŸ©é˜µï¼Œå¹¶ä¸”æ˜¾ç¤ºasciiçš„å­—ç¬¦äº†ï¼ æ‰“å¼€å·¥ç¨‹ä¸‹çš„srcæ–‡ä»¶å¤¹ä¸‹çš„main.cppã€‚ è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š ```c #include <Arduino.h> #include <Adafruit_NeoMatrix.h> //ç‚¹äº®LEDçŸ©é˜µéœ€è¦çš„åº“ #include \"my_font.h\" //å¼•ç”¨æ–‡å­—åº“å¤´æ–‡ä»¶ //åƒç´ é˜µåˆ—å®šä¹‰ #define kMatrixWidth 32 //å®½åº¦ #define kMatrixHeight 8 //é«˜åº¦ #define BRIGHTNESS 10 //é»˜è®¤äº®åº¦ 0 255 #define BRIGHTNESS_INTERVAL 30 //äº®åº¦è°ƒèŠ‚é—´éš” #define LED_PIN 8 //åƒç´ é˜µåˆ—å¼•è„š Adafruit_NeoMatrix *matrix; //LEDçŸ©é˜µç±»æŒ‡é’ˆ //åƒç´ çŸ©é˜µåˆå§‹åŒ– void InitLED_Matrix(void) { //è®¾ç½®åƒç´ çŸ©é˜µçš„æ–¹å‘ä»¥åŠæ’åˆ—æ–¹å¼ matrix new Adafruit_NeoMatrix(32, 8, LED_PIN, NEO_MATRIX_TOP + NEO_MATRIX_LEFT+ NEO_MATRIX_COLUMNS + NEO_MATRIX_ZIGZAG, NEO_GRB + NEO_KHZ800); matrix >setTextWrap(false); //è®¾ç½®æ–‡å­—æ˜¯å¦è‡ªåŠ¨æ¢è¡Œ matrix >setFont(&Picopixel); //è®¾ç½®å­—ä½“ matrix >clear(); //æ¸…é™¤å½“å‰æ˜¾ç¤ºå†…å®¹ matrix >setBrightness(BRIGHTNESS);//è®¾ç½®äº®åº¦ } //æ˜¾ç¤ºä¿¡æ¯ void ShowMessage(Adafruit_NeoMatrix *matrix, char *message, int len, uint32_t color) { //æ¸…é™¤ä¸Šä¸€æ¬¡çš„æ˜¾ç¤ºå†…å®¹ matrix >clear(); //è®¾ç½®æ–‡æœ¬é¢œè‰² matrix >setTextColor(color); //å¦‚æœæ˜¾ç¤ºçš„å†…å®¹è¿‡é•¿ï¼Œæˆ–è€…è¿‡å° if (len < 1 len > 8) return; //è®¾ç½®é¼ æ ‡å…‰æ ‡çš„ä½ç½®ç”¨ä»¥ç¡®å®šåœ¨å“ªé‡Œæ˜¾ç¤ºæ–‡å­— //Xè½´è‡ªåŠ¨å±…ä¸­ matrix >setCursor(1 + (8 len) * 2, 5); //å°†æ˜¾ç¤ºçš„å†…å®¹è¾“å‡ºè‡³ç¼“å­˜ä¸­ matrix >print(message); //æ˜¾ç¤ºç¼“å­˜ä¸­çš„å†…å®¹ matrix >show(); } void setup() { //åˆå§‹åŒ–LEDçŸ©é˜µæ˜¾ç¤º InitLED_Matrix(); //æ˜¾ç¤º 6 ä¸ªå­—ç¬¦ï¼Œæ˜¾ç¤ºå†…å®¹ï¼šHello!ï¼Œæ˜¾ç¤ºé¢œè‰²ï¼šç»¿è‰²(R,G,B) ShowMessage(matrix, \"Hello!\", 6, matrix >Color(0, 255, 0)); } void loop() { delay(1000); } ``` ## ç¡¬ä»¶è¿æ¥ ![å›¾ 3](../../static/images/docs/diy/picxel clock/ledmatrix/ledmatrix 2024 12 05 23 17 41.png) > è¿™é‡Œå…¶å®æˆ‘æ˜¯åšäº†ç”µè·¯è®¾è®¡çš„ï¼Œä½†æ˜¯æ¨¡å—ç”µè·¯éƒ½æ˜¯ä¸€æ ·çš„ã€‚ > ![å›¾ 4](../../static/images/docs/diy/picxel clock/ledmatrix/ledmatrix 2024 12 05 23 17 49.png) ## ä»£ç éªŒè¯ ä»£ç ç¼–å†™å®Œæˆä¹‹åï¼Œå°†ESP32S3å¼€å‘æ¿æ¥å…¥ç”µè„‘ä¸‹è½½ä»£ç ã€‚ç„¶åè§‚å¯Ÿå½©ç¯çŸ©é˜µçš„ç°è±¡ã€‚ å®ç‰©æ˜¾ç¤ºå¦‚ä¸‹ï¼š **è£¸å±æ˜¾ç¤º** ![å›¾ 5](../../static/images/docs/diy/picxel clock/ledmatrix/ledmatrix 2024 12 05 23 18 43.png) **ä½¿ç”¨é»‘è‰²äºšå…‹åŠ›é¢æ¿+ç™½çº¸æ ¼æŒ¡å…‰çº¿æ˜¾ç¤º** > å å±‚ä»ä¸Šåˆ°ä¸‹æ˜¯è¿™æ ·çš„ï¼šé»‘è‰²äºšå…‹åŠ›é¢æ¿ > ç™½çº¸ > LEDçŸ©é˜µ ![å›¾ 6](../../static/images/docs/diy/picxel clock/ledmatrix/ledmatrix 2024 12 05 23 18 50.png) ## ç¤ºä¾‹ä¸€ï¼šæ˜¾ç¤ºä¸‹é›¨ç‰¹æ•ˆ ### æ–‡ä»¶åˆ›å»ºåˆ†ç±» 1. åœ¨å·¥ç¨‹ä¸‹çš„``include`` æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ª ``anim.h``æ–‡ä»¶ã€‚ 2. åœ¨å·¥ç¨‹ä¸‹çš„``src`` æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ª ``anim.cpp``æ–‡ä»¶ã€‚ ### ä»£ç ç¼–å†™ åœ¨ ``anim.h`` æ–‡ä»¶ä¸­ç¼–å†™ä»¥ä¸‹ä»£ç ï¼š ```c #ifndef _ANIM_H_ #define _ANIM_H_ #include <Adafruit_NeoMatrix.h> #include \"Arduino.h\" //æ•°å­—é›¨åŠ¨ç”» void movingPixel(Adafruit_NeoMatrix *matrix, int x, int y, int colorh); void showRainingCode(Adafruit_NeoMatrix *matrix); #endif ``` åœ¨ ``anim.cpp`` æ–‡ä»¶ä¸­ç¼–å†™ä»¥ä¸‹ä»£ç ï¼š ```c #include \"anim.h\" //æ•°å­—é›¨ int columnIndex[8]; int stepIndex[8]; int glow[8]; bool Running[8] {false, false, false, false, false, false, false, false}; int stepsTillNext[8] {0, 6, 2, 11, 4, 10, 7, 1}; uint16_t hsv2rgb(Adafruit_NeoMatrix *matrix, uint16_t hue, uint8_t saturation, uint8_t value) { uint8_t red 0; uint8_t green 0; uint8_t blue 0; uint16_t hi (hue / 60) % 6; uint16_t F 100 * hue / 60 100 * hi; uint16_t P value * (100 saturation) / 100; uint16_t Q value * (10000 F * saturation) / 10000; uint16_t T value * (10000 saturation * (100 F)) / 10000; switch (hi) { case 0: red value; green T; blue P; break; case 1: red Q; green value; blue P; break; case 2: red P; green value; blue T; break; case 3: red P; green Q; blue value; break; case 4: red T; green P; blue value; break; case 5: red value; green P; blue Q; break; default: return matrix >Color(255, 0, 0); } red red * 255 / 100; green green * 255 / 100; blue blue * 255 / 100; return matrix >Color(red, green, blue); } //æ•°å­—é›¨ä¸“ç”¨çš„ç§»åŠ¨åƒç´ ç‰¹æ•ˆ void movingPixel(Adafruit_NeoMatrix *matrix, int x, int y, int colorh) { int pixel y; matrix >drawPixel(x, pixel, hsv2rgb(matrix, colorh, 100, 100)); if(pixel 1 > 0){ matrix >drawPixel(x, pixel 1, hsv2rgb(matrix, colorh, 80, 80 ));} if(pixel 2 > 0){ matrix >drawPixel(x, pixel 2, hsv2rgb(matrix, colorh, 70, 70 ));} if(pixel 3 > 0){ matrix >drawPixel(x, pixel 3, hsv2rgb(matrix, colorh, 45, 45 ));} if(pixel 4 > 0){ matrix >drawPixel(x, pixel 4, hsv2rgb(matrix, colorh, 25, 25 ));} if(pixel 5 > 0){ matrix >drawPixel(x, pixel 5, hsv2rgb(matrix, colorh, 10, 10 ));} if(pixel 6 > 0){ matrix >drawPixel(x, pixel 6, matrix >Color(0, 0, 0));} } //æ˜¾ç¤ºæ•°å­—é›¨ç‰¹æ•ˆ void showRainingCode(Adafruit_NeoMatrix *matrix) { for(int i 0; i<8; i++) { if(stepIndex[i] > stepsTillNext[i]) { Running[i] true; stepsTillNext[i] 13; // è¿›è¡Œæ•°ç»„åˆå§‹åŒ– columnIndex[i] random((i*4), ((i+1)*4)); glow[i] random(0, 2); //éšæœºèƒŒæ™¯ç½®ç°å€¼ stepIndex[i] 0; } if(Running[i] true) { movingPixel(matrix, columnIndex[i], stepIndex[i], 240); if(stepIndex[i] 13) { Running[i] false; } } stepIndex[i] + 1; } } ``` æœ€ååœ¨`main.cpp`ä¸­ç¼–å†™å¦‚æœä»£ç ï¼š ```c #include <Arduino.h> #include <Adafruit_NeoMatrix.h> //ç‚¹äº®LEDçŸ©é˜µéœ€è¦çš„åº“ #include \"my_font.h\" //å¼•ç”¨æ–‡å­—åº“å¤´æ–‡ä»¶ #include \"anim.h\" //å¼•ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„åŠ¨ç”»å¤´æ–‡ä»¶ //åƒç´ é˜µåˆ—å®šä¹‰ #define kMatrixWidth 32 //å®½åº¦ #define kMatrixHeight 8 //é«˜åº¦ #define BRIGHTNESS 50 //é»˜è®¤äº®åº¦ 0 255 #define BRIGHTNESS_INTERVAL 30 //äº®åº¦è°ƒèŠ‚é—´éš” #define LED_PIN 8 //åƒç´ é˜µåˆ—å¼•è„š Adafruit_NeoMatrix *matrix; //LEDçŸ©é˜µç±»æŒ‡é’ˆ //åƒç´ çŸ©é˜µåˆå§‹åŒ– void InitLED_Matrix(void) { //è®¾ç½®åƒç´ çŸ©é˜µçš„æ–¹å‘ä»¥åŠæ’åˆ—æ–¹å¼ matrix new Adafruit_NeoMatrix(32, 8, LED_PIN, NEO_MATRIX_TOP + NEO_MATRIX_LEFT+ NEO_MATRIX_COLUMNS + NEO_MATRIX_ZIGZAG, NEO_GRB + NEO_KHZ800); matrix >setTextWrap(false); //è®¾ç½®æ–‡å­—æ˜¯å¦è‡ªåŠ¨æ¢è¡Œ matrix >setFont(&Picopixel); //è®¾ç½®å­—ä½“ matrix >clear(); //æ¸…é™¤å½“å‰æ˜¾ç¤ºå†…å®¹ matrix >setBrightness(BRIGHTNESS);//è®¾ç½®äº®åº¦ } //æ˜¾ç¤ºä¿¡æ¯ void ShowMessage(Adafruit_NeoMatrix *matrix, char *message, int len, uint32_t color) { //æ¸…é™¤ä¸Šä¸€æ¬¡çš„æ˜¾ç¤ºå†…å®¹ matrix >clear(); //è®¾ç½®æ–‡æœ¬é¢œè‰² matrix >setTextColor(color); //å¦‚æœæ˜¾ç¤ºçš„å†…å®¹è¿‡é•¿ï¼Œæˆ–è€…è¿‡å° if (len < 1 len > 8) return; //è®¾ç½®é¼ æ ‡å…‰æ ‡çš„ä½ç½®ç”¨ä»¥ç¡®å®šåœ¨å“ªé‡Œæ˜¾ç¤ºæ–‡å­— //Xè½´è‡ªåŠ¨å±…ä¸­ matrix >setCursor(1 + (8 len) * 2, 5); //å°†æ˜¾ç¤ºçš„å†…å®¹è¾“å‡ºè‡³ç¼“å­˜ä¸­ matrix >print(message); //æ˜¾ç¤ºç¼“å­˜ä¸­çš„å†…å®¹ matrix >show(); } void setup() { //åˆå§‹åŒ–LEDçŸ©é˜µæ˜¾ç¤º InitLED_Matrix(); //æ˜¾ç¤º 6 ä¸ªå­—ç¬¦ï¼Œæ˜¾ç¤ºå†…å®¹ï¼šHello!ï¼Œæ˜¾ç¤ºé¢œè‰²ï¼šç»¿è‰²(R,G,B) ShowMessage(matrix, \"Hello!\", 6, matrix >Color(0, 255, 0)); delay(2000); } void loop() { //æ¸…é™¤ä¹‹å‰çš„æ˜¾ç¤ºå†…å®¹ matrix >clear(); //è®¾ç½®é›¨æ»´ç‰¹æ•ˆ showRainingCode(matrix); //æ˜¾ç¤ºå†…å®¹ matrix >show(); //æ§åˆ¶é›¨æ»´ä¸‹è½é€Ÿåº¦ delay(250); } ``` ### å®ç‰©æ•ˆæœ > çƒ§å½•æ­¥éª¤ä¸å†æè¿°ï¼Œè¿™é‡Œç›´æ¥æä¾›å®ç‰©æ•ˆæœå›¾ã€‚ **ä½¿ç”¨é»‘è‰²äºšå…‹åŠ›é¢æ¿+ç™½çº¸æ ¼æŒ¡å…‰çº¿æ˜¾ç¤º** > å å±‚ä»ä¸Šåˆ°ä¸‹æ˜¯è¿™æ ·çš„ï¼šé»‘è‰²äºšå…‹åŠ›é¢æ¿ > ç™½çº¸ > LEDçŸ©é˜µ ![å›¾ 9](../../static/images/docs/diy/picxel clock/ledmatrix/ledmatrix 2024 12 05 23 22 51.gif) ## ç¤ºä¾‹äºŒï¼šæ˜¾ç¤ºæ—¶é’Ÿå¹¶èµ°æ—¶ > å¹¶ä¸æ˜¯çœŸçš„æ˜¾ç¤ºçœŸå®æ—¶é—´ï¼Œè¿™é‡Œåªæ˜¯æ˜¾ç¤ºä¸ªæ¨¡å‹ï¼Œæ–¹ä¾¿æˆ‘ä»¬åé¢æå¥½æ—¶é’Ÿæ¨¡å—çš„é©±åŠ¨åä½¿ç”¨ ### æ–‡ä»¶åˆ›å»ºåˆ†ç±» ç»§ç»­ç»§ç”¨ä¸Šä¸€ç« èŠ‚çš„ ``anim.h`` å’Œ ``anim.cpp``ï¼Œä½ç½®å’Œæ–‡ä»¶åéƒ½ä¸å˜ã€‚ ### ç¼–å†™ä»£ç  åœ¨``anim.h``ä¸­è¡¥å……å¦‚ä¸‹ï¼š ```c //æ—¶é’Ÿæ—¶é’Ÿ void weekBarDisplay(Adafruit_NeoMatrix *matrix,int week); ``` ä»£ç é¡µé¢æˆªå›¾ï¼š ![å›¾ 10](../../static/images/docs/diy/picxel clock/ledmatrix/ledmatrix 2024 12 05 23 23 17.png) åœ¨``anim.cpp`` æ–‡ä»¶çš„æœ«å°¾è¡¥å……å¦‚ä¸‹ä»£ç ï¼š ```c /**************************************æ•°å­—æ—¶é’Ÿ*********************************************** */ //æ—¥æœŸæ˜¾ç¤º void weekBarDisplay(Adafruit_NeoMatrix *matrix,int week) { week week 1; for (int i 0; i < 7; i++) { if ( i 5 i 6 ) matrix >drawFastHLine(3 + 4 * i, 7, 3, matrix >Color(50, 0, 0)); else matrix >drawFastHLine(3 + 4 * i, 7, 3, matrix >Color(50, 50, 50)); } if ( week 5 week 6 ) //å‘¨å…­ã€æ—¥æ˜¾ç¤ºä¸ºçº¢è‰² matrix >drawFastHLine(3 + 4 * week, 7, 3, matrix >Color(255, 0, 0)); else matrix >drawFastHLine(3 + 4 * week, 7, 3, matrix >Color(255, 255, 255)); } /**************************************æ•°å­—æ—¶é’Ÿ*********************************************** */ ``` ![å›¾ 11](../../static/images/docs/diy/picxel clock/ledmatrix/ledmatrix 2024 12 05 23 23 24.png) åœ¨``main.cpp`` æ–‡ä»¶ä¸­ï¼Œå°†``loop() `` å‡½æ•°ä¸­æ›´æ–°ä¸ºå¦‚ä¸‹ä»£ç ï¼š ```c void loop() { static char disp_buf[50] {0}; static int hour 12; static int minute 59; static int second 0; static int week 2; matrix >clear();//æ¸…å± matrix >setTextColor(matrix >Color(0, 0, 80));//è®¾ç½®æ–‡æœ¬é¢œè‰² matrix >setCursor(3, 5);//è®¾ç½®æ˜¾ç¤ºèµ·å§‹åæ ‡ sprintf(disp_buf, \"%02d:%02d:%02d\\0\", hour, minute, second);//æ ¼å¼åŒ–æ—¶é—´å­—ç¬¦ä¸² matrix >print(disp_buf);//æ˜¾ç¤ºæ—¶åˆ†ç§’ weekBarDisplay(matrix,week);//æ˜¾ç¤ºå‘¨ï¼ˆç‰¹æ®Šçš„æ˜¾ç¤ºæ–¹å¼ï¼‰ matrix >show();//æ›´æ–°æ˜¾ç¤º delay(1000); second second + 1; if( second > 59 ) second 0; } ``` ä»£ç æˆªå›¾ï¼š ![å›¾ 12](../../static/images/docs/diy/picxel clock/ledmatrix/ledmatrix 2024 12 05 23 23 40.png) > ä»£ç ä¸­æ—¶é’Ÿè·‘æ—¶éƒ¨åˆ†æ˜¯éšä¾¿å†™çš„ï¼Œè¿™é‡Œå°±æ˜¯å†™äº†ä¸€ä¸ªæ˜¾ç¤ºæ—¶é—´çš„UIæ¡†æ¶ï¼Œå¹¶ä¸æ˜¯çœŸå®æ—¶é—´çš„è·‘æ—¶ã€‚ ### å®ç‰©éªŒè¯ > çƒ§å½•æ­¥éª¤ä¸å†æè¿°ï¼Œè¿™é‡Œç›´æ¥æä¾›å®ç‰©æ•ˆæœå›¾ã€‚ ![å›¾ 13](../../static/images/docs/diy/picxel clock/ledmatrix/ledmatrix 2024 12 05 23 23 52.gif) **ä¸‹æ–¹æ˜¾ç¤ºçš„å‘¨æ•°ï¼Œå½“å‰æ˜¯å‘¨äºŒï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªé«˜äº®** >! è¯´æ˜ï¼šå¦‚æœä½ æ ¹æ®ä»£ç æ“ä½œè¿è¡Œä¸èµ·æ¥ï¼Œå¯ä»¥ä¸‹è½½ğŸ‘‰[ä¾‹ç¨‹](https://gitee.com/laoguaige/esp32 s3 r8 n8 pixel clock/tree/master/example/LEDMatrix)çœ‹çœ‹"},"/diy/picxel-clock/install.html":{"title":"åƒç´ æ—¶é’Ÿç¯å¢ƒæ­å»º","content":" title: åƒç´ æ—¶é’Ÿç¯å¢ƒæ­å»º keywords: keyword1, keyword2 desc: description for this article show_source: false update: date: 2024 12 05 author: è€æ€ªé¸½ version: 1.0.1 content: æ›´æ–°äº†åŸºæœ¬æ–‡æ¡£ ## å®‰è£…VScode å®‰è£…çš„æ­¥éª¤ç½‘ç»œä¸Šå¤šçš„å¾ˆï¼Œè¿™é‡Œä¸å†ä»‹ç»ã€‚ ## VSCodeå®‰è£…PlatformIOæ‰©å±• æ‰“å¼€VSCodeçš„æ‰©å±•å®‰è£…ã€‚ ![å›¾ 0](../../static/images/docs/diy/picxel clock/install/install 2024 12 05 22 46 30.png) æœç´¢``platformio``å¹¶è¿›è¡Œå®‰è£…ã€‚ ![å›¾ 1](../../static/images/docs/diy/picxel clock/install/install 2024 12 05 22 46 44.png) å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å®‰è£…ï¼Œé€šå¸¸æ˜¯éœ€è¦é­”æ³•çš„ï¼Œæ¯•ç«ŸæœåŠ¡å™¨åœ¨æµ·å¤–ã€‚ ### ç¦»çº¿å®‰è£…PIO å½“ç‚¹å‡»å®‰è£…æ—¶ï¼ŒPIOå°±ä¼šå»githubä¸Šå®‰è£…å¯¹åº”çš„èµ„æºï¼Œä½†æ˜¯githubè¿˜æ˜¯æœ‰å¾ˆå¤šäººä¸çŸ¥é“æ€ä¹ˆä¸Šï¼Œä¹Ÿä¸çŸ¥é“æ€ä¹ˆå¼€é­”æ³•ï¼Œæ‰€ä»¥å½“å‡ºç°ä¸‹å›¾ä¸­çš„æç¤ºæ—¶ï¼Œé©¬ä¸Šå…³é—­VSCodeã€‚ ![å›¾ 2](../../static/images/docs/diy/picxel clock/install/install 2024 12 05 22 46 58.png) è¿™é‡Œæä¾›ä¸€ä¸ªPIOç¦»çº¿çš„èµ„æ–™åŒ…ï¼Œ <mark>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šPIOèµ„æºåŒ… <mark>é“¾æ¥: https://pan.baidu.com/s/1n0lSM8ngeu1Wt5uJzMze A æå–ç : LGGA </mark> ![å›¾ 3](../../static/images/docs/diy/picxel clock/install/install 2024 12 05 22 47 16.png) å»åˆ°Cç›˜è‡ªå·±çš„ç”µè„‘ç”¨æˆ·åä¸‹ï¼š ![å›¾ 4](../../static/images/docs/diy/picxel clock/install/install 2024 12 05 22 47 25.png) å°†ç™¾åº¦ç½‘ç›˜ä¸­ä¸‹è½½çš„ <kbd>.platformio.zip</kbd>è§£å‹åˆ°ä½ çš„ç”µè„‘ç”¨æˆ·åæ–‡ä»¶å¤¹ä¸‹æ›¿æ¢ã€‚æ›¿æ¢å®Œæˆåï¼Œ`.platformio`æ–‡ä»¶å¤¹ä¸­å…¨éƒ¨çš„æ–‡ä»¶å¦‚ä¸‹ï¼š > æ³¨æ„åˆ«æé”™äº†ï¼Œæ˜¯å°†ç™¾åº¦ç½‘ç›˜ä¸­çš„å†…å®¹è§£å‹åˆ°ç”µè„‘ç”¨æˆ·åä¸‹æ›¿æ¢ï¼Œä¸è¦å†åµŒå¥—ä¸€ä¸ª.platformioæ–‡ä»¶å¤¹ã€‚ ![å›¾ 5](../../static/images/docs/diy/picxel clock/install/install 2024 12 05 22 47 40.png) ## PlatformIOä»‹ç» æ‰“å¼€VSCodeï¼Œæ‰“å¼€æˆ‘ä»¬åˆšæ‰å®‰è£…çš„PIO. ![å›¾ 6](../../static/images/docs/diy/picxel clock/install/install 2024 12 05 22 48 01.png) ç•Œé¢çš„ä»‹ç»ï¼š ![å›¾ 7](../../static/images/docs/diy/picxel clock/install/install 2024 12 05 22 48 17.png) é‚£ä¹ˆè¿™é‡Œå®‰è£…å°±å®Œæˆäº†ã€‚"},"/diy/picxel-clock/voice.html":{"title":"è¯­éŸ³è¯†åˆ«ä¸æ’­æŠ¥","content":" title: è¯­éŸ³è¯†åˆ«ä¸æ’­æŠ¥ keywords: keyword1, keyword2 desc: description for this article show_source: false update: date: 2024 12 05 author: è€æ€ªé¸½ version: 1.0.1 content: æ›´æ–°äº†åŸºæœ¬æ–‡æ¡£ ## ç¡¬ä»¶å‡†å¤‡ ### SU 03Tè¯­éŸ³è¯†åˆ«æ¨¡å— ![å›¾ 0](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 16 09.png) **è´­ä¹°åœ°å€ï¼š**[AIæ™ºèƒ½è¯­éŸ³è¯†åˆ«æ¨¡å—ç¦»çº¿è¯­éŸ³æ§åˆ¶æ¨¡å—è¯­éŸ³è¯†åˆ«èŠ¯ç‰‡å£°æ§æ¨¡å—SU 03T](https://item.taobao.com/item.htm?spm a21n57.1.item.2.5149523ciinTKe&priceTId 213e36a717250841217803005e1125&utparam %7B%22aplus_abtest%22:%224e3555425c253a0aa3856c6a58b82147%22%7D&id 622894893913&ns 1&abbucket 4&skuId 4913882832427&pisk fspsdgvloP4_MmiKcrnFOpFg24Wf1EMz5osvqneaDOBOkBtklNomsORCleLCWRoissQXSOCD_Z7NlttDPDurUY MjtXtz4kr2nBemTVADNU4pJIcs2oU8Y MjZq_k0RKUS1r0WIYMZLAp6IcXtUYHinCpgjfHRCYBWUd wQAH eAv9I5qZF9kiCd9Gj_HrFOWvBdDwQAHth8Lusj1NxsvUYbVXnPAhQQFHvCXdPMfwag7pTP1aePR evdGtLGeM_Fj7JZN5PreHUCttdce1y14w6lnKkM69bWc8JDFvCITGqj_OpTQ56OVef8dSfwtCQD KCHCCvhTH8RMApbIpM5owAjdJPGafID fVpL5JwFZmqHBODEfk342GWnKkEQWSCzj6936C4jyPPrxLGWHuhM_rADN0iX96iThjh9KF6Mj1TDiQWIfOxM_rADN0i1IhfwoIAPdc.) ### ESP32S3å¼€å‘æ¿ ![å›¾ 1](../../static/images/docs/diy/picxel clock/ledmatrix/ledmatrix 2024 12 05 23 14 24.png) **è´­ä¹°åœ°å€ï¼š**[ç«‹åˆ›Â·ESP32S3R8N8 å¼€å‘æ¿](https://item.szlcsc.com/22034693.html?fromZone s_s__%2522%25E7%25AB%258B%25E5%2588%259B%25E5%25BC%2580%25E5%258F%2591%25E6%259D%25BF%2522) ### å…¶ä»–è£…å¤‡ 1. å–‡å­ï¼š`8Î©0.5Wçš„å–‡å­`ï¼ˆè¿™é‡Œå› ä¸ºæˆ‘æ˜¯åšäº†PCBï¼Œæ‰€ä»¥æ˜¯é‡‡ç”¨çš„ç«‹åˆ›å•†åŸçš„å™¨ä»¶ç¼–å·`C530532`ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥è‡ªè¡Œé‡‡è´­ä¾¿å®œçš„ï¼‰ **è´­ä¹°åœ°å€ï¼š** https://item.szlcsc.com/550866.html 2. éº¦å…‹é£ï¼š`çµæ•åº¦ 32db` ï¼ˆè¿™é‡Œå› ä¸ºæˆ‘æ˜¯åšäº†PCBï¼Œæ‰€ä»¥æ˜¯é‡‡ç”¨çš„ç«‹åˆ›å•†åŸçš„å™¨ä»¶ç¼–å·`C234013`ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥è‡ªè¡Œé‡‡è´­ä¾¿å®œçš„ï¼‰ **è´­ä¹°åœ°å€ï¼š** https://item.szlcsc.com/233795.html 3. ç»™è¯­éŸ³æ¨¡å—ä¸‹è½½çš„è®¾å¤‡CH340ï¼šï¼ˆè¿™é‡Œå› ä¸ºæˆ‘æ˜¯åšäº†PCBï¼Œæ­äº†ä¸‹è½½ç”µè·¯ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥è‡ªè¡Œé‡‡è´­æ·˜å®ä¸Šå–çš„CH340æ¨¡å—ï¼Œå¦‚ä¸‹å›¾ï¼‰ ![å›¾ 1](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 17 03.png) ## ç¡¬ä»¶è¿æ¥ æˆ‘ä¹‹å‰è¯´è¿‡æˆ‘æ˜¯è®¾è®¡äº†ç”µè·¯çš„ï¼Œä¸æ˜¯å•ç‹¬çš„æ¥æ¨¡å—ï¼Œæ‰€ä»¥ç¡¬ä»¶éƒ¨åˆ†æˆ‘ä¼šä»‹ç»ç”µè·¯è®¾è®¡æ–¹é¢ã€‚ ![å›¾ 2](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 19 24.png) é¦–å…ˆï¼Œå› ä¸ºè¯­éŸ³æ¨¡å—éœ€è¦æœ‰ä¸€ä¸ªä¸‹è½½è®¾å¤‡ï¼Œè¿™é‡Œç›´æ¥å°†TYPE Cæ¥å£çš„æ•°æ®æ¥å£æ¥åˆ°äº†ä¸€ä¸ªCH340Nï¼ˆå›¾ä¸­çš„U9ï¼Œç¼–å·C2977777ï¼‰çš„å™¨ä»¶ä¸Šã€‚æ¥ä¸‹æ¥å¯¹å„ä¸ªå™¨ä»¶è¿›è¡Œè¯´æ˜ã€‚ 1. R56å’ŒR57æ˜¯USBåè®®ä¸Šè¦æ±‚çš„ï¼Œå¿…é¡»æ˜¯5.1Kï¼Œæ¶‰åŠåˆ°PDè¯±éª—ç”µå‹è¾“å‡ºï¼Œå…·ä½“åŸå› è‡ªè¡Œç™¾åº¦ã€‚ 2. D8å’ŒD7æ˜¯ESDä¿æŠ¤å™¨ä»¶ï¼Œé˜²æ­¢é™ç”µçš„ï¼Œé˜²æ­¢é™ç”µæŸååçº§è®¾å¤‡ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨è¿™äº›å™¨ä»¶ã€‚ 3. VBUSé€šè¿‡ä¸€ä¸ªçŸ­æ¥ç¬¦å·è¿æ¥åˆ°äº†5Vï¼Œè¯´æ˜è¿™ä¸ªTYPE Cè¾“å…¥çš„æ˜¯5Vï¼Œæ˜¯æˆ‘çš„ä¸ªäººä¹ æƒ¯ï¼Œé€šå¸¸å¯ä»¥ç›´æ¥åœ¨USBå¤„æ ‡è®°5Vã€‚ 4. U9å°±æ˜¯ä¹‹å‰è¯´çš„CH340Nï¼Œçœ‹[æ•°æ®æ‰‹å†Œ](https://atta.szlcsc.com/upload/public/pdf/source/20230530/6E401E9554E9F5311886CC8B3F89B62E.pdf)ï¼Œæ˜¯ä¸€ä¸ªå°†USB è½¬ä¸²å£çš„èŠ¯ç‰‡ï¼Œè€Œæˆ‘ä»¬çš„è¯­éŸ³è¯†åˆ«æ¨¡å—å°±æ˜¯é€šè¿‡ä¸²å£ä¸‹è½½ã€‚ 5. C26å’ŒC27ï¼Œé¦–å…ˆæ˜¯C26ï¼Œåœ¨CH340Nçš„æ•°æ®æ‰‹å†Œä¸­æŒ‡å‡ºï¼šå½“CH340Nçš„ç”µå‹è¾“å…¥ä¸º5Væ—¶ï¼Œå¿…é¡»åœ¨V3å¼•è„šå¤„å¤–æ¥ä¸€ä¸ª100nfçš„ç”µå®¹ï¼›VCCå¤„å°½é‡åŠ ä¸€ä¸ª100NFçš„ç”µå®¹ã€‚ 6. R27å’ŒD1ï¼Œæ ¹æ®CH340Nçš„å‚å®¶è¯´æ˜ï¼Œä¸ºäº†é˜²æ­¢ä¸CH340Né€šä¿¡çš„è®¾å¤‡ï¼Œé€šè¿‡RXDå’ŒTXDå¼•è„šå°†ç”µå‹åå……ç»™CH340ï¼Œå»ºè®®åœ¨RXDå¼•è„šä¸Šæ¥å…¥ä¸€ä¸ªé™æµç”µé˜»ï¼ŒTXDä¸Šæ¥ä¸€ä¸ªåå‘äºŒæç®¡ï¼Œé˜²æ­¢ç”µæµç”µå‹å€’çŒã€‚ 7. D2ä¹Ÿæ˜¯ä¸€ä¸ªESDå™¨ä»¶ï¼Œé˜²æ­¢ç±»ä¼¼é›·å‡»ï¼Œé™ç”µç­‰å¯¼è‡´çš„ç¬é—´é«˜å‹æŸåè®¾å¤‡ï¼ŒåŠ å…¥ESDå™¨ä»¶åï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢ç¬é—´çš„é«˜å‹å°†è®¾å¤‡çƒ§æ¯ã€‚ **æ€»ç»“ï¼šå°±æ˜¯ä¸€ä¸ªé€šè¿‡USBä¾›ç”µçš„åŒæ—¶ï¼Œè¿˜å¯ä»¥é€šè¿‡USBç»™è¯­éŸ³æ¨¡å—ä¸‹è½½è¯­éŸ³è¯†åˆ«çš„å›ºä»¶** ![å›¾ 3](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 19 46.png) ä¸‹é¢å°±æ˜¯SU 03Tè¯­éŸ³è¯†åˆ«æ¨¡å—çš„å¤–å›´ç”µè·¯ï¼Œä¸‹é¢æ˜¯å¯¹å„ä¸ªå™¨ä»¶çš„ä»‹ç»ï¼š 1. å› ä¸ºè¿™ä¸ªè¯­éŸ³è¯†åˆ«æ¨¡å—åœ¨ä¸‹è½½å›ºä»¶æ—¶ï¼Œå¿…é¡»åœ¨ä¿æŒæ–­ç”µçš„æƒ…å†µä¸‹ï¼Œåœ¨ç”µè„‘ä¸Šç‚¹å‡»ä¸‹è½½ï¼Œç„¶åå†é€šç”µæ‰èƒ½å¤Ÿä¸‹è½½æˆåŠŸã€‚ä¸ºäº†å®ç°è¿™ä¸ªæ–­ç”µä¸‹è½½æ“ä½œï¼ŒåŠ äº†ä¸€ä¸ªæ‹¨ç å¼€å…³ï¼ˆSW1ï¼‰ã€‚ 2. C19çš„ä½œç”¨æ˜¯å‚¨èƒ½ï¼Œå¿…é¡»è¯­éŸ³è¯†åˆ«æ¨¡å—æ„Ÿè§‰è¿˜æ˜¯ç”µæµæ¶ˆè€—æŒºå¤§çš„ï¼ŒåŠ ä¸€ä¸ª10UFçš„ç”µå®¹ï¼Œåœ¨æ²¡æœ‰ç”µæµæ—¶å°±ä»C19ä¾›ç”µã€‚ 3. è¯­éŸ³é‡‡é›†çš„æ¡†å›¾ä¸­çš„32DBåªçš„å°±æ˜¯è¿™ä¸ªéº¦å…‹é£æ˜¯ 32DBçš„ä¸€ä¸ªéº¦å…‹é£ï¼Œæˆ–è€…å«å’ªå¤´ã€‚ 4. SPK1å°±æ˜¯å–‡å­ã€‚ 5. å›¾ä¸­çš„03TTXDå’Œ03TRXDå°±æ˜¯æ¥åˆ°äº†CH340Nçš„ä¸²å£é€šä¿¡çº¿ä¸Šï¼Œè¯­éŸ³å›ºä»¶å°±æ˜¯é€šè¿‡è¿™ä¸¤æ ¹çº¿è¿›è¡Œå›ºä»¶ä¸‹è½½ã€‚ 6. B2TXå’ŒB3RXæ˜¯æ¥åˆ°äº†å¼€å‘æ¿ä¸Šçš„GPIO13å’ŒGPIO12ï¼Œå¼€å‘æ¿å°†è¿™ä¸¤ä¸ªå¼•è„šè®¾ç½®ä¸ºä¸²å£é€šä¿¡ï¼Œè¯­éŸ³æ¨¡å—ä¹Ÿå°†B2B3è®¾ç½®ä¸ºä¸²å£é€šä¿¡ï¼Œè¿™æ ·æ‰å¯ä»¥æ•°æ®äº’ä¼ ã€‚ è¿™ä¸ªå¾ˆé‡è¦ï¼Œå› ä¸ºè¯¥è¯­éŸ³æ¨¡å—åªèƒ½è®¾ç½®B2å’ŒB3ä¸ºä¸²å£ã€‚ ä½¿ç”¨æ¨¡å—çš„æ¥çº¿å›¾ï¼š ![å›¾ 4](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 19 56.png) ## è¯­éŸ³è¯†åˆ«çš„å‘½ä»¤è¯è®¾ç½® ### æ–°å»ºäº§å“ è¿›å…¥åœ¨çº¿çš„é…ç½®å¹³å°ï¼š [æ™ºèƒ½å…¬å…ƒé›¶ä»£ç å¹³å°](https://smartpi.cn/#/)ï¼Œæ²¡æœ‰æ³¨å†Œçš„å…ˆæ³¨å†Œç„¶åç™»å½•ã€‚ ![å›¾ 5](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 20 03.png) å»åˆ°äº§å“ç®¡ç†ä¸‹ã€‚ ![å›¾ 6](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 20 07.png) æ–°å»ºä¸€ä¸ªäº§å“ ![å›¾ 7](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 20 13.png) äº§å“é…ç½®. ![å›¾ 8](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 20 18.png) ### è¯­éŸ³ä¿¡å·å¤„ç†é…ç½® ä¸‹é¢æ˜¯æˆ‘çš„é…ç½®æˆªå›¾ï¼š ![å›¾ 9](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 20 23.png) ### å¼•è„šé…ç½® å¼•è„šè®¾ç½®ä¸­ï¼Œé€‰æ‹©B2å’ŒB3ä¸ºä¸²å£ï¼Œä¸²å£çš„å…¶ä»–å‚æ•°é»˜è®¤ã€‚ ![å›¾ 10](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 20 27.png) ### å”¤é†’è¯é…ç½® å”¤é†’è¯çš„è®¾ç½®ã€‚è¯¥æ¨¡å—æ˜¯ä¸€ä¸ªäºŒçº§è¯­éŸ³å‘½ä»¤çš„æ¨¡å—ï¼Œç±»ä¼¼ä¸å°çˆ±åŒå­¦ï¼Œä½ å¾—å…ˆé€šè¿‡å”¤é†’è¯å°†æ¨¡å—å”¤é†’ï¼Œç„¶åæ‰èƒ½å¤Ÿè¿›è¡Œä¸‹ä¸€æ­¥çš„è¯­éŸ³å‘½ä»¤ã€‚è¿™é‡Œæˆ‘è®¾ç½®äº†ä¸‰ä¸ªå”¤é†’è¯ï¼Œå½“è¯­éŸ³æ¨¡å—è¯†åˆ«åˆ°å”¤é†’è¯æ—¶ï¼Œä¼šæ’­æŠ¥ä¸‹é¢çš„å”¤é†’å›å¤ã€‚ ![å›¾ 11](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 20 41.png) ### å‘½ä»¤è¯è‡ªå®šä¹‰ å‘½ä»¤è¯è‡ªå®šä¹‰ã€‚å›¾ä¸­çš„`è¡Œä¸º`æ å¯ä»¥éšä¾¿å†™ä¸é‡è¦ï¼›ä½†æ˜¯`è§¦å‘æ–¹å¼`æ å¾—æ³¨æ„ï¼Œå‘½ä»¤è¯è¡¨ç¤ºå½“è¯†åˆ«åˆ°æˆ‘ä»¬çš„è¯­éŸ³å‘½ä»¤æ—¶å°±ä¼šè§¦å‘çš„æ„æ€ï¼Œè€Œä¸²å£è¾“å…¥ï¼Œå°±æ˜¯å½“æ¥æ”¶åˆ°æˆ‘ä»¬å¼€å‘æ¿é€šè¿‡ä¸²å£å‘é€ç»™æ¨¡å—çš„ç‰¹ç‚¹æ ¼å¼çš„ä¸²å£æ•°æ®æ—¶ï¼Œæ‰ä¼šè§¦å‘ã€‚`å‘½ä»¤è¯`æ æ˜¯å½“`è§¦å‘æ–¹å¼`æ ä¸ºå‘½ä»¤è¯æ—¶æ‰å¯ä»¥è¾“å…¥ï¼Œè¾“å…¥çš„å†…å®¹å°±æ˜¯ä½ è¦è¯´ä»€ä¹ˆè¯­éŸ³ï¼Œä»–æ‰ä¼šè§¦å‘è¿™ä¸ªå‘½ä»¤ï¼Œè€Œ``çš„æ„æ€å°±æ˜¯å¯ä»¥è®¾ç½®å¤šä¸ªå‘½ä»¤è¯ã€‚å½“å‘½ä»¤è¯è¢«è§¦å‘æ—¶ï¼Œå¯ä»¥è®¾ç½®æ˜¯å¦è¦è¯­éŸ³æ¨¡å—è¿›è¡Œå›å¤ï¼Œå›å¤å†…å®¹åœ¨`å›å¤è¯­`æ ä¸­é…ç½®ã€‚ ![å›¾ 12](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 20 46.png) ç‚¹å‡»æ§åˆ¶æ ï¼šå¯ä»¥è®¾ç½®å½“å‘½ä»¤è§¦å‘æ—¶ï¼Œéœ€è¦æ§åˆ¶è¯­éŸ³æ¨¡å—åšä»€ä¹ˆæ“ä½œã€‚ ![å›¾ 13](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 20 50.png) åŠ¨ä½œå‚æ•°çš„è®¾ç½®æ–¹å¼ï¼š**ï¼ˆGIFï¼‰** > è¿™é‡Œé™¤äº†ä¸²å£å¤–ï¼Œè¿˜å¯ä»¥è®¾ç½®å…¶ä»–çš„åŠ¨ä½œï¼Œå¤§å®¶è‡ªè¡Œäº†è§£ã€‚ ![å›¾ 14](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 21 02.gif) æˆ‘è®¾ç½®çš„æ§åˆ¶å‚æ•°å¦‚ä¸‹ã€‚ ```c è¯­éŸ³è¡¨ å¸§å¤´ æ•°æ® å¸§å°¾ è¯´æ˜ EF 00 FE è¢«è¯­éŸ³å”¤é†’ï¼Œå”¤é†’è¯ï¼šå°è±†å°è±†å°è±†åŒå­¦ä½ å¥½å°è±† EF 01 FE è¯†åˆ«åˆ°è¯­éŸ³ï¼šå½“å‰æ¸©æ¹¿åº¦ç°åœ¨æ¸©æ¹¿åº¦ç°åœ¨çš„æ¸©æ¹¿åº¦æ¸©æ¹¿åº¦æ˜¯å¤šå°‘ EF 02 FE è¯†åˆ«åˆ°è¯­éŸ³ï¼šå½“å‰æ—¶é—´ç°åœ¨æ—¶é—´ç°åœ¨çš„æ—¶é—´ç°åœ¨æ˜¯ä»€ä¹ˆæ—¶å€™äº†ç°åœ¨å¤šå°‘ç‚¹äº†ç°åœ¨æ—¶é—´æ˜¯å¤šå°‘æŠ¥æ—¶ EF 03 FE è¯†åˆ«åˆ°è¯­éŸ³ï¼šæ˜¾ç¤ºæ—¶é—´åˆ‡æ¢æ—¶é—´ç•Œé¢åˆ‡æ¢æ—¶é—´æ˜¾ç¤ºæ—¶é’Ÿåˆ‡æ¢æ—¶é’Ÿç•Œé¢åˆ‡æ¢æ—¶é’Ÿ EF 04 FE è¯†åˆ«åˆ°è¯­éŸ³ï¼šæ˜¾ç¤ºå¤©æ°”åˆ‡æ¢å¤©æ°”åˆ‡æ¢å¤©æ°”ç•Œé¢æ˜¾ç¤ºå¤©æ°”ç•Œé¢ EF 05 FE è¯†åˆ«åˆ°è¯­éŸ³ï¼šæ˜¾ç¤ºæ¸©æ¹¿åº¦åˆ‡æ¢æ¸©æ¹¿åº¦åˆ‡æ¢æ¸©æ¹¿åº¦ç•Œé¢æ˜¾ç¤ºæ¸©æ¹¿åº¦ç•Œé¢ EF 06 FE è¯†åˆ«åˆ°è¯­éŸ³ï¼šæ˜¾ç¤ºæ•°å­—é›¨åˆ‡æ¢æ•°å­—é›¨åˆ‡æ¢æ•°å­—é›¨ç•Œé¢æ˜¾ç¤ºæ•°å­—é›¨ç•Œé¢ EF 07 FE è¯†åˆ«åˆ°è¯­éŸ³ï¼šæ˜¾ç¤ºé¢‘è°±ç¯æ˜¾ç¤ºéŸ³å¾‹ç¯åˆ‡æ¢é¢‘è°±ç¯åˆ‡æ¢éŸ³å¾‹ç¯åˆ‡æ¢é¢‘è°±ç¯ç•Œé¢åˆ‡æ¢éŸ³é¢‘ç¯ç•Œé¢æ˜¾ç¤ºé¢‘è°±ç¯ç•Œé¢æ˜¾ç¤ºéŸ³å¾‹ç¯ç•Œé¢ EF 08 FE è¯†åˆ«åˆ°è¯­éŸ³ï¼šæ˜¾ç¤ºåˆ‡æ¢åˆ‡å±ç•Œé¢åˆ‡æ¢åˆ‡æ¢ç•Œé¢æ˜¾ç¤ºä¸‹ä¸€ä¸ª ``` å½“å¼€å‘æ¿çš„ä¸²å£æ¥æ”¶åˆ° `EF 00 FE` æ—¶ï¼Œè¯´æ˜è¯­éŸ³æ¨¡å—è§¦å‘äº†å”¤é†’è¯å‘½ä»¤ï¼›å½“å¼€å‘æ¿çš„ä¸²å£æ¥æ”¶åˆ° `EF 01 FE` æ—¶ï¼Œè¯´æ˜è¯­éŸ³æ¨¡å—è§¦å‘äº†å½“å‰æ¸©æ¹¿åº¦çš„å‘½ä»¤ã€‚å…¶å®ƒåŒç†ã€‚ä¸ºäº†æ–¹ä¾¿æ¥æ”¶å¹¶è§£æå¤šæ¡å‘½ä»¤ï¼Œè¿™é‡Œè®¾ç½®æˆä¸ºäº†å¸§å¤´å¸§å°¾çš„æ ¼å¼ã€‚å½“ä¸²å£æ¥æ”¶åˆ°`FE`è¯´æ˜è¯­éŸ³è¯†åˆ«æ¨¡å—è§¦å‘äº†å‘½ä»¤ï¼Œåˆ†æä¸Šä¸€ä¸ªæ¥æ”¶çš„æ•°æ®ï¼Œåˆ™å¯ä»¥çŸ¥é“æ˜¯è¯†åˆ«çš„å“ªä¸€ä¸ªå‘½ä»¤ã€‚ ä¾‹å¦‚ï¼šè¯­éŸ³è¯†åˆ«æ¨¡å—å‘æ¥äº†å‘½ä»¤ï¼š`EF 04 FE` ```C if( RX_BUFF[DATA_LEN] 0XFE )//æ¥æ”¶åˆ°å¸§å°¾ { if( RX_BUFF[DATA_LEN 2] 0XEF ) //ç¡®å®šä¸Šä¸Šä¸ªæ¥æ”¶åˆ°çš„æ•°æ®æ˜¯å¸§å¤´ï¼Œç¡®å®šæ•°æ®æ ¼å¼æ­£ç¡® { SU03T_data cRX_BUFF[DATA_LEN 1]; //æ¥æ”¶ä¸­é—´çš„æ•°æ® } } ``` > 0Xåœ¨ä»£ç ä¸­è¡¨ç¤ºçš„æ˜¯åå…­è¿›åˆ¶çš„æ•°æ®ï¼Œè€Œè¯­éŸ³æ¨¡å—å‘é€çš„EF/FEç­‰æ•°æ®å°±æ˜¯åå…­è¿›åˆ¶ é™¤äº†ä»¥ä¸Šçš„åŠ¨ä½œå‚æ•°å¤–ï¼Œå¤§å®¶è¿˜è®°å¾—ä¹‹å‰è®¾ç½®çš„ä¸²å£è¾“å…¥å‘½ä»¤å—ï¼Ÿ`å½“è¯†åˆ«åˆ°æˆ‘ä»¬è®¾ç½®çš„ç‰¹æ®Šæ ¼å¼çš„ä¸²å£å‘½ä»¤ï¼Œè¯­éŸ³æ¨¡å—å°†ä¼šè¢«è§¦å‘ã€‚`,è¿™ä¸ªç‰¹æ®Šæ ¼å¼çš„ä¸²å£å‘½ä»¤å°±æ˜¯è¿™è¿™é‡Œè®¾ç½®çš„ï¼š ![å›¾ 15](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 21 24.png) è§¦å‘å‘½ä»¤çš„é…ç½®æ­¥éª¤ï¼š**( GIF )** ![å›¾ 16](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 21 34.gif) è¿™æ ·å½“æˆ‘ä»¬å‘é€æ ¼å¼ AA 55 02 1A 46 55 AA æ—¶ï¼Œè¯­éŸ³æ¨¡å—å°±ä¼šçŸ¥é“æˆ‘ä»¬å‘é€ç»™å®ƒçš„æ•°æ®æ˜¯ä»€ä¹ˆäº†ã€‚ å¸§å¤´ æ¶ˆæ¯ç¼–å· æ¸©åº¦æ•°æ® æ¹¿åº¦æ•°æ® å¸§å°¾ AA 55 02 1A 44 55 AA * å¸§å¤´å¸§å°¾æ˜¯åœ¨å¼•è„šé…ç½®æ—¶ï¼Œè®¾ç½®çš„ã€‚ * æ¶ˆæ¯ç¼–å·æ˜¯åœ¨è®¾ç½®è§¦å‘æ—¶è®¾ç½®çš„ã€‚ * è€Œè¿™ä¸ªæ¸©åº¦å’Œæ¹¿åº¦æ•°æ®ï¼Œè¡¨ç¤ºçš„æ˜¯å‘é€ä¸€ä¸ª`char`å‹çš„å˜é‡ï¼Œå¡«å……æ”¹æ•°æ®ã€‚æ¯”å¦‚æˆ‘ä»¬è¦å°†æ¸©åº¦12ï¼Œæ¹¿åº¦70è¿™ä¸¤ä¸ªæ•°æ®å‘é€ç»™è¯­éŸ³æ¨¡å—ï¼Œéœ€è¦å…ˆå°†æ•°æ®è½¬æ¢ä¸º16è¿›åˆ¶ï¼Œ12çš„åå…­è¿›åˆ¶ä¸º0Cï¼Œ70çš„åå…­è¿›åˆ¶ä¸º46ï¼Œåˆ™å‘é€è¿™ä¸ªï¼š<kbd>AA 55 02 0C 70 55 AA</kbd>ï¼Œåˆ™è¯­éŸ³æ¨¡å—å°±ä¼šçŸ¥é“ï¼Œæ¥æ”¶åˆ°äº†02å·è®¾å¤‡çš„æ•°æ® 12 å’Œ 46äº†ã€‚ æˆ‘ä»¬ç°åœ¨çŸ¥é“äº†æ¥æ”¶æ•°æ®çš„æ ¼å¼æ€ä¹ˆå‘é€äº†ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹è¯¥å‘½ä»¤çš„åŠ¨ä½œå‚æ•°é…ç½®æ­¥éª¤ï¼š**ï¼ˆGIFï¼‰** ![](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 22 13.gif) è¿™é‡Œç»§æ‰¿äº†ä¹‹å‰æ¥æ”¶åˆ°çš„æ•°æ®å˜é‡ `temp` å’Œ `humi`ï¼Œè¿™ä¸ª`temp`å°±æ˜¯æˆ‘ä»¬å‘é€çš„æ¸©åº¦æ•°æ®ï¼Œ`humi`å°±æ˜¯æˆ‘ä»¬å‘é€çš„æ¹¿åº¦æ•°æ®ï¼Œ > æ•°æ®å˜é‡æ˜¯åœ¨é…ç½®è§¦å‘å‘½ä»¤æ—¶è®¾ç½®çš„ã€‚ çœ‹å›¾å¤§å®¶åº”è¯¥ä¹ŸçŸ¥é“äº†ï¼Œå°±æ˜¯æ¨¡å—æ¥æ”¶åˆ°æˆ‘ä»¬å‘é€è¿‡å»ç»™å®ƒçš„ç‰¹æ®Šæ ¼å¼çš„ä¸²å£æ•°æ®æ—¶ï¼Œå®ƒä¼šå–å‡ºå…¶ä¸­çš„æ•°æ®ï¼Œå¹¶é€šè¿‡æˆ‘ä»¬çš„è®¾ç½®å°†æ•°æ®æ’­æŠ¥å‡ºæ¥ã€‚æ¯”å¦‚æ‹¿ä¹‹å‰çš„ä¸¾çš„ä¾‹å­ï¼š > æˆ‘ä»¬è¦å°†æ¸©åº¦12ï¼Œæ¹¿åº¦70è¿™ä¸¤ä¸ªæ•°æ®å‘é€ç»™è¯­éŸ³æ¨¡å—ï¼Œéœ€è¦å…ˆå°†æ•°æ®è½¬æ¢ä¸º16è¿›åˆ¶ï¼Œ12çš„åå…­è¿›åˆ¶ä¸º0Cï¼Œ70çš„åå…­è¿›åˆ¶ä¸º46ï¼Œåˆ™å‘é€è¿™ä¸ªï¼š<kbd>AA 55 02 0C 70 55 AA</kbd>ï¼Œåˆ™è¯­éŸ³æ¨¡å—å°±ä¼šçŸ¥é“ï¼Œæ¥æ”¶åˆ°äº†02å·è®¾å¤‡çš„æ•°æ® 12 å’Œ 70äº†ã€‚å½“è¯­éŸ³æ¨¡å—æ¥æ”¶åˆ°æ•°æ®åï¼Œåˆä¼šæ ¹æ®æˆ‘ä»¬çš„åŠ¨ä½œè®¾ç½®è¿›è¡Œæ’­æŠ¥ï¼š`å½“å‰æ¸©åº¦æ˜¯ 12 æ‘„æ°åº¦ï¼Œå½“å‰æ¹¿åº¦æ˜¯ç™¾åˆ†ä¹‹ 46` **ä»¥ä¸‹æ˜¯æˆ‘çš„ä¸¤ä¸ªä¸²å£å‘½ä»¤è¡¨ï¼š** ä¸²å£è§¦å‘å‘½ä»¤ æ’­æŠ¥çš„å†…å®¹ AA 55 01 hour min 55 AA å½“å‰æ—¶é—´ä¸º hour ç‚¹ min åˆ† AA 55 02 temp humi 55 AA å½“å‰æ¸©åº¦æ˜¯ temp æ‘„æ°åº¦ï¼Œå½“å‰æ¹¿åº¦æ˜¯ç™¾åˆ†ä¹‹ humi ### å…å”¤é†’è¯å’Œè¯¯è¯†åˆ«è¯é…ç½® è¿™é‡Œæˆ‘æ²¡æœ‰é…ç½®å¤ªå¤šï¼Œå°±é…ç½®äº†ä¸€ä¸ªå½“å‰æ—¶é—´è¯­éŸ³ã€‚å¯ä»¥ä¸ç”¨è§¦å‘å”¤é†’è¯ï¼Œç›´æ¥è¯´`å½“å‰æ—¶é—´`å°±å¯ä»¥è§¦å‘ã€‚ ![å›¾ 18](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 23 23.png) ### å‘éŸ³äººé…ç½® å¤§å®¶é€‰æ‹©ä¸€ä¸ªè‡ªå·±å–œæ¬¢çš„å°±å¥½ï¼Œç„¶åéŸ³é‡æ–¹é¢ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºéŸ³é‡æœ‰ç‚¹å¤§ï¼Œå°±è®¾ç½®ä¸ºäº†36%å·¦å³çš„éŸ³é‡ã€‚ ![å›¾ 19](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 23 28.png) ### å…¶ä»–é…ç½® åœ¨ å…¶ä»–é…ç½® ä¸­å»ºè®®å¤§å®¶å¼€å¯è¿™ä¸ª `å¼€æœºæ’­æŠ¥`åŠŸèƒ½ï¼Œé˜²æ­¢å¤§å®¶å¿˜è®°å”¤é†’è¯ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡å¼€æœºæ’­æŠ¥ï¼Œæ¯æ¬¡å¼€æœºéƒ½è®©æ¨¡å—â€œè‡ªæˆ‘ä»‹ç»â€ã€‚ ![å›¾ 20](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 23 35.png) å…¶ä»–çš„å†…å®¹å¦‚ä¸‹ï¼šå®Œå…¨ä¸ç”¨ç®¡ ![å›¾ 21](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 23 41.png) ### å‘å¸ƒæ–°ç‰ˆæœ¬ ç‚¹å‡»å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œè¿™ä¸ªå¹³å°å°±ä¼šå»ç”Ÿæˆä½ è‡ªå·±çš„è¯­éŸ³å›ºä»¶äº†ï¼Œé€šå¸¸ç”Ÿæˆçš„æ—¶é—´æ¯”è¾ƒä¹…ï¼Œå¾—ç­‰å¤§æ¦‚10~30åˆ†é’Ÿå·¦å³ã€‚ ![å›¾ 22](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 23 46.png) ### ä¸‹è½½å›ºä»¶å’Œçƒ§å½•è½¯ä»¶ å›ºä»¶ç”Ÿæˆä¹‹åï¼Œå»åˆ°ä½ å¯¹åº”çš„äº§å“ç®¡ç†ä¸‹ï¼Œä¸‹è½½ä½ çš„å›ºä»¶ã€‚**(GIF)** ![å›¾ 23](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 24 21.gif) ç‚¹å‡»ä¸‹è½½å›ºä»¶åï¼Œå¦‚å›¾ï¼šï¼ˆjx_firm (2).tar.gzå°±æ˜¯è¯­éŸ³å›ºä»¶ï¼‰ ![å›¾ 24](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 24 46.png) è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œä½ è¿˜éœ€è¦ä¸‹è½½è¯­éŸ³å›ºä»¶çš„çƒ§å½•å·¥å…·ï¼Œçƒ§å½•å·¥å…·ä¸­<kbd>æ›´å¤š</kbd>ä¸‹çš„<kbd>ä¸‹è½½SDK</kbd>ä¸­ã€‚ ![å›¾ 25](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 24 53.png) SDKçš„ä¸‹è½½ï¼š ![å›¾ 26](../../static/images/docs/diy/picxel clock/voice/voice 2024 12 06 00 24 58.png) ### è¯­éŸ³å›ºä»¶çš„ä¸‹è½½ `åœ¨ä¸‹è½½å›ºä»¶æ—¶ï¼Œè¦å…ˆå°†æ¨¡å—æ–­ç”µã€‚å¾…ä¸‹è½½å·¥å…·è¯†åˆ«åˆ°æ¨¡å—ä¹‹åï¼Œå†ç»™æ¨¡å—é€šç”µï¼Œæ‰å¯ä»¥æ­£å¸¸ä¸‹è½½ã€‚`è¿™ä¸ªé€šæ–­ç”µæ“ä½œï¼Œç”±åŸç†å›¾ä¸­çš„SW1å¼€å…³è¿›è¡Œæ§åˆ¶ã€‚å¦‚æœå¤§å®¶ä¸æ˜¯åƒæˆ‘ä¸€æ ·ä½¿ç”¨PCBè¿æ¥çš„ï¼Œé‚£ä½¿ç”¨CH340æ¨¡å—ç»™SU 03Tä¾›ç”µï¼Œåœ¨ä¸‹è½½å‰å°†VCCçš„ç”µæºæ‹”æ‰ï¼Œåœ¨è½¯ä»¶ä¸Šç‚¹ä¸‹è½½ä¹‹åå†è¿æ¥VCCã€‚ å…·ä½“çš„çƒ§å½•æ­¥éª¤è§†é¢‘ï¼š[è§†é¢‘åœ°å€](https://www.bilibili.com/video/BV1r5nZe3EsN/) <iframe src \"//player.bilibili.com/player.html?isOutside true&aid 113055635604214&bvid BV1r5nZe3EsN&cid 25672351903&p 1&autoplay 0\" scrolling \"no\" border \"0\" frameborder \"no\" framespacing \"0\" allowfullscreen \"true\" style \"width: 100%; margin: auto; display: block; height: 800px\"></iframe> ## PIOå·¥ç¨‹åˆ›å»º åœ¨VSCodeä¸­æ‰“å¼€PlatformIOæ‰©å±•åˆ›å»ºåä¸º`voiceSu03t`çš„ `Espressif ESP32 S3 DevKitM 1` å·¥ç¨‹ã€‚ å…³äºè¯¦ç»†å›¾æ–‡åˆ›å»ºå·¥ç¨‹çš„è¿‡ç¨‹è¯·å‚è€ƒğŸ‘‰[RTCæ—¶é’Ÿé©±åŠ¨](ds1302.html)ç« èŠ‚çš„å·¥ç¨‹åˆ›å»ºå°èŠ‚ã€‚ ## ç¼–è¾‘ä»£ç  åœ¨å·¥ç¨‹é‡Œçš„`src`æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å»ºä¸€ä¸ª `voiceSu03t.cpp` æ–‡ä»¶ã€‚ åœ¨å·¥ç¨‹é‡Œçš„`include`æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å»ºä¸€ä¸ª `voiceSu03t.h` æ–‡ä»¶ã€‚ å¾€`voiceSu03t.cpp` æ–‡ä»¶ä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼š ```cpp #include \"voiceSu03t.h\" #include \"stdio.h\" //ä¸²å£ä¸­æ–­æœåŠ¡å‡½æ•°ï¼Œè¯·åŠ¡å¿…åœ¨main.cppä¸­å®šä¹‰å¹¶ä¸”å®ç°è¯¥æ–‡ä»¶ void IRAM_ATTR voiceSerialReceive(); VOICESU03T::VOICESU03T(int8_t uart_num, int8_t tx_pin, int8_t rx_pin, uint32_t baud_rate) { _uart_num uart_num; _tx_pin tx_pin; _rx_pin rx_pin; _baud_rate baud_rate; switch (_uart_num) { case 1: serial &Serial1; break; case 2: serial &Serial2; break; // å¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ æ›´å¤šä¸²å£ } } //è¯­éŸ³æ¨¡å—ä¸²å£æ¥å£åˆå§‹åŒ– void VOICESU03T::begin() { if (serial) { serial >begin(_baud_rate, SERIAL_8N1, _rx_pin, _tx_pin); // æ³¨å†Œä¸­æ–­æœåŠ¡ä¾‹ç¨‹ serial >onReceive(voiceSerialReceive); } } //å‘è¯­éŸ³æ¨¡å—å‘é€ä¸²å£æ•°æ® size_t VOICESU03T::write(uint8_t *data, size_t size) { if (serial) { return serial >write((const uint8_t *)data, size); } return 0; } //è¯»å–è¯­éŸ³æ¨¡å—å‘é€è¿‡æ¥çš„ä¸²å£æ•°æ® int VOICESU03T::read() { if (serial) { return serial >read(); } return 1; } //å½“å‰æ¥æ”¶åˆ°çš„è¯­éŸ³æ¨¡å—å†…å®¹ç¼“å­˜é•¿åº¦ int VOICESU03T::available() { if (serial) { return serial >available(); } return 0; } void VOICESU03T::setState(int8_t state) { _state state; } int8_t VOICESU03T::getState() { return _state; } //å°†10è¿›åˆ¶è½¬æ¢ä¸º16è¿›åˆ¶çš„HEX //å‚æ•°ï¼šdecimalï¼ˆä¼ å…¥çš„10è¿›åˆ¶æ•°ï¼‰ //è¿”å›ï¼š16è¿›åˆ¶hex long VOICESU03T::decimalToHex_big(long decimal) { \tlong hex 0; \tint i 0; \tchar temp_buff[20]; \t \tsprintf(temp_buff, \"%lX\", decimal);//æ¢ä¸ºå­—ç¬¦ä¸²çš„16è¿›åˆ¶ \t//æ ¹æ®å­—ç¬¦ä¸²é•¿åº¦ä¸€ç›´è½¬æ¢ \tfor( i 0 ; temp_buff[i] ! '\\0'; i++ ) \t{ \t\t//å¦‚æœæ˜¯æ•°å­— \t\tif( temp_buff[i] > '0' && temp_buff[i] < '9' ) \t\t{ \t\t\thex (hex << 4) temp_buff[i] '0'; \t\t} \t\telse//å¦‚æœæ˜¯å­—æ¯ \t\t{ \t\t\tswitch( temp_buff[i] ) \t\t\t{ //å…ˆå·¦ç§»å†è½¬æ¢ \t\t\t\tcase 'A':\thex (hex << 4) 0x0A;\tbreak; \t\t\t\tcase 'B':\thex (hex << 4) 0x0B;\tbreak; \t\t\t\tcase 'C':\thex (hex << 4) 0x0C;\tbreak; \t\t\t\tcase 'D':\thex (hex << 4) 0x0D;\tbreak; \t\t\t\tcase 'E':\thex (hex << 4) 0x0E;\tbreak; \t\t\t\tcase 'F':\thex (hex << 4) 0x0F;\tbreak; \t\t\t} \t\t} \t} \treturn hex; } //å‘é€è¯­éŸ³æ’­æŠ¥å½“å‰æ—¶é—´çš„å‘½ä»¤ //hour å°æ—¶æ•°æ®,min åˆ†é’Ÿæ•°æ® void VOICESU03T::voiceSpeechTime(long hour, long min) { unsigned char sendBuff[7] { 0xAA, 0X55, 0X01, 0X00, 0X00, 0X55, 0xAA }; sendBuff[3] decimalToHex_big(hour); sendBuff[4] decimalToHex_big(min); write(sendBuff, 7); } //å‘é€è¯­éŸ³æ’­æŠ¥å½“å‰æ¸©æ¹¿åº¦çš„å‘½ä»¤ //temp æ¸©åº¦æ•°æ®,humi æ¹¿åº¦æ•°æ® void VOICESU03T::voiceSpeechHumiture(long temp, long humi) { unsigned char sendBuff[7] { 0xAA, 0X55, 0X02,0X00, 0X00, 0X55, 0xAA }; sendBuff[3] decimalToHex_big(temp); sendBuff[4] decimalToHex_big(humi); write(sendBuff, 7); } ``` å¾€`voiceSu03t.h` æ–‡ä»¶ä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼š ```cpp #ifndef VOICESU03T_H #define VOICESU03T_H #include \"HardwareSerial.h\" class VOICESU03T { public: VOICESU03T(int8_t uart_num, int8_t tx_pin, int8_t rx_pin, uint32_t baud_rate); void begin(); size_t write(uint8_t *data, size_t size); int read(); int available(); void setState(int8_t state); int8_t getState(); long decimalToHex_big(long decimal); void voiceSpeechTime(long hour, long min); void voiceSpeechHumiture(long temp, long humi); private: HardwareSerial *serial; int8_t _uart_num; int8_t _tx_pin; int8_t _rx_pin; uint32_t _baud_rate; int8_t _state; }; #endif // ESP32_EXTRA_UART_H ``` å¾€ `main.cpp` æ–‡ä»¶ä¸­å†™å…¥ä»¥ä¸‹ä»£ç ï¼š ```cpp #include <Arduino.h> #include \"voiceSu03t.h\" //è¯­éŸ³è¯†åˆ«æ¨¡å—å®šä¹‰ #define VOICE_PORT 1 //è¯­éŸ³è¯†åˆ«æ¨¡å—ä½¿ç”¨çš„ä¸²å£ #define VOICE_TX_PIN 12 //è¯­éŸ³è¯†åˆ«æ¨¡å—ä½¿ç”¨çš„ä¸²å£TXå¼•è„š #define VOICE_RX_PIN 13 //è¯­éŸ³è¯†åˆ«æ¨¡å—ä½¿ç”¨çš„ä¸²å£RXå¼•è„š #define VOICE_TX_BAUDRATE 9600 //è¯­éŸ³è¯†åˆ«æ¨¡å—ä½¿ç”¨çš„ä¸²å£æ³¢ç‰¹ç‡ //åˆ›å»ºè¯­éŸ³è¯†åˆ«å¯¹è±¡ VOICESU03T Su03t(VOICE_PORT, VOICE_TX_PIN, VOICE_RX_PIN, VOICE_TX_BAUDRATE); char su03t_rx_buff[20]; char su03t_rx_len; //è™šæ‹Ÿæ¸©æ¹¿åº¦æ•°æ® int temperature 26; int humidity 70; //è™šæ‹Ÿæ—¶é—´æ•°æ® int hour 12; int minute 59; /* è¯­éŸ³è¡¨ å¸§å¤´ æ•°æ® å¸§å°¾ è¯´æ˜ EF 00 FE è¢«è¯­éŸ³å”¤é†’ï¼Œå”¤é†’è¯ï¼šå°è±†å°è±†å°è±†åŒå­¦ä½ å¥½å°è±† EF 01 FE è¯†åˆ«åˆ°è¯­éŸ³ï¼šå½“å‰æ¸©æ¹¿åº¦ç°åœ¨æ¸©æ¹¿åº¦ç°åœ¨çš„æ¸©æ¹¿åº¦æ¸©æ¹¿åº¦æ˜¯å¤šå°‘ EF 02 FE è¯†åˆ«åˆ°è¯­éŸ³ï¼šå½“å‰æ—¶é—´ç°åœ¨æ—¶é—´ç°åœ¨çš„æ—¶é—´ç°åœ¨æ˜¯ä»€ä¹ˆæ—¶å€™äº†ç°åœ¨å¤šå°‘ç‚¹äº†ç°åœ¨æ—¶é—´æ˜¯å¤šå°‘æŠ¥æ—¶ EF 03 FE è¯†åˆ«åˆ°è¯­éŸ³ï¼šæ˜¾ç¤ºæ—¶é—´åˆ‡æ¢æ—¶é—´ç•Œé¢åˆ‡æ¢æ—¶é—´æ˜¾ç¤ºæ—¶é’Ÿåˆ‡æ¢æ—¶é’Ÿç•Œé¢åˆ‡æ¢æ—¶é’Ÿ EF 04 FE è¯†åˆ«åˆ°è¯­éŸ³ï¼šæ˜¾ç¤ºå¤©æ°”åˆ‡æ¢å¤©æ°”åˆ‡æ¢å¤©æ°”ç•Œé¢æ˜¾ç¤ºå¤©æ°”ç•Œé¢ EF 05 FE è¯†åˆ«åˆ°è¯­éŸ³ï¼šæ˜¾ç¤ºæ¸©æ¹¿åº¦åˆ‡æ¢æ¸©æ¹¿åº¦åˆ‡æ¢æ¸©æ¹¿åº¦ç•Œé¢æ˜¾ç¤ºæ¸©æ¹¿åº¦ç•Œé¢ EF 06 FE è¯†åˆ«åˆ°è¯­éŸ³ï¼šæ˜¾ç¤ºæ•°å­—é›¨åˆ‡æ¢æ•°å­—é›¨åˆ‡æ¢æ•°å­—é›¨ç•Œé¢æ˜¾ç¤ºæ•°å­—é›¨ç•Œé¢ EF 07 FE è¯†åˆ«åˆ°è¯­éŸ³ï¼šæ˜¾ç¤ºé¢‘è°±ç¯æ˜¾ç¤ºéŸ³å¾‹ç¯åˆ‡æ¢é¢‘è°±ç¯åˆ‡æ¢éŸ³å¾‹ç¯åˆ‡æ¢é¢‘è°±ç¯ç•Œé¢åˆ‡æ¢éŸ³é¢‘ç¯ç•Œé¢æ˜¾ç¤ºé¢‘è°±ç¯ç•Œé¢æ˜¾ç¤ºéŸ³å¾‹ç¯ç•Œé¢ EF 08 FE è¯†åˆ«åˆ°è¯­éŸ³ï¼šæ˜¾ç¤ºåˆ‡æ¢åˆ‡å±ç•Œé¢åˆ‡æ¢åˆ‡æ¢ç•Œé¢æ˜¾ç¤ºä¸‹ä¸€ä¸ª */ void voiceAnalysis(char* rx_buff) { if( rx_buff[0] 0XEF ) { if( rx_buff[2] 0xFE ) { Su03t.setState(rx_buff[1]); //æ¥æ”¶è¯­éŸ³æ¨¡å—æ ¼å¼å¸§çš„å…³é”®æ•°æ® switch (rx_buff[1]) { case 0x01://å½“å‰æ¸©æ¹¿åº¦ç°åœ¨æ¸©æ¹¿åº¦ç°åœ¨çš„æ¸©æ¹¿åº¦æ¸©æ¹¿åº¦æ˜¯å¤šå°‘ Su03t.voiceSpeechHumiture(temperature,humidity); break; case 0x02://å½“å‰æ—¶é—´ç°åœ¨æ—¶é—´ç°åœ¨çš„æ—¶é—´ç°åœ¨æ˜¯ä»€ä¹ˆæ—¶å€™äº†ç°åœ¨å¤šå°‘ç‚¹äº†ç°åœ¨æ—¶é—´æ˜¯å¤šå°‘æŠ¥æ—¶ Su03t.voiceSpeechTime(hour,minute); break; case 0x03://æ˜¾ç¤ºæ—¶é—´åˆ‡æ¢æ—¶é—´ç•Œé¢åˆ‡æ¢æ—¶é—´æ˜¾ç¤ºæ—¶é’Ÿåˆ‡æ¢æ—¶é’Ÿç•Œé¢åˆ‡æ¢æ—¶é’Ÿ Serial.printf(\"æ˜¾ç¤ºæ—¶é—´ç•Œé¢\"); break; case 0x04://æ˜¾ç¤ºå¤©æ°”åˆ‡æ¢å¤©æ°”åˆ‡æ¢å¤©æ°”ç•Œé¢æ˜¾ç¤ºå¤©æ°”ç•Œé¢ Serial.printf(\"æ˜¾ç¤ºå¤©æ°”ç•Œé¢\"); break; case 0x05://æ˜¾ç¤ºæ¸©æ¹¿åº¦åˆ‡æ¢æ¸©æ¹¿åº¦åˆ‡æ¢æ¸©æ¹¿åº¦ç•Œé¢æ˜¾ç¤ºæ¸©æ¹¿åº¦ç•Œé¢ Serial.printf(\"æ˜¾ç¤ºæ¸©æ¹¿åº¦ç•Œé¢\"); break; case 0x06://æ˜¾ç¤ºæ•°å­—é›¨åˆ‡æ¢æ•°å­—é›¨åˆ‡æ¢æ•°å­—é›¨ç•Œé¢æ˜¾ç¤ºæ•°å­—é›¨ç•Œé¢ Serial.printf(\"æ˜¾ç¤ºæ•°å­—é›¨ç•Œé¢\"); break; case 0x07://æ˜¾ç¤ºé¢‘è°±ç¯æ˜¾ç¤ºéŸ³å¾‹ç¯åˆ‡æ¢é¢‘è°±ç¯åˆ‡æ¢éŸ³å¾‹ç¯åˆ‡æ¢é¢‘è°±ç¯ç•Œé¢åˆ‡æ¢éŸ³é¢‘ç¯ç•Œé¢æ˜¾ç¤ºé¢‘è°±ç¯ç•Œé¢æ˜¾ç¤ºéŸ³å¾‹ç¯ç•Œé¢ Serial.printf(\"æ˜¾ç¤ºé¢‘è°±ç¯ç•Œé¢\"); break; case 0x08://æ˜¾ç¤ºåˆ‡æ¢åˆ‡å±ç•Œé¢åˆ‡æ¢åˆ‡æ¢ç•Œé¢æ˜¾ç¤ºä¸‹ä¸€ä¸ª Serial.printf(\"ç•Œé¢åˆ‡æ¢\"); break; default: break; } } } } // å®šä¹‰ä¸€ä¸ªè¯­éŸ³è¯†åˆ«ä¸²å£çš„ä¸­æ–­æœåŠ¡å‡½æ•° void voiceSerialReceive() { // å½“æœ‰æ•°æ®åˆ°è¾¾æ—¶ï¼Œæ­¤å‡½æ•°ä¼šè¢«è°ƒç”¨ while (Su03t.available()) { // è¯»å–æ•°æ® su03t_rx_buff[su03t_rx_len++] Su03t.read(); if( su03t_rx_len > 3 ) //å¦‚æœæ•°æ®é•¿åº¦è¶…è¿‡è¦æ±‚ { voiceAnalysis(su03t_rx_buff); //æ•°æ®è§£æå¹¶æ‰§è¡Œå¯¹åº”åŠŸèƒ½ for(int i 0;i<10;i++)su03t_rx_buff[i] 0;//æ¸…é™¤æ¥æ”¶çš„æ•°æ® su03t_rx_len 0;//æ¥æ”¶æ•°æ®çš„é•¿åº¦æ¸…é›¶ } } } void setup() { Serial.begin(9600); //è°ƒè¯•ä¸²å£åˆå§‹åŒ– Su03t.begin(); //è¯­éŸ³æ¨¡å—ä¸²å£åˆå§‹åŒ– } void loop() { delay(50); } ``` ## ä»£ç éªŒè¯ ä»£ç ç¼–å†™å®Œæˆä¹‹åï¼Œå°†ESP32S3å¼€å‘æ¿æ¥å…¥ç”µè„‘ä¸‹è½½ä»£ç ï¼Œç„¶åå¯¹è¯­éŸ³æ¨¡å—è¯´å‘½ä»¤è¯æŸ¥çœ‹ç°è±¡ã€‚ > ä¸‹è½½æ­¥éª¤è¯·å‚è€ƒğŸ‘‰[RTCæ—¶é’Ÿé©±åŠ¨](ds1302.html)ç« èŠ‚çš„ä»£ç éªŒè¯å°èŠ‚ã€‚ **å®éªŒç°è±¡ï¼šå¯¹è¯­éŸ³æ¨¡å—è¯´æˆ‘ä»¬ä¹‹å‰è®¾ç½®çš„å‘½ä»¤éƒ½æ˜¯æœ‰å“åº”å›å¤çš„** > å½“å‰ä¾‹ç¨‹ä¸­çš„æ¸©åº¦ã€æ¹¿åº¦ã€å°æ—¶ã€åˆ†é’Ÿç­‰æ•°æ®éƒ½æ˜¯**å›ºå®šçš„ï¼Œæ˜¯å‡çš„**ã€‚å¤§å®¶è‡ªè¡Œè°ƒæ•´ ç°è±¡è§†é¢‘ï¼šhttps://live.csdn.net/v/embed/421316 >! è¯´æ˜ï¼šå¦‚æœä½ æ ¹æ®ä»£ç æ“ä½œè¿è¡Œä¸èµ·æ¥ï¼Œå¯ä»¥ä¸‹è½½ğŸ‘‰[ä¾‹ç¨‹](https://gitee.com/laoguaige/esp32 s3 r8 n8 pixel clock/tree/master/example/voiceSu03t)çœ‹çœ‹"}}